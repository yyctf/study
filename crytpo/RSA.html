<!DOCTYPE html>
<!-- saved from url=(0073)file:///C:/Users/ppow/AppData/Local/Temp/mume2021830-768-fvgray.ndkr.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <title>RSA</title>
      
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="./RSA_files/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="rsa">RSA</h1>

<hr>
<h2 class="mume-header" id="%E4%BB%80%E4%B9%88%E6%98%AF-rsa">什么是 RSA</h2>

<p>RSA加密算法是一种非对称加密算法，在公开密钥加密和电子商业中被广泛使用。RSA是由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）在1977年一起提出的。</p>
<p>RSA 算法涉及三个参数, <code>n</code>,<code>e</code>,<code>d</code>，其中分为私钥和公钥，私钥是 <code>n</code>,<code>d</code>，公钥是 <code>n</code>,<code>e</code>。<code>n</code> 是两个素数的乘积，一般这两个素数在 RSA 中用字母 <code>p</code>,<code>q</code> 表示。<code>e</code> 是一个素数。<code>d</code> 是 <code>e</code> 模 phi(n) 的逆元，<code>d</code> 是由 <code>e</code>,<code>p</code>,<code>q</code> 可以求解出的。明文表示为 <code>m</code>。然后通过 RSA 加密，得到密文 C。</p>
<p>一般来说，<code>n</code>，<code>e</code> 是公开的，但是由于 <code>n</code> 一般是两个大素数的乘积，所以我们很难求解出 <code>d</code>，所以 RSA 加密就是利用现代无法快速实现大素数的分解，所存在的一种安全的非对称加密。</p>
<p><strong>RSA相关名词</strong></p>
<ul>
<li>质数 (素数) 是指在大于 1 的自然数中，除了 1 和它本身以外不再有其他因数的自然数。</li>
<li>合数是指比 1 大但不是素数的数</li>
<li>约数 (因数) 整数 a 除以整数 b(b≠0) 除得的商正好是整数而没有余数，我们就说 a 能被 b 整除，或 b 能整除 a。a 称为 b 的倍数，b 称为 a 的约数</li>
<li>互质数：如果两个整数 a,b 的最大公因数（greatest common divisor）为 1，即 gcb(a,b)=1，那么称 a,b 两数互质</li>
<li>欧拉函数是指设 m 为正整数，则 1,2,3,4.......,m 中与 m 互素的整数的个数记为φ(m)，叫做欧拉函</li>
</ul>
<p><strong>RSA相关值</strong></p>
<ul>
<li>N(n) : 模数（modulus）大整数n</li>
<li>p 和 q : 两个不相等的质数,N 的两个因子（factor）</li>
<li>e 和 d : 互为模反数的两个指数,(密钥)</li>
<li>c 和 m : 分别是密文和明文，这里一般指的是一个十进制的数还有一个就是 n 的欧拉函数值</li>
<li>r : 欧拉函数值</li>
</ul>
<p><strong>产生公私密钥对</strong></p>
<ol>
<li>随机选择两个不相等的质数 p 和 q。</li>
<li>计算 p 和 q 的乘积 n(n=p*q),n 的长度就是密钥长度。</li>
<li>计算 n 的欧拉函数φ(n)： φ(n) = (p-1)(q-1)</li>
<li>随机选择一个整数 e，也就是公钥当中用来加密的那个数字 条件是 1&lt; e &lt; φ(n)，且 e 与φ(n) 互质。</li>
<li>取 e 的模反数 d，计算方法为: e * d ≡ 1 (mod φ)</li>
<li>对明文 m 进行加密：c = pow(m, e, N), 可以得到密文 c。</li>
<li>对密文 c 进行解密：m = pow(c, d, N), 可以得到明文 m。</li>
<li>以 {e,n} 为公开密钥，{d,n}为秘密密钥。</li>
</ol>
<p>对于 RSA 加密算法，公钥 {e，n} 为公钥，可以任意公开，破解 RSA 最直接（亦或是暴力）的方法就是分解整数 N，然后计算欧拉函数φ(n)=(p-1) * (q-1), 再通过 d * e ≡ 1 mod φ(N)，即可计算出 d，然后就可以使用私钥 {d,n} 通过 m = pow(c,d,N)解密明文。</p>
<hr>
<h2 class="mume-header" id="rsa%E7%AE%97%E6%B3%95">RSA算法</h2>

<p>倘若在加解密信息的过程中，能让加密密钥（公钥）与解密密钥（私钥）不同，即</p>
<ol>
<li>甲要传密信给乙，乙先根据某种算法得出本次与甲通信的公钥与私钥；</li>
<li>乙将公钥传给甲（公钥可以让任何人知道，即使泄露也没有任何关系）；</li>
<li>甲使用乙传给的公钥加密要发送的信息原文m，发送给乙密文c；</li>
<li>乙使用自己的私钥解密密文c，得到信息原文m .</li>
</ol>
<p>就可以很好的克服对称加密算法的弱点，这种新的加密模式被称为“非对称加密算法”</p>
<p>可以观察到，从始至终，私钥一直都在信息接收方乙处，只要乙自己不泄露出去，私钥就没有泄露的可能</p>
<p>1977年，三位数学家Rivest、Shamir和Adleman设计了一种算法，可以实现非对称加密，这种算法用他们三个人的名字首字母命名，叫做RSA算法，RSA算法非常可靠，密钥越长，它就越难破解</p>
<p><strong>质数与互质数</strong></p>
<p>这是小学数学的概念</p>
<p><code>一个大于1的自然数，除了1和它本身外，不能被其他自然数整除（除0以外）的数称之为质数（素数）；否则称为合数。</code></p>
<p>例如，15＝3×5，所以15不是素数</p>
<p>13除了等于13×1以外，不能表示为其它任何两个整数的乘积，所以13是一个素数</p>
<p>1不是质数，也不是合数</p>
<p><code>公约数只有1的两个数，叫做互质数。</code></p>
<p>判断或选取互质数的方法/定理有很多，如下所示</p>
<ol>
<li>任意两个质数一定构成互质数（如3与11、53与61）；</li>
<li>大数是质数的两个数一定是互质数（如97与88）；</li>
<li>一个质数如果不能整除另一个合数，这两个数为互质数；即一个数是质数，另一个数只要不是前者的倍数，两者就构成互质关系（如3与10、5与26）；</li>
<li>1和任何一个自然数在一起都是互质数；</li>
<li>相邻的两个自然数是互质数（如15与16）；</li>
<li>相邻的两个奇数是互质数（如49与51）。</li>
</ol>
<p>在RSA算法中，我们通常使用以上第1条与第2条</p>
<p>即选取两个本身都是质数的数作为互质数</p>
<p>而以上第2条定理对于计算欧拉函数值有着积极作用</p>
<p><strong>模运算</strong></p>
<p>模运算的定义如下</p>
<p><code>让m去被n整除，只取所得的余数作为结果，就叫做模运算。</code></p>
<p>例如，10 mod 3 = 1 、26 mod 6 = 2 、28 mod 2 = 0</p>
<p><strong>同余</strong></p>
<p>“≡”是数论中表示同余的符号</p>
<p>同余的定义如下</p>
<p><code>给定一个正整数m，如果两个整数a和b满足a-b能被m整除，即(a-b)mod m=0，那么就称整数a与b对模m同余，记作a≡b(mod m)，同时可成立a mod m=b</code></p>
<p>再次提醒注意，同余与模运算是不同的</p>
<p>a≡b(mod m)仅可推出b=a mod m</p>
<p><strong>欧拉函数</strong></p>
<p>欧拉函数本身需要一系列复杂推导，本部分仅介绍对认识RSA算法有帮助的部分</p>
<p><code>任意给定正整数n，计算在小于等于n的正整数之中，有多少个与n构成互质关系？计算这个值的方法就叫做欧拉函数，以φ(n)表示.</code></p>
<p>例如，在1到8之中，与8形成互质关系的是1、3、5、7，所以φ(n)=4</p>
<p>在RSA算法中，我们需要明白欧拉函数对以下定理成立</p>
<ol>
<li>如果n可以分解成两个互质的整数之积，即n=p×q，则有：φ(n)=φ(pq)=φ(p)φ(q);</li>
<li>根据“大数是质数的两个数一定是互质数”可以知道：一个数如果是质数，则小于它的所有正整数与它都是互质数；所以如果一个数p是质数，则有：φ(p)=p-1</li>
</ol>
<p>由上易得，若我们知道一个数n可以分解为两个质数p和q的乘积，则有</p>
<p>φ(n)=(p-1)(q-1)</p>
<p><strong>欧拉定理与模反元素</strong></p>
<p>欧拉函数的用处，在于欧拉定理</p>
<p>“欧拉定理”指的是</p>
<p>如果两个正整数 a 和 n 互质，则 n 的欧拉函数φ(n) 可以让该等式成立：a<sup>φ(n)</sup>≡1(mod n)</p>
<p>也就是说，a 的φ(n) 次方被 n 除的余数为 1</p>
<p>模反元素的推导过程如下</p>
<p>根据欧拉定理，有：</p>
<p>a<sup>φ(n)</sup> = a × a<sup>φ(n)−1</sup> ≡ 1(mod n)</p>
<p>令 b=a<sup>φ(n)-1</sup>，得：</p>
<p>ab≡1(mod n)</p>
<p>b 就是 a 的模反元素</p>
<p>意即，如果两个正整数 a 和 n 互质，那么一定可以找到整数 b</p>
<p>使得 ab-1 被 n 整除，或者说 ab 被 n 除的余数是 1</p>
<p><strong>密钥组成与加解密公式</strong></p>
<p>公钥 KU</p>
<ul>
<li>n：质数 p 和质数 q 的乘积（p 和 q 必须保密）</li>
<li>e：与 (p-1)×(q-1) 互质</li>
</ul>
<p>私钥 KR</p>
<ul>
<li>n：同公钥 n</li>
<li>d：e<sup>-1</sup>(mod(p-1)(q-1))</li>
</ul>
<hr>
<h2 class="mume-header" id="rsa%E5%8A%A0%E5%AF%86">RSA加密</h2>

<p>首先对明文进行比特串分组，使得每个分组对应的十进制数小于 n，然后依次对每个分组 m 做一次加密，所有分组的密文构成的序列就是原始消息的加密结果，即 m 满足 0&lt;= m &lt; n，则加密算法为：</p>
<p>c≡ m<sup>e</sup> mod n</p>
<p>c 为密文，且 0&lt;=c &lt; n</p>
<p>还可以表示为 c = pow(m, e, N)</p>
<p><img src="./RSA_files/3.png" alt=""></p>
<p>也就是说 RSA 加密是对明文的 E 次方后除以 N 后求余数的过程。只要知道 E 和 N 就可以进行 RSA 加密了，所以说 E、N 是 RSA 加密的密钥，也就是说 E 和 N 的组合就是公钥。即 公钥 =(E,N)</p>
<hr>
<h2 class="mume-header" id="rsa%E8%A7%A3%E5%AF%86">RSA解密</h2>

<p>对于密文 0&lt;=c&lt; n，解密算法为：</p>
<p>m≡ c<sup>d</sup> mod n</p>
<p>还可以表示为 m = pow(c, d, N)）</p>
<p><img src="./RSA_files/4.png" alt=""></p>
<p>也就是说对密文进行 D 次方后除以 N 的余数就是明文，这就是 RSA 解密过程。知道 D 和 N 就能进行解密密文了，所以 D 和 N 的组合就是私钥。即 私钥 =(D,N)</p>
<hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n-%E5%AF%86%E6%96%87-c%E6%B1%82%E6%98%8E%E6%96%87-m">已知 e、n、密文 c，求明文 m</h2>

<p>给出 n、e、密文 c</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>e = 65537
n = 1455925529734358105461406532259911790807347616464991065301847
c = 69380371057914246192606760686152233225659503366319332065009
</code></pre><p>分解质因数n</p>
<ul>
<li><a href="http://www.factordb.com/index.php?query=1455925529734358105461406532259911790807347616464991065301847">http://www.factordb.com/index.php?query=1455925529734358105461406532259911790807347616464991065301847</a></li>
</ul>
<p>上脚本</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> binascii

e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">1455925529734358105461406532259911790807347616464991065301847</span>
c <span class="token operator">=</span> <span class="token number">69380371057914246192606760686152233225659503366319332065009</span>
<span class="token comment">#1.将n分解为p和q</span>
p <span class="token operator">=</span> <span class="token number">1201147059438530786835365194567</span>
q <span class="token operator">=</span> <span class="token number">1212112637077862917192191913841</span>

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#2.求d</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
<span class="token comment">#3.m=pow(c,d,n)</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#binascii.unhexlify(hexstr):从十六进制字符串hexstr返回二进制数据</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n-%E5%AF%86%E6%96%87-c%E6%B1%82%E6%98%8E%E6%96%87-m-%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95">已知 e、n、密文 c，求明文 m (欧几里得算法)</h2>

<p><strong>例题 2021 绿城杯 RSA-1</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> flag <span class="token keyword">import</span> flag
<span class="token keyword">assert</span> flag<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">b'flag{'</span>

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n ='</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>
M <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> m <span class="token operator">*</span> <span class="token number">1001</span> <span class="token operator">*</span> p
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c ='</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span>

<span class="token comment">#n = 17365231154926348364478276872558492775911760603002394353723603461898405740234715001820111548600914907617003806652492391686710256274156677887101997175692277729648456087534987616743724646598234466094779540729413583826355145277980479040157075453694250572316638348121571218759769533738721506811175866990851972838466307594226293836934116659685215775643285465895317755892754473332034234495795936183610569571016400535362762699517686781602302045048532131426035260878979892169441059467623523060569285570577199236309888155833013721997933960457784653262076135561769838704166810384309655788983073376941843467117256002645962737847</span>
<span class="token comment">#c = 6944967108815437735428941286784119403138319713455732155925055928646536962597672941805831312130689338014913452081296400272862710447207265099750401657828165836013122848656839100854719965188680097375491193249127725599660383746827031803066026497989298856420216250206035068180963797454792151191071433645946245914916732637007117085199442894495667455544517483404006536607121480678688000420422281380539368519807162175099763891988648117937777951069899975260190018995834904541447562718307433906592021226666885638877020304005614450763081337082838608414756162253825697420493509914578546951634127502393647068722995363753321912676</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
n <span class="token operator">=</span> <span class="token number">17365231154926348364478276872558492775911760603002394353723603461898405740234715001820111548600914907617003806652492391686710256274156677887101997175692277729648456087534987616743724646598234466094779540729413583826355145277980479040157075453694250572316638348121571218759769533738721506811175866990851972838466307594226293836934116659685215775643285465895317755892754473332034234495795936183610569571016400535362762699517686781602302045048532131426035260878979892169441059467623523060569285570577199236309888155833013721997933960457784653262076135561769838704166810384309655788983073376941843467117256002645962737847</span>
c <span class="token operator">=</span> <span class="token number">6944967108815437735428941286784119403138319713455732155925055928646536962597672941805831312130689338014913452081296400272862710447207265099750401657828165836013122848656839100854719965188680097375491193249127725599660383746827031803066026497989298856420216250206035068180963797454792151191071433645946245914916732637007117085199442894495667455544517483404006536607121480678688000420422281380539368519807162175099763891988648117937777951069899975260190018995834904541447562718307433906592021226666885638877020304005614450763081337082838608414756162253825697420493509914578546951634127502393647068722995363753321912676</span>
p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
q <span class="token operator">=</span> n <span class="token operator">//</span> p
e <span class="token operator">=</span> <span class="token number">65537</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
M <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
m <span class="token operator">=</span> M <span class="token operator">//</span> <span class="token number">2021</span> <span class="token operator">//</span> <span class="token number">1001</span> <span class="token operator">//</span> p
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-p-q%E6%B1%82-d">已知 e、p、q，求 d</h2>

<p><strong>例题 BUUCTF-RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
p <span class="token operator">=</span> <span class="token number">473398607161</span>
q <span class="token operator">=</span> <span class="token number">4511491</span>
e <span class="token operator">=</span> <span class="token number">17</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-p-q-%E5%AF%86%E6%96%87-c%E6%B1%82%E6%98%8E%E6%96%87-m">已知 e、p、q、密文 c，求明文 m</h2>

<p><strong>例题 BUUCTF-rsarsa</strong></p>
<p>给出 p、q、e 的值</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>p = 9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483
q = 11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407
e= 65537
</code></pre><p>方法一：使用 RSAtool 工具</p>
<p>使用 rsatool 工具计算 d 的值，直接填入 p,q, 把 e = 65537 转换为 16 进制在再填入，再点击 Calc.D, 即可获得 D 的值。</p>
<p><img src="./RSA_files/1.png" alt=""></p>
<pre data-role="codeBlock" data-info="python" class="language-python">p <span class="token operator">=</span> <span class="token number">9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span>
q <span class="token operator">=</span> <span class="token number">11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span>
C <span class="token operator">=</span> <span class="token number">83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span>
d <span class="token operator">=</span> <span class="token number">56632047571190660567520341028861194862411428416862507034762587229995138605649836960220619903456392752115943299335385163216233744624623848874235303309636393446736347238627793022725260986466957974753004129210680401432377444984195145009801967391196615524488853620232925992387563270746297909112117451398527453977</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
flag <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>C<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</pre><p>方法二：可以直接利用 gmpy2 解决</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">import</span> gmpy2
p <span class="token operator">=</span> <span class="token number">9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span>
q <span class="token operator">=</span> <span class="token number">11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
C <span class="token operator">=</span> <span class="token number">83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span>
<span class="token comment">#1.求d</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#2.求n</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
<span class="token comment">#3.m=pow(c,d,n)</span>
flag <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>C<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-d-n%E6%B1%82-pq">已知 e、d、n,求 pq</h2>

<p><strong>例题</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>XH想要给YF发送一个重要文件，为了不被他人窃取到，XH向YF索要了他的公钥文件信息。
YF将他现在使用的公钥发送给了XH：
-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC0XAw5rV1kqGzeJ1SDB5pTkgO9
RSBgCPm0l5DtdXUDGIJ3dbVC6TOQUHSNFrJPB6AeaSqagyfQCVSUv2EzO/3PLvox
b7hxazHIA2eMZiM3sHcIV9RTdx9pJorDUSB2fV9cnQUiK2smr8X1dt9RCmygpSCf
Ny0ZUYq3DfP/HuErmQIDAQAB
-----END PUBLIC KEY-----
XH用公钥对这个重要的文件进行了加密，然后将密文文件发送给YF：
UtowVjnLpRLTx2oBQlLKDP5cSfvXsz5RB/zO7nqfT6V3wgyK04JOXppCCY/p55rONh2+AZ7NAm3wvu4UwKwZxnw7qtRDSRL6bGZISyrJnyjEXfZHcOSf5BNcjQkJQYRbfN85Z3Ycg+84ABdF+jP7ekQaYikp2duqCoFBJYQcOWw=
但是XH没想到HZ那居然存有YF一组以前用过的私钥信息{n,e,d}：
{126652791247329858012081502617335427176078480967667235544422134698198761482081791188813953951941166617081546172312960216751960777234759603468040766428093969369837780011477003514642408424390144176644572101310535367720328881391192872513206457534291258525724324556727750428833407076738446023533405981578792872857,11666173,78440145437642026565505218176077635100043568658968467746538509828225145179636090827892006864282536091633117590477854513613339188289472952126032503980856086589942743747087799102224535294351908895347839402204845161252154330813186873353157721693911405483196449338177610947843869107506937519564559825768669662629}
就这样，XH发送的文件泄露了。
XH发送给YF的信息即为key文件信息。
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> random
<span class="token keyword">import</span> libnum

d <span class="token operator">=</span> <span class="token number">78440145437642026565505218176077635100043568658968467746538509828225145179636090827892006864282536091633117590477854513613339188289472952126032503980856086589942743747087799102224535294351908895347839402204845161252154330813186873353157721693911405483196449338177610947843869107506937519564559825768669662629</span>
e <span class="token operator">=</span> <span class="token number">11666173</span>
n <span class="token operator">=</span> <span class="token number">126652791247329858012081502617335427176078480967667235544422134698198761482081791188813953951941166617081546172312960216751960777234759603468040766428093969369837780011477003514642408424390144176644572101310535367720328881391192872513206457534291258525724324556727750428833407076738446023533405981578792872857</span>

k <span class="token operator">=</span> e <span class="token operator">*</span> d <span class="token operator">-</span> <span class="token number">1</span>

r <span class="token operator">=</span> k
t <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> r <span class="token operator">//</span> <span class="token number">2</span>
    t <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> r <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

success <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    y <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> r<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> y <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> y <span class="token operator">==</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            success <span class="token operator">=</span> <span class="token boolean">True</span>
            <span class="token keyword">break</span>
        <span class="token keyword">elif</span> x <span class="token operator">==</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            y <span class="token operator">=</span> x

    <span class="token keyword">if</span> success<span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

<span class="token keyword">if</span> success<span class="token punctuation">:</span>
    p <span class="token operator">=</span> libnum<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    q <span class="token operator">=</span> n <span class="token operator">//</span> p
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'P: '</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> p<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Q: '</span> <span class="token operator">+</span> <span class="token string">'%s'</span> <span class="token operator">%</span> q<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Cannot compute P and Q'</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2

c<span class="token operator">=</span><span class="token number">0x52da305639cba512d3c76a014252ca0cfe5c49fbd7b33e5107fcceee7a9f4fa577c20c8ad3824e5e9a42098fe9e79ace361dbe019ecd026df0beee14c0ac19c67c3baad4434912fa6c66484b2ac99f28c45df64770e49fe4135c8d090941845b7cdf3967761c83ef38001745fa33fb7a441a622929d9dbaa0a814125841c396c</span>
e<span class="token operator">=</span><span class="token number">65537</span>
p<span class="token operator">=</span><span class="token number">9626976998826419276843416143425596889733974434851882744368169052238235836115584054010100532560561818209484869817186516716761718401370275591484387689682663</span>
q<span class="token operator">=</span><span class="token number">13156029277183223805880847083808239023127130161857296889657452481663176035839817652134147518151213582890894140345326262383715549586968078944271185038023039</span>
d<span class="token operator">=</span><span class="token number">72222837702293535768001433019745480940909791273992705292676564657233076187624711236528298321435910688825725064493033694255981783829248148386523941024928314873171902399507717591254570081837629624858628871549140866333768191888355910619817655799523654014573134778364308643953515513914429171468097991764936866609</span>

n<span class="token operator">=</span>p<span class="token operator">*</span>q
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>例题2</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> a <span class="token operator">&lt;</span> b<span class="token punctuation">:</span>
     a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a
   <span class="token keyword">while</span> b <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
     temp <span class="token operator">=</span> a <span class="token operator">%</span> b
     a <span class="token operator">=</span> b
     b <span class="token operator">=</span> temp
   <span class="token keyword">return</span> a

<span class="token keyword">def</span> <span class="token function">getpq</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> <span class="token number">1</span>
    q <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> p<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> q<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
        k <span class="token operator">=</span> d <span class="token operator">*</span> e <span class="token operator">-</span> <span class="token number">1</span>
        g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint <span class="token punctuation">(</span> <span class="token number">0</span> <span class="token punctuation">,</span> n <span class="token punctuation">)</span>
        <span class="token keyword">while</span> p<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> q<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> k <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            k <span class="token operator">/=</span> <span class="token number">2</span>
            y <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>k<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
            <span class="token keyword">if</span> y<span class="token operator">!=</span><span class="token number">1</span> <span class="token keyword">and</span> gcd<span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
                p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>y<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
                q <span class="token operator">=</span> n<span class="token operator">/</span>p
    <span class="token keyword">return</span> p<span class="token punctuation">,</span>q

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    n <span class="token operator">=</span> <span class="token number">0xa66791dc6988168de7ab77419bb7fb0c001c62710270075142942e19a8d8c51d053b3e3782a1de5dc5af4ebe99468170114a1dfe67cdc9a9af55d655620bbab</span>
    e <span class="token operator">=</span>  <span class="token number">0x10001</span>
    d <span class="token operator">=</span>  <span class="token number">0x123c5b61ba36edb1d3679904199a89ea80c09b9122e1400c09adcf7784676d01d23356a7d44d6bd8bd50e94bfc723fa87d8862b75177691c11d757692df8881</span>
    p<span class="token punctuation">,</span>q <span class="token operator">=</span> getpq<span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">,</span>d<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">"p: "</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">"q: "</span><span class="token operator">+</span><span class="token builtin">hex</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-q-n-%E5%AF%86%E6%96%87-c%E6%B1%82%E6%98%8E%E6%96%87-m">已知 e、q、n、密文 c,求明文 m</h2>

<p>给了 c, q, n ,e</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> libnum

n <span class="token operator">=</span> <span class="token number">191051885543358947736760989661967468461742175898801910645529003886391047898839624568290216360845330501814019720570327197669064365268607597117598905046895097642708006373182989953758208523010345148200475257538336602695211819055893667974317905617522838840325499754862033348148407978527792816186094297381925119601464149</span>
q <span class="token operator">=</span> <span class="token number">166836705584681518148179737955842605213272207836752187845124149461151181903779374775281529346854786259719545699157508885500818994019618158708212777833768444327658647324555090459233657737950932895018766440119999513331707759691054888319029069397903003240927552065429412176600134636921146805408664505115889561043</span>
c <span class="token operator">=</span> <span class="token number">177177672061025662936587345347268313127241651965256882323180749317515733256088163186914550682635245294414879862810654773207644687262596440870094409378849307188485755700138797651039936445998433830516207630858733090581643592843521203499818069822504434370840254518614785953412492701730326524258672860416318501278155194</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>

p <span class="token operator">=</span> n<span class="token operator">//</span>q
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

d <span class="token operator">=</span> libnum<span class="token punctuation">.</span>invmod<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>

i <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-d-n-c%E6%B1%82-m">已知 d、n、c,求 m</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#求明文</span>
<span class="token keyword">import</span> gmpy2
n <span class="token operator">=</span> <span class="token number">920139713</span>   <span class="token comment">#模数</span>
d <span class="token operator">=</span> <span class="token number">96849619</span>    <span class="token comment">#密钥</span>
c <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
704796792
752211152
274704164
...  #密文
"""</span>
result <span class="token operator">=</span> <span class="token string">""</span>
c_list <span class="token operator">=</span> c<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#print(c_list)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> c_list<span class="token punctuation">:</span>
    result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n1-n2%E6%B1%82-p-q-%E5%88%A9%E7%94%A8%E5%85%AC%E7%BA%A6%E6%95%B0">已知 e、n1、n2,求 p、q (利用公约数)</h2>

<p>如果在两次公钥的加密过程中使用的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 具有相同的素因子，那么可以利用欧几里得算法直接将 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">n_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 分解。</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>n1=9051013965404084482870087864821455535159008696042953021965631089095795348830954383127323853272528967729311045179605407693592665683311660581204886571146327720288455874927281128121117323579691204792399913106627543274457036172455814805715668293705603675386878220947722186914112990452722174363713630297685159669328951520891938403452797650685849523658191947411429068829734053745180460758604283051344339641429819373112365211739216160420494167071996438506850526168389386850499796102003625404245645796271690310748804327
n2=13225948396179603816062046418717214792668512413625091569997524364243995991961018894150059207824093837420451375240550310050209398964506318518991620142575926623780411532257230701985821629425722030608722035570690474171259238153947095310303522831971664666067542649034461621725656234869005501293423975184701929729170077280251436216167293058560030089006140224375425679571181787206982712477261432579537981278055755344573767076951793312062480275004564657590263719816033564139497109942073701755011873153205366238585665743
e=65537
</code></pre><p>求 p q</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>

n1<span class="token operator">=</span><span class="token number">9051013965404084482870087864821455535159008696042953021965631089095795348830954383127323853272528967729311045179605407693592665683311660581204886571146327720288455874927281128121117323579691204792399913106627543274457036172455814805715668293705603675386878220947722186914112990452722174363713630297685159669328951520891938403452797650685849523658191947411429068829734053745180460758604283051344339641429819373112365211739216160420494167071996438506850526168389386850499796102003625404245645796271690310748804327</span>
n2<span class="token operator">=</span><span class="token number">13225948396179603816062046418717214792668512413625091569997524364243995991961018894150059207824093837420451375240550310050209398964506318518991620142575926623780411532257230701985821629425722030608722035570690474171259238153947095310303522831971664666067542649034461621725656234869005501293423975184701929729170077280251436216167293058560030089006140224375425679571181787206982712477261432579537981278055755344573767076951793312062480275004564657590263719816033564139497109942073701755011873153205366238585665743</span>
e<span class="token operator">=</span><span class="token number">65537</span>

<span class="token comment"># p</span>
p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>

q <span class="token operator">=</span> n1<span class="token operator">//</span>p
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-public-key-%E5%AF%86%E6%96%87-c%E6%B1%82%E6%98%8E%E6%96%87-m-%E5%85%AC%E9%92%A5%E6%8F%90%E5%8F%96">已知 public key、密文 c，求明文 m (公钥提取)</h2>

<p>给出一个 pub.key ,一个 flag.enc</p>
<ul>
<li><a href="https://buuoj.cn/challenges#RSA">https://buuoj.cn/challenges#RSA</a></li>
</ul>
<p>用记事本打开 pub.key</p>
<p>通过在线工具解析 RSA 密钥指数、模数</p>
<ul>
<li><a href="http://tool.chacuo.net/cryptrsakeyparse">http://tool.chacuo.net/cryptrsakeyparse</a></li>
</ul>
<p><img src="./RSA_files/2.png" alt=""></p>
<p>模数和指数即为 n 和 e，还需要把 n 从十六进制转换为十进制</p>
<p>用 factordb 分解 n，得到p和q</p>
<p>通过脚本求出明文m</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> rsa

e<span class="token operator">=</span><span class="token number">65537</span>
n<span class="token operator">=</span><span class="token number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span>
p<span class="token operator">=</span><span class="token number">285960468890451637935629440372639283459</span>
q<span class="token operator">=</span><span class="token number">304008741604601924494328155975272418463</span>

phin <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phin<span class="token punctuation">)</span>

key<span class="token operator">=</span>rsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.enc"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>f<span class="token punctuation">,</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>flag.enc 被 base64 的情况</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_OAEP
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode
e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> <span class="token number">79832181757332818552764610761349592984614744432279135328398999801627880283610900361281249973175805069916210179560506497075132524902086881120372213626641879468491936860976686933630869673826972619938321951599146744807653301076026577949579618331502776303983485566046485431039541708467141408260220098592761245010678592347501894176269580510459729633673468068467144199744563731826362102608811033400887813754780282628099443490170016087838606998017490456601315802448567772411623826281747245660954245413781519794295336197555688543537992197142258053220453757666537840276416475602759374950715283890232230741542737319569819793988431443</span>
p <span class="token operator">=</span> <span class="token number">3133337</span>
q <span class="token operator">=</span> <span class="token number">25478326064937419292200172136399497719081842914528228316455906211693118321971399936004729134841162974144246271486439695786036588117424611881955950996219646807378822278285638261582099108339438949573034101215141156156408742843820048066830863814362379885720395082318462850002901605689761876319151147352730090957556940842144299887394678743607766937828094478336401159449035878306853716216548374273462386508307367713112073004011383418967894930554067582453248981022011922883374442736848045920676341361871231787163441467533076890081721882179369168787287724769642665399992556052144845878600126283968890273067575342061776244939</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span><span class="token punctuation">)</span>

key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">,</span>d<span class="token punctuation">,</span>q<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>
cipher <span class="token operator">=</span> PKCS1_OAEP<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    c <span class="token operator">=</span> b64decode<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    flag <span class="token operator">=</span> cipher<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</pre><p><strong>离线解析 RSA 密钥脚本</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA

path<span class="token operator">=</span><span class="token string">r'C:\test.key'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    key<span class="token operator">=</span>RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e=%d'</span><span class="token operator">%</span>key<span class="token punctuation">.</span>e<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n=%d'</span><span class="token operator">%</span>key<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
</pre><p><strong>例题 2016 ASIS Find the flag</strong></p>
<p>文件解压出来，有一个密文，一个公钥，一个 py 脚本。看一下公钥。</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>➜  RSA openssl rsa -pubin -in pubkey.pem -text -modulus
Public-Key: (256 bit)
Modulus:
    00:d8:e2:4c:12:b7:b9:9e:fe:0a:9b:c0:4a:6a:3d:
    f5:8a:2a:94:42:69:b4:92:b7:37:6d:f1:29:02:3f:
    20:61:b9
Exponent: 12405943493775545863 (0xac2ac3e0ca0f5607)
Modulus=D8E24C12B7B99EFE0A9BC04A6A3DF58A2A944269B492B7376DF129023F2061B9
</code></pre><p>这么小的一个 N，先分解一下。</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>p = 311155972145869391293781528370734636009
q = 315274063651866931016337573625089033553
</code></pre><p>再看给的 py 脚本。</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token keyword">import</span> gmpy
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_v1_5

flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span>

<span class="token keyword">def</span> <span class="token function">ext_rsa_encrypt</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> e<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> p <span class="token operator">*</span> q
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
            d <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
            pubkey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>pubkey<span class="token punctuation">)</span>
            enc <span class="token operator">=</span> key<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> enc
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            p <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>p<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> q<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
            q <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">*</span>q<span class="token punctuation">)</span>
            e <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>e<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
e <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>
pubkey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'pubkey.pem'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>pubkey<span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
g <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span>write<span class="token punctuation">(</span>ext_rsa_encrypt<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> e<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>逻辑很简单，读取 flag，重复 30 遍为密文。随机取 p 和 q，生成一个公钥，写入 pubkey.pem，再用脚本中的 ext_rsa_encrypt 函数进行加密，最后将密文写入 flag.enc。</p>
<p>尝试一下解密，提示密文过长，再看加密函数，原来当加密失败时，函数会跳到异常处理，以一定算法重新取更大的 p和 q，直到加密成功。</p>
<p>那么我们只要也写一个相应的解密函数即可。</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token keyword">import</span> gmpy
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_v1_5

<span class="token keyword">def</span> <span class="token function">ext_rsa_decrypt</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> e<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> p <span class="token operator">*</span> q
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
            d <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
            privatekey <span class="token operator">=</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">long</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            key <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>privatekey<span class="token punctuation">)</span>
            de_error <span class="token operator">=</span> <span class="token string">''</span>
            enc <span class="token operator">=</span> key<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> de_error<span class="token punctuation">)</span>
            <span class="token keyword">return</span> enc
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> error<span class="token punctuation">:</span>
            <span class="token keyword">print</span> error
            p <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>p<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> q<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
            q <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">*</span>q<span class="token punctuation">)</span>
            e <span class="token operator">=</span> gmpy<span class="token punctuation">.</span>next_prime<span class="token punctuation">(</span>e<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> <span class="token number">311155972145869391293781528370734636009</span>
q <span class="token operator">=</span> <span class="token number">315274063651866931016337573625089033553</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
e <span class="token operator">=</span> <span class="token number">12405943493775545863</span>
<span class="token comment"># pubkey = RSA.construct((long(n), long(e)))</span>
<span class="token comment"># f = open('pubkey.pem', 'w')</span>
<span class="token comment"># f.write(pubkey.exportKey())</span>
g <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
msg <span class="token operator">=</span> g<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
flag <span class="token operator">=</span> ext_rsa_decrypt<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> e<span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
<span class="token keyword">print</span> flag
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n1-n2-%E6%A8%A1%E4%B8%8D%E4%BA%92%E7%B4%A0-vn-crt">已知 e、n1、n2 (模不互素) (v&amp;n-CRT)</h2>

<p><strong>例题1</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

ms <span class="token operator">=</span> <span class="token punctuation">[</span>getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
p <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> x<span class="token operator">*</span>y<span class="token punctuation">,</span> ms<span class="token punctuation">)</span>
x <span class="token operator">=</span> getRandomRange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
cs <span class="token operator">=</span> <span class="token punctuation">[</span>x <span class="token operator">%</span> m  <span class="token keyword">for</span> m <span class="token keyword">in</span> ms<span class="token punctuation">]</span>

flag <span class="token operator">=</span> <span class="token string">"flag{"</span> <span class="token operator">+</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span>
<span class="token comment"># assert("4b93deeb" in flag)</span>

<span class="token comment"># ms = [284461942441737992421992210219060544764, 218436209063777179204189567410606431578, 288673438109933649911276214358963643204, 239232622368515797881077917549177081575, 206264514127207567149705234795160750411, 338915547568169045185589241329271490503, 246545359356590592172327146579550739141, 219686182542160835171493232381209438048]</span>
<span class="token comment"># cs = [273520784183505348818648859874365852523, 128223029008039086716133583343107528289, 5111091025406771271167772696866083419, 33462335595116820423587878784664448439, 145377705960376589843356778052388633917, 128158421725856807614557926615949143594, 230664008267846531848877293149791626711, 94549019966480959688919233343793910003]</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> itertools

<span class="token comment">#模板</span>
<span class="token keyword">def</span> <span class="token function">uni</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span> Q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r1<span class="token punctuation">,</span> m1 <span class="token operator">=</span> P
    r2<span class="token punctuation">,</span> m2 <span class="token operator">=</span> Q
    d <span class="token operator">=</span> gcd<span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>r2<span class="token operator">-</span>r1<span class="token punctuation">)</span> <span class="token operator">%</span> d <span class="token operator">==</span> <span class="token number">0</span>
    l <span class="token operator">=</span> gcdext<span class="token punctuation">(</span>m1<span class="token operator">//</span>d<span class="token punctuation">,</span> m2<span class="token operator">//</span>d<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>r1 <span class="token operator">+</span> <span class="token punctuation">(</span>r2<span class="token operator">-</span>r1<span class="token punctuation">)</span><span class="token operator">//</span>d<span class="token operator">*</span>l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>m1<span class="token punctuation">)</span> <span class="token operator">%</span> lcm<span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span><span class="token punctuation">,</span>lcm<span class="token punctuation">(</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">CRT</span><span class="token punctuation">(</span>eq<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>uni<span class="token punctuation">,</span> eq<span class="token punctuation">)</span>
<span class="token comment">#模板</span>
ms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">284461942441737992421992210219060544764</span><span class="token punctuation">,</span> <span class="token number">218436209063777179204189567410606431578</span><span class="token punctuation">,</span> <span class="token number">288673438109933649911276214358963643204</span><span class="token punctuation">,</span> <span class="token number">239232622368515797881077917549177081575</span><span class="token punctuation">,</span> <span class="token number">206264514127207567149705234795160750411</span><span class="token punctuation">,</span> <span class="token number">338915547568169045185589241329271490503</span><span class="token punctuation">,</span> <span class="token number">246545359356590592172327146579550739141</span><span class="token punctuation">,</span> <span class="token number">219686182542160835171493232381209438048</span><span class="token punctuation">]</span>
cs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">273520784183505348818648859874365852523</span><span class="token punctuation">,</span> <span class="token number">128223029008039086716133583343107528289</span><span class="token punctuation">,</span> <span class="token number">5111091025406771271167772696866083419</span><span class="token punctuation">,</span> <span class="token number">33462335595116820423587878784664448439</span><span class="token punctuation">,</span> <span class="token number">145377705960376589843356778052388633917</span><span class="token punctuation">,</span> <span class="token number">128158421725856807614557926615949143594</span><span class="token punctuation">,</span> <span class="token number">230664008267846531848877293149791626711</span><span class="token punctuation">,</span> <span class="token number">94549019966480959688919233343793910003</span><span class="token punctuation">]</span>

x<span class="token punctuation">,</span>Lcm <span class="token operator">=</span> CRT<span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>cs<span class="token punctuation">,</span>ms<span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token comment">#(解，最小公倍数)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token string">"flag{"</span> <span class="token operator">+</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>x <span class="token operator">+</span> i<span class="token operator">*</span>Lcm<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span>
    <span class="token keyword">if</span> <span class="token string">"4b93deeb"</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
</pre><p><strong>例题2 BUUCTF: RSA5</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>N is 18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727
e is 65537
message is 0x8BD7BF995BF9E16A0D04ADB49A2411C74FFDB0DB4F35DB3A79A1B44691947C9824085BC4CA5F7F4EFA3C8FD0BC3E870AA6D5E15307A63A2172C44C5903D35785B8D06B51651EE7106B070D5A6AABA089AB67609661265B74914C865F863DC1D2DC08CE0B026107A74EC3FDC62666B50110B9D15A243EAAD6F53646929A3369285404868E42DD0BBE92D956018E3C0B36EF5E9516E433228CFDD06D6E662EC0A9A31061EA11F61CA17EABF43D2D4977FC9D6FC53AB6DC01509401B8D9A46B59A9ADAA97D54CC50C27445E4C21B893510620EC3566AD6E8727FA147437B207505217E6F2DF009E2286C8354D281374D7802D08A2062FE48DBF135BBCAB120EBF84

N is 20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951
e is 65537
message is 0x8C3CF3161AA3E37831030985C60566A7604688B73E5B1D3B36E72EF06ED4F71289EFE80E0D94BD755034E6C210F17DA85B9D0388F3AD104C68BC514A8EB1569A109EB5F266F7C5FA4DDFA638258949B43D4CF1406720CCD4CA11E74FDF8AEB35C56A79781C87157FC4213573329C5B0FF411F8A4F34580AA103DB9FD403C0D409FA11860A7C4595FDC49DC2CF94E5112B772E5DEC8F17E24B10A7FD7A95DCB87BE5E27C32FC931574A7847BC506A61EFE9DB3D3F612143845FE80D7B3EA548B886A67A29CBDB2775B1F91178B6DA763F1A6ECFF46592E4C7FFAAB6C9FEF29D9CB9E035A3D98ECFFB26BA2EEAA56D1CD096E6A2CF9A58086CAD7718DDA5CB0C1B
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># coding=utf-8</span>
<span class="token comment"># kali</span>
<span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> libnum

e <span class="token operator">=</span> <span class="token number">65537</span>

n1 <span class="token operator">=</span> <span class="token number">18674375108313094928585156581138941368570022222190945461284402673204018075354069827186085851309806592398721628845336840532779579197302984987661547245423180760958022898546496524249201679543421158842103496452861932183144343315925106154322066796612415616342291023962127055311307613898583850177922930685155351380500587263611591893137588708003711296496548004793832636078992866149115453883484010146248683416979269684197112659302912316105354447631916609587360103908746719586185593386794532066034112164661723748874045470225129298518385683561122623859924435600673501186244422907402943929464694448652074412105888867178867357727</span>
c1 <span class="token operator">=</span> <span class="token number">17653513908193841430381192796640003747132390557678645430610910991354476958328389297917489962745902930251335933466111927668345140256673021534967388288465161047205518695840070490294927400453333010877712248730815997183319817500307013220133520427896383780673542896400144159134516495539932726097145695761846716747837834842737050589233701120272457464228295832876615855666867361322514261558699292549332818967428778080462971929279160702973663270646086286427472899409371531891056776666955010462523737377821328665970587252791357706352644530707967270107046480834325297013452841845739940949935367658992513975395493347894299115396</span>
n2 <span class="token operator">=</span> <span class="token number">20071978783607427283823783012022286910630968751671103864055982304683197064862908267206049336732205051588820325894943126769930029619538705149178241710069113634567118672515743206769333625177879492557703359178528342489585156713623530654319500738508146831223487732824835005697932704427046675392714922683584376449203594641540794557871881581407228096642417744611261557101573050163285919971711214856243031354845945564837109657494523902296444463748723639109612438012590084771865377795409000586992732971594598355272609789079147061852664472115395344504822644651957496307894998467309347038349470471900776050769578152203349128951</span>
c2 <span class="token operator">=</span> <span class="token number">17703418041505306152073458538503135897754984424071794466644562266431181060728318040282801042149118342360027422484396128745034956140354361901632406866186564534931053349212034885774362292778458647869852645996457726182679077898701048595872304351277426725663320053473208970894789079230038061032457306065282204526542063432679108994733084297061352786852858328285762179890953620089926235239564724967387127700008246367672943098355450451356607649477991088173458143886399210993972509485729321644664717313326930856634318205937719887836747883279921852969811420674674912662202051891970315411399990536209381913231508350536491142171</span>

p <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>
q <span class="token operator">=</span> n1 <span class="token operator">//</span> p
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e1-e2-n-%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BB-%E6%A8%A1%E4%B8%8D%E4%BA%92%E8%B4%A8">已知 e1、e2、n (共模攻击) (模不互质)</h2>

<p>如果在 RSA 的使用中使用了相同的模 n 对相同的明文 m 进行了加密，那么就可以在不分解 n 的情况下还原出明文 m 的值。</p>
<p>出现两个加密使用相同的模，可以在不知道私钥的情况下得到明文，这就是RSA中的共模攻击。</p>
<p><strong>例题 RSA3</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>c1=22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361

n=22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801

e1=11187289

c2=18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397

e2=9647291
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert
<span class="token comment"># 欧几里得算法</span>
<span class="token keyword">def</span> <span class="token function">egcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">=</span> egcd<span class="token punctuation">(</span>b <span class="token operator">%</span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>g<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>b <span class="token operator">//</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  n <span class="token operator">=</span> <span class="token number">22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span>
  c1 <span class="token operator">=</span> <span class="token number">22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span>
  c2 <span class="token operator">=</span> <span class="token number">18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span>
  e1 <span class="token operator">=</span> <span class="token number">11187289</span>
  e2 <span class="token operator">=</span> <span class="token number">9647291</span>
  s <span class="token operator">=</span> egcd<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
  s1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  s2 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token comment"># 求模反元素</span>
  <span class="token keyword">if</span> s1<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span>
    s1 <span class="token operator">=</span> <span class="token operator">-</span> s1
    c1 <span class="token operator">=</span> invert<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
  <span class="token keyword">elif</span> s2<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">:</span>
    s2 <span class="token operator">=</span> <span class="token operator">-</span> s2
    c2 <span class="token operator">=</span> invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

  m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s1<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">*</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span>s2<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">%</span> n
  <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>结果转16进制得到 flag</p>
<p>注意: 有的题目会把 c1、c2 转编码 base64,可以用以下代码还原</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>c1 = int.from_bytes(base64.b64decode('R3Noy6r3WLItytAmb4FmHEygoilucEEZbO9ZYXx5JN03HNpBLDx7fXd2fl+UL5+11RCs/y0qlTGURWWDtG66eNLzGwNpAKiVj6I7RtUJl2Pcm3NvFeAFwI9UsVREyh7zIV6sI9ZP8l/2GVDorLAz5ULW+f0OINGhJmZm8FL/aDnlfTElhQ87LPicWpXYoMtyr6WrxjK6Ontn8BqCt0EjQ7TeXZhxIH9VTPWjDmFdmOqaqdVIT+LZemTgLNESwM5nn4g5S3aFDFwj1YiDYl0/+8etvKfOrfoKOwR0CxsRHagwdUUTES8EcHLmMGCxCkDZn3SzmmA6Nb3lgLeSgG8P1A=='), 'big')
</code></pre><p><strong>例题 very hard RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> libnum <span class="token keyword">import</span> n2s<span class="token punctuation">,</span>s2n
n <span class="token operator">=</span> <span class="token number">0x00b0bee5e3e9e5a7e8d00b493355c618fc8c7d7d03b82e409951c182f398dee3104580e7ba70d383ae5311475656e8a964d380cb157f48c951adfa65db0b122ca40e42fa709189b719a4f0d746e2f6069baf11cebd650f14b93c977352fd13b1eea6d6e1da775502abff89d3a8b3615fd0db49b88a976bc20568489284e181f6f11e270891c8ef80017bad238e363039a458470f1749101bc29949d3a4f4038d463938851579c7525a69984f15b5667f34209b70eb261136947fa123e549dfff00601883afd936fe411e006e4e93d1a00b0fea541bbfc8c5186cb6220503a94b2413110d640c77ea54ba3220fc8f4cc6ce77151e29b3e06578c478bd1bebe04589ef9a197f6f806db8b3ecd826cad24f5324ccdec6e8fead2c2150068602c8dcdc59402ccac9424b790048ccdd9327068095efa010b7f196c74ba8c37b128f9e1411751633f78b7b9e56f71f77a1b4daad3fc54b5e7ef935d9a72fb176759765522b4bbc02e314d5c06b64d5054b7b096c601236e6ccf45b5e611c805d335dbab0c35d226cc208d8ce4736ba39a0354426fae006c7fe52d5267dcfb9c3884f51fddfdf4a9794bcfe0e1557113749e6c8ef421dba263aff68739ce00ed80fd0022ef92d3488f76deb62bdef7bea6026f22a1d25aa2a92d124414a8021fe0c174b9803e6bb5fad75e186a946a17280770f1243f4387446ccceb2222a965cc30b3929</span>
e1 <span class="token operator">=</span> <span class="token number">17</span>
e2 <span class="token operator">=</span> <span class="token number">65537</span>

fo1 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc1'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
fo2 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc2'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
datafo1 <span class="token operator">=</span> fo1<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
message1 <span class="token operator">=</span> s2n<span class="token punctuation">(</span>datafo1<span class="token punctuation">)</span>
fo1<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
datafo2 <span class="token operator">=</span> fo2<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
message2 <span class="token operator">=</span> s2n<span class="token punctuation">(</span>datafo2<span class="token punctuation">)</span>
fo2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>message1<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>message2<span class="token punctuation">)</span>
<span class="token comment">#message1 = 3453520592723443935451151545245025864232388871721682326408915024349804062041976702364728660682912396903968193981131553111537349</span>

<span class="token comment">#message2 = 5672818026816293344070119332536629619457163570036305296869053532293105379690793386019065754465292867769521736414170803238309535</span>
<span class="token comment"># s &amp; t</span>
gcd<span class="token punctuation">,</span> s<span class="token punctuation">,</span> t <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
<span class="token keyword">if</span> s <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token operator">-</span>s
    message1 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>message1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">if</span> t <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> <span class="token operator">-</span>t
    message2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>message2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
plain <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>message1<span class="token punctuation">,</span> s<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>message2<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span> <span class="token punctuation">(</span>plain<span class="token punctuation">)</span>
</pre><p><strong>例题 [61dctf]rsappend</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python">flag <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">32</span>

<span class="token keyword">import</span> primefac
<span class="token keyword">import</span> random
<span class="token keyword">from</span> os <span class="token keyword">import</span> urandom
<span class="token keyword">def</span> <span class="token function">genprime</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l<span class="token operator">/=</span><span class="token number">8</span>
    big<span class="token operator">=</span><span class="token number">1</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
        big<span class="token operator">=</span>big<span class="token operator">&lt;&lt;</span><span class="token number">8</span>
        l<span class="token operator">-=</span><span class="token number">1</span>
    big<span class="token operator">-=</span><span class="token number">1</span>
    small<span class="token operator">=</span><span class="token punctuation">(</span>big<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">4</span>
    temp<span class="token operator">=</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>small<span class="token punctuation">,</span>big<span class="token punctuation">)</span>
    <span class="token keyword">return</span> primefac<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">str2num</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">padding</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> s<span class="token operator">+</span>urandom<span class="token punctuation">(</span><span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">rsappend</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> genprime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> genprime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    result<span class="token operator">=</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">]</span>
    pm<span class="token operator">=</span>padding<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        e<span class="token operator">=</span>genprime<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
        c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>str2num<span class="token punctuation">(</span>pm<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"###"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>rsappend<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> rsa
<span class="token keyword">from</span> rsa <span class="token keyword">import</span> transform<span class="token punctuation">,</span>core

n <span class="token operator">=</span> <span class="token number">130129008900473203968454456805638875182255844172836031362469765750555629223299054613072677100571707156698316733582683118539756860001556017029333867329591302318262912728008327902112481960175532302595162289611406978353816368008691640641366763939266242207191229240305820321249712345088877729541037319788659353057396178127928848886417880913823432701577855911982710310391664759040416918636673098245499680559140960154217578440590540485803953844560093151975252604098243460784073934982164384904788470380402066708313893480356219937915540825156266934523595689350157227336528136089157698775968997579723271988825396396444999743016035145444220925369592263295741687879468786947998534483539986779457827253891091252408156073413533385415338751818544323853074296042153599429749378847870780593975579477549218822682233583377677693108437331184962345568217859524495625257015837972947971787321584159575618388588687948368216479955807108888453821700067186732627409832722329355336479016104249514839541606562090752437124270651936485389358065775555250883907067083447197860848471728871909151915883316674512739238840179296263390441457949281128267215916340163366686542160467601357340644950755337706786366316621293666173843528346692669268972961669116101104865152273</span>
e1 <span class="token operator">=</span> <span class="token number">3493354673</span>
e2 <span class="token operator">=</span> <span class="token number">340864687</span>
s <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">)</span>
s1 <span class="token operator">=</span> s<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
s2 <span class="token operator">=</span> <span class="token operator">-</span>s<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
c1 <span class="token operator">=</span> <span class="token number">95302089605615051645253770338205531172677353498946580682786822045513597212422921981567826452072575982096979591435896082106066368909398510427324124083956090397824543655853708684901332136907086372208856759943292176759073194584568350898675282883285945088425893961769183074018286761903249180704401358403273776903672507958464947244563165564687651203497198317095965140433811056890812018746508121991041040929574993486548175817290824525606551459788553765629416110310419007396912225733599205599864440826319234419035248234403040065378375700430311931418759746223148198205862641252459687694589780856855757703678024583642215076094232444641853081607984934672271461513190437757388818064739151861157236855430066735235471068167602037785718403200529481153399754491247323829122718485697100562237822159608309949585990842201041193231738706398444530233533281604482892716292766323711237917277799500317596333142843576977429802405873159965636003943698854699972663575602383960580472190300576561953143218321528070200681456278974433060654128626428761278953024384187213765974659768657721533448706022075747036347982370028705538843276631102928500802573434484354218539824751579164697748967608238067706842975984077663380114254296902060435479795741671231918448537178</span>
c2 <span class="token operator">=</span> <span class="token number">105918022590727868761989308441554006325741233318901416621101439141134508212362387984949614887131575960019253866892976283979646611794365370050551871112439674346802340152058463892106629344277362169322187627579360245792142005899616101515519718660483000821415412306495286717542069436530262341500852884860324349096274655178057271529986597578695272732947460673640986877589225588415523871081101162696385279491410034057376225511693022693861779342120101749193614060384925056132593068290214170342896671210026723193650534803792328917982049779674425511275821311773130342656939142955431868128759911406827872932920704284125816103225607727270365652734742083302757644298457617564597237089509337896240249999242834787525341715546373108420197569425092674224333823552432226153066667988737348643469923827028254712179077001007265954488404167147591307425224250970874724864947175449960116685682348915647317191880538777148647712260093008241728509225817352093441924045801257015598517963598799676359095235231066752986688784477694024390356904157694178691411759003004184256950519184836209393583431328640341243629167223114681734264945594931213193459079614652400888215324779908031661350565230685273639666615465296133672907093946148188967451042301308884510424218096</span>
c2 <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>s1<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span>s2<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><p><strong>例题 [BJDCTF2020]rsa_output</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>{21058339337354287847534107544613605305015441090508924094198816691219103399526800112802416383088995253908857460266726925615826895303377801614829364034624475195859997943146305588315939130777450485196290766249612340054354622516207681542973756257677388091926549655162490873849955783768663029138647079874278240867932127196686258800146911620730706734103611833179733264096475286491988063990431085380499075005629807702406676707841324660971173253100956362528346684752959937473852630145893796056675793646430793578265418255919376323796044588559726703858429311784705245069845938316802681575653653770883615525735690306674635167111,2767}

{21058339337354287847534107544613605305015441090508924094198816691219103399526800112802416383088995253908857460266726925615826895303377801614829364034624475195859997943146305588315939130777450485196290766249612340054354622516207681542973756257677388091926549655162490873849955783768663029138647079874278240867932127196686258800146911620730706734103611833179733264096475286491988063990431085380499075005629807702406676707841324660971173253100956362528346684752959937473852630145893796056675793646430793578265418255919376323796044588559726703858429311784705245069845938316802681575653653770883615525735690306674635167111,3659}

message1=20152490165522401747723193966902181151098731763998057421967155300933719378216342043730801302534978403741086887969040721959533190058342762057359432663717825826365444996915469039056428416166173920958243044831404924113442512617599426876141184212121677500371236937127571802891321706587610393639446868836987170301813018218408886968263882123084155607494076330256934285171370758586535415136162861138898728910585138378884530819857478609791126971308624318454905992919405355751492789110009313138417265126117273710813843923143381276204802515910527468883224274829962479636527422350190210717694762908096944600267033351813929448599

message2=11298697323140988812057735324285908480504721454145796535014418738959035245600679947297874517818928181509081545027056523790022598233918011261011973196386395689371526774785582326121959186195586069851592467637819366624044133661016373360885158956955263645614345881350494012328275215821306955212788282617812686548883151066866149060363482958708364726982908798340182288702101023393839781427386537230459436512613047311585875068008210818996941460156589314135010438362447522428206884944952639826677247819066812706835773107059567082822312300721049827013660418610265189288840247186598145741724084351633508492707755206886202876227
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> libnum

<span class="token keyword">def</span> <span class="token function">exgcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> b<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> exgcd<span class="token punctuation">(</span>b<span class="token punctuation">,</span> a<span class="token operator">%</span>b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> y<span class="token punctuation">,</span> x<span class="token operator">-</span>a<span class="token operator">//</span>b<span class="token operator">*</span>y

n <span class="token operator">=</span> <span class="token number">21058339337354287847534107544613605305015441090508924094198816691219103399526800112802416383088995253908857460266726925615826895303377801614829364034624475195859997943146305588315939130777450485196290766249612340054354622516207681542973756257677388091926549655162490873849955783768663029138647079874278240867932127196686258800146911620730706734103611833179733264096475286491988063990431085380499075005629807702406676707841324660971173253100956362528346684752959937473852630145893796056675793646430793578265418255919376323796044588559726703858429311784705245069845938316802681575653653770883615525735690306674635167111</span>
e1 <span class="token operator">=</span> <span class="token number">2767</span>
c1 <span class="token operator">=</span> <span class="token number">20152490165522401747723193966902181151098731763998057421967155300933719378216342043730801302534978403741086887969040721959533190058342762057359432663717825826365444996915469039056428416166173920958243044831404924113442512617599426876141184212121677500371236937127571802891321706587610393639446868836987170301813018218408886968263882123084155607494076330256934285171370758586535415136162861138898728910585138378884530819857478609791126971308624318454905992919405355751492789110009313138417265126117273710813843923143381276204802515910527468883224274829962479636527422350190210717694762908096944600267033351813929448599</span>
e2 <span class="token operator">=</span> <span class="token number">3659</span>
c2 <span class="token operator">=</span> <span class="token number">11298697323140988812057735324285908480504721454145796535014418738959035245600679947297874517818928181509081545027056523790022598233918011261011973196386395689371526774785582326121959186195586069851592467637819366624044133661016373360885158956955263645614345881350494012328275215821306955212788282617812686548883151066866149060363482958708364726982908798340182288702101023393839781427386537230459436512613047311585875068008210818996941460156589314135010438362447522428206884944952639826677247819066812706835773107059567082822312300721049827013660418610265189288840247186598145741724084351633508492707755206886202876227</span>

a<span class="token punctuation">,</span> b <span class="token operator">=</span> exgcd<span class="token punctuation">(</span>e1<span class="token punctuation">,</span> e2<span class="token punctuation">)</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> a<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c2<span class="token punctuation">,</span> b<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-e-c-p-q-%E6%89%B9%E9%87%8F%E6%B1%82-m-n-%E5%88%86%E8%A7%A3-roll-%E6%8C%89%E8%A1%8C%E5%8A%A0%E5%AF%86">已知 n、e、c、p、q 批量求 m (n 分解) (Roll 按行加密)</h2>

<p><strong>例题 RSAROLL</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>{920139713,19}

704796792
752211152
274704164
18414022
368270835
483295235
263072905
459788476
483295235
459788476
663551792
475206804
459788476
428313374
475206804
459788476
425392137
704796792
458265677
341524652
483295235
534149509
425392137
428313374
425392137
341524652
458265677
263072905
483295235
828509797
341524652
425392137
475206804
428313374
483295235
475206804
459788476
306220148
</code></pre><p>分解 N 得 p、q</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
N<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token number">920139713</span><span class="token punctuation">,</span><span class="token number">49891</span><span class="token punctuation">,</span><span class="token number">18443</span><span class="token punctuation">,</span><span class="token number">19</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
result<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"c.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
  <span class="token keyword">for</span> c <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    c<span class="token operator">=</span>c<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span>d<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

flag<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> result<span class="token punctuation">:</span>
  flag<span class="token operator">+=</span>i
  <span class="token keyword">print</span> flag
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-d-pq-p1q1-%E4%BB%A5%E5%8F%8A%E5%AF%86%E6%96%87c%E6%B1%82%E6%98%8E%E6%96%87m">已知 e、d、p+q、(p+1)(q+1)、以及密文C，求明文m</h2>

<p><strong>例题 [GUET-CTF2019]BabyRSA</strong></p>
<p>已知p+q、(p+1)(q+1)、e、d,以及密文c.</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>p+q : 0x1232fecb92adead91613e7d9ae5e36fe6bb765317d6ed38ad890b4073539a6231a6620584cea5730b5af83a3e80cf30141282c97be4400e33307573af6b25e2ea

(p+1)(q+1) : 0x5248becef1d925d45705a7302700d6a0ffe5877fddf9451a9c1181c4d82365806085fd86fbaab08b6fc66a967b2566d743c626547203b34ea3fdb1bc06dd3bb765fd8b919e3bd2cb15bc175c9498f9d9a0e216c2dde64d81255fa4c05a1ee619fc1fc505285a239e7bc655ec6605d9693078b800ee80931a7a0c84f33c851740

e : 0xe6b1bee47bd63f615c7d0a43c529d219

d : 0x2dde7fbaed477f6d62838d55b0d0964868cf6efb2c282a5f13e6008ce7317a24cb57aec49ef0d738919f47cdcd9677cd52ac2293ec5938aa198f962678b5cd0da344453f521a69b2ac03647cdd8339f4e38cec452d54e60698833d67f9315c02ddaa4c79ebaa902c605d7bda32ce970541b2d9a17d62b52df813b2fb0c5ab1a5

enc_flag : 0x50ae00623211ba6089ddfae21e204ab616f6c9d294e913550af3d66e85d0c0693ed53ed55c46d8cca1d7c2ad44839030df26b70f22a8567171a759b76fe5f07b3c5a6ec89117ed0a36c0950956b9cde880c575737f779143f921d745ac3bb0e379c05d9a3cc6bf0bea8aa91e4d5e752c7eb46b2e023edbc07d24a7c460a34a9a
</code></pre><p>利用 RSA 的解密公式：</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>M=C^d  mod n
n = p*q
</code></pre><p>所以推算出求n的公式</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>n = (p+1)*(q+1) - (p+q) - 1
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> libnum
a <span class="token operator">=</span> <span class="token number">0x1232fecb92adead91613e7d9ae5e36fe6bb765317d6ed38ad890b4073539a6231a6620584cea5730b5af83a3e80cf30141282c97be4400e33307573af6b25e2ea</span>
b <span class="token operator">=</span> <span class="token number">0x5248becef1d925d45705a7302700d6a0ffe5877fddf9451a9c1181c4d82365806085fd86fbaab08b6fc66a967b2566d743c626547203b34ea3fdb1bc06dd3bb765fd8b919e3bd2cb15bc175c9498f9d9a0e216c2dde64d81255fa4c05a1ee619fc1fc505285a239e7bc655ec6605d9693078b800ee80931a7a0c84f33c851740</span>
e <span class="token operator">=</span> <span class="token number">0xe6b1bee47bd63f615c7d0a43c529d219</span>
d <span class="token operator">=</span> <span class="token number">0x2dde7fbaed477f6d62838d55b0d0964868cf6efb2c282a5f13e6008ce7317a24cb57aec49ef0d738919f47cdcd9677cd52ac2293ec5938aa198f962678b5cd0da344453f521a69b2ac03647cdd8339f4e38cec452d54e60698833d67f9315c02ddaa4c79ebaa902c605d7bda32ce970541b2d9a17d62b52df813b2fb0c5ab1a5</span>
c<span class="token operator">=</span> <span class="token number">0x50ae00623211ba6089ddfae21e204ab616f6c9d294e913550af3d66e85d0c0693ed53ed55c46d8cca1d7c2ad44839030df26b70f22a8567171a759b76fe5f07b3c5a6ec89117ed0a36c0950956b9cde880c575737f779143f921d745ac3bb0e379c05d9a3cc6bf0bea8aa91e4d5e752c7eb46b2e023edbc07d24a7c460a34a9a</span>

n <span class="token operator">=</span> b<span class="token operator">-</span>a<span class="token operator">-</span><span class="token number">1</span>

m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#（n2s将数值转化为字符串）</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-pq-p-q-c%E6%B1%82-m">已知 e、p+q、p-q、c,求 m</h2>

<pre data-role="codeBlock" data-info="" class="language-"><code>e=10047043
p+q=17864794979971570785662379545162618804766262787343692042702758269883889880586532847627739497710377379133808960631449783320988646048192570215912044938749524

p-q=13621141169596935340266315340985039224136344718074933889533949465140677745823364383681578938184100437272345798403178955533646651900746775131413434846238

c=69438002917126922598100563033498117313059846761810276515472583443315330486249787234883817833581207875555700236192620757221236321345758328116228588060369915110756725993793015468270271016511452766921167161147012916764025925564206014322176252492257911319837663802977180850930169713449697400352784352130585038509
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2

a <span class="token operator">=</span> <span class="token number">17864794979971570785662379545162618804766262787343692042702758269883889880586532847627739497710377379133808960631449783320988646048192570215912044938749524</span>
b <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">13621141169596935340266315340985039224136344718074933889533949465140677745823364383681578938184100437272345798403178955533646651900746775131413434846238</span>
p <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
q <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>

e <span class="token operator">=</span> <span class="token number">10047043</span>
c <span class="token operator">=</span> <span class="token number">69438002917126922598100563033498117313059846761810276515472583443315330486249787234883817833581207875555700236192620757221236321345758328116228588060369915110756725993793015468270271016511452766921167161147012916764025925564206014322176252492257911319837663802977180850930169713449697400352784352130585038509</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">.</span>fromhex<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-p2q2-p-q-c%E6%B1%82-m">已知 e、p<sup>2+q</sup>2、p-q、c,求 m</h2>

<pre data-role="codeBlock" data-info="" class="language-"><code>e=16503007
p^2+q^2=191146428321980817795212641215162686047357669332416091297833006786164494043847255271801778794176251547557019160665613701693648426384225631886269021243151558943679889418338368241412422569687766964729377744288202166111647562390360336532132291873672355362548716474909574058763233055538919589653219840975053365498
p-q=1865820751943598188049386659480047616343158342079231985092439521370754039600355931593479747035299328827429947497928889872991706097661349587881273476898614
c=71435959890060714775860283845070770807336375283620037026996634891859264207142541968322856382509744924514694875687521774912766235301962220737852369100226573826919817437051680292115308196993702234134879004401179756857997717891870139157894436683194842746758664747016081138911302375586228857165059760605089440241
flag=??????
</code></pre><p>先解一个二元二次方程得到 p、q</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> sympy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> sympy<span class="token punctuation">.</span>abc <span class="token keyword">import</span> p<span class="token punctuation">,</span>q
nn<span class="token operator">=</span><span class="token number">191146428321980817795212641215162686047357669332416091297833006786164494043847255271801778794176251547557019160665613701693648426384225631886269021243151558943679889418338368241412422569687766964729377744288202166111647562390360336532132291873672355362548716474909574058763233055538919589653219840975053365498</span>
qjp<span class="token operator">=</span><span class="token number">1865820751943598188049386659480047616343158342079231985092439521370754039600355931593479747035299328827429947497928889872991706097661349587881273476898614</span>
c<span class="token operator">=</span><span class="token number">71435959890060714775860283845070770807336375283620037026996634891859264207142541968322856382509744924514694875687521774912766235301962220737852369100226573826919817437051680292115308196993702234134879004401179756857997717891870139157894436683194842746758664747016081138911302375586228857165059760605089440241</span>
aa<span class="token operator">=</span>solve<span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token operator">*</span>p<span class="token operator">+</span>q<span class="token operator">*</span>q<span class="token operator">-</span>nn<span class="token punctuation">,</span>p<span class="token operator">-</span>q<span class="token operator">+</span>qjp<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>p<span class="token punctuation">,</span>q<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span>
</pre><p>解出二个解，一正一负解，取正解, 下面就是已知 p、q、e，c 解 m</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">as</span> cun
pp<span class="token operator">=</span><span class="token number">8798630734838685755098169164685635077446563893231618827158137616682095790713459033344785846949228947710625064394286358694815889702351555025144339209119743</span>
qq<span class="token operator">=</span><span class="token number">10664451486782283943147555824165682693789722235310850812250577138052849830313814964938265593984528276538055011892215248567807595800012904613025612686018357</span>
e<span class="token operator">=</span><span class="token number">16503007</span>
c<span class="token operator">=</span><span class="token number">71435959890060714775860283845070770807336375283620037026996634891859264207142541968322856382509744924514694875687521774912766235301962220737852369100226573826919817437051680292115308196993702234134879004401179756857997717891870139157894436683194842746758664747016081138911302375586228857165059760605089440241</span>
n<span class="token operator">=</span>qq<span class="token operator">*</span>pp
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>pp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>qq<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cun<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-p-n-c-e%E7%9A%84%E8%8C%83%E5%9B%B4%E6%B1%82-m">已知 p、n、c、e的范围,求 m</h2>

<p><strong>例题 [HDCTF2019]bbbbbbrsa</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python">p <span class="token operator">=</span> <span class="token number">177077389675257695042507998165006460849</span>
n <span class="token operator">=</span> <span class="token number">37421829509887796274897162249367329400988647145613325367337968063341372726061</span>
c <span class="token operator">=</span> <span class="token operator">==</span>gMzYDNzIjMxUTNyIzNzIjMyYTM4MDM0gTMwEjNzgTM2UTN4cjNwIjN2QzM5ADMwIDNyMTO4UzM2cTM5kDN2MTOyUTO5YDM0czM3MjM
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode <span class="token keyword">as</span> b32encode
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert<span class="token punctuation">,</span>gcd<span class="token punctuation">,</span>iroot
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> binascii <span class="token keyword">import</span> a2b_hex<span class="token punctuation">,</span>b2a_hex
<span class="token keyword">import</span> random

flag <span class="token operator">=</span> <span class="token string">"******************************"</span>

nbit <span class="token operator">=</span> <span class="token number">128</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span>nbit<span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span>nbit<span class="token punctuation">)</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q

<span class="token keyword">print</span> p
<span class="token keyword">print</span> n

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

e <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">,</span><span class="token number">70000</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> gcd<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		e <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>b2a_hex<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

<span class="token keyword">print</span> b32encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token comment"># 2373740699529364991763589324200093466206785561836101840381622237225512234632</span>
</pre><p>给了 e 的范围,爆破即可</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64encode <span class="token keyword">as</span> b32encode
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> invert<span class="token punctuation">,</span> gcd<span class="token punctuation">,</span> iroot
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> <span class="token number">177077389675257695042507998165006460849</span>
n <span class="token operator">=</span> <span class="token number">37421829509887796274897162249367329400988647145613325367337968063341372726061</span>
c64 <span class="token operator">=</span> <span class="token string">'==gMzYDNzIjMxUTNyIzNzIjMyYTM4MDM0gTMwEjNzgTM2UTN4cjNwIjN2QzM5ADMwIDNyMTO4UzM2cTM5kDN2MTOyUTO5YDM0czM3MjM'</span>
c <span class="token operator">=</span> <span class="token builtin">int</span> <span class="token punctuation">(</span> b64decode <span class="token punctuation">(</span> <span class="token builtin">str</span> <span class="token punctuation">(</span> c64<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span> c <span class="token punctuation">)</span>
q <span class="token operator">=</span> n <span class="token operator">//</span> p
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token builtin">range</span> <span class="token punctuation">(</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token number">70000</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span>  gcd <span class="token punctuation">(</span> e<span class="token punctuation">,</span> phi <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> invert <span class="token punctuation">(</span> e<span class="token punctuation">,</span> phi <span class="token punctuation">)</span>
        m <span class="token operator">=</span> <span class="token builtin">pow</span> <span class="token punctuation">(</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> n <span class="token punctuation">)</span>
        flag<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">in</span> flag <span class="token keyword">or</span> <span class="token string">'CTF'</span> <span class="token keyword">in</span> flag <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token string">"{"</span> <span class="token keyword">in</span> flag <span class="token keyword">and</span> <span class="token string">'}'</span><span class="token keyword">in</span> flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-nr%E6%B1%82pq">已知 n,r求p,q</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
np<span class="token punctuation">.</span>set_printoptions<span class="token punctuation">(</span>suppress<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

n<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>mpz<span class="token punctuation">(</span><span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
r<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>mpz<span class="token punctuation">(</span><span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

c1<span class="token operator">=</span>n<span class="token operator">-</span>r<span class="token operator">+</span><span class="token number">1</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>c1<span class="token punctuation">)</span>

l<span class="token operator">=</span>c1<span class="token operator">/</span><span class="token number">2</span>
r<span class="token operator">=</span>c1
<span class="token comment">#p=(l+r)/2</span>
<span class="token comment">#y=p*(c1-p)</span>

<span class="token keyword">while</span> l<span class="token operator">&lt;</span>r<span class="token punctuation">:</span>
	p<span class="token operator">=</span><span class="token punctuation">(</span>l<span class="token operator">+</span>r<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>
	y<span class="token operator">=</span>p<span class="token operator">*</span><span class="token punctuation">(</span>c1<span class="token operator">-</span>p<span class="token punctuation">)</span>
	<span class="token keyword">if</span> y<span class="token operator">==</span>n<span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span>
		<span class="token keyword">break</span>
	<span class="token keyword">if</span> y<span class="token operator">&gt;</span>n<span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token punctuation">(</span>y<span class="token operator">&gt;</span>n<span class="token punctuation">)</span>
		l<span class="token operator">=</span>p
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span> <span class="token punctuation">(</span>y<span class="token operator">&lt;</span>n<span class="token punctuation">)</span>
		r<span class="token operator">=</span>p
		<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>c1<span class="token operator">-</span>p
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-en%E6%B1%82%E6%9C%80%E5%B0%8F%E5%85%AC%E5%80%8D%E6%95%B0">已知 e,n,求最小公倍数</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> lcm <span class="token punctuation">,</span> powmod <span class="token punctuation">,</span> invert <span class="token punctuation">,</span> gcd <span class="token punctuation">,</span> mpz
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> nextprime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint
p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
gift <span class="token operator">=</span> lcm<span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">,</span> q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token number">54722</span>
flag <span class="token operator">=</span> <span class="token string">b'NPUCTF{******************}'</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>flag <span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> powmod<span class="token punctuation">(</span>m <span class="token punctuation">,</span> e <span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n: '</span> <span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'gift: '</span> <span class="token punctuation">,</span> gift<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c: '</span> <span class="token punctuation">,</span> c<span class="token punctuation">)</span>

<span class="token comment">#n:  17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121</span>
<span class="token comment">#gift:  2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104</span>
<span class="token comment">#c:  3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319</span>
</pre><p>最小公倍数(p,q) ∗ 最大公因数(p,q) = p∗q<br>
所以对于gift，我们有：</p>
<p>gift∗gcd(p−1,q−1)=(p−1)∗(q−1)=ϕ(n)<br>
我们可以求出gift的二进制位数为2045<br>
求法：print(len(bin(gift)[2:]))<br>
同时知道ϕ(n)=(p−1)∗(q−1)的位数为2048，因此gcd(p−1,q−1)占3bits，因此最大公因数的范围（十进制）为[4,8]<br>
在此范围内遍历最大公因数的值，然后与最小公倍数相乘得到ϕ(n)的值，再有e, ϕ(n)求得d，然后就可求得明文<br>
但是这个时候发现一个问题：e值不是素数，分解可以得到e=2∗27361<br>
所以，在计算时，需要将原先的e值除以2才可以进行常规的解密操作。</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2

e <span class="token operator">=</span> <span class="token number">54722</span>
<span class="token comment"># e = 2*27361</span>
n <span class="token operator">=</span> <span class="token number">17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121</span>
gift <span class="token operator">=</span> <span class="token number">2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104</span>
c <span class="token operator">=</span> <span class="token number">3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319</span>
<span class="token comment"># gift = 8 * 11 * 97 * 9601 * 26057167557433418766727399341516665922795024485718296827775927226598694152064298989740080209950805089159979564300359652085874056289167084685303669920341402021998569251561854184586912056788515477034039863935829715784489123437315798902409373317578932823488000322365526936227790036245092665207472438169954702748857842187299166976320465787901470261800372425345547560303561842376571751928531743505412746346436473024093575122041981043859827477404447458211341273671273506575488189374812217939984540494633634622813448773520886788206836310702581026986331011987344147901504555559723572981774237352245997308787165273589</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>gift<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># gift * gcd = (p-1) * (q-1)</span>
<span class="token comment"># gift % gcd = 0</span>
<span class="token keyword">for</span> gcd_val <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    phi <span class="token operator">=</span> gift <span class="token operator">*</span> gcd_val
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
        m_2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        flag <span class="token operator">=</span> long_to_bytes<span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span>m_2<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">except</span> ZeroDivisionError<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-e-pown1en-n2%E6%B1%82c">已知 n、e、pow(n1,e,n)、n2，求c</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> sympy <span class="token keyword">import</span> isprime<span class="token punctuation">,</span>nextprime
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime <span class="token keyword">as</span> getprime <span class="token punctuation">,</span>long_to_bytes<span class="token punctuation">,</span>bytes_to_long<span class="token punctuation">,</span>inverse
flag<span class="token operator">=</span><span class="token string">'flag{***************}'</span>

<span class="token keyword">def</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token operator">=</span>getprime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q<span class="token operator">=</span>getprime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    n<span class="token operator">=</span>p<span class="token operator">*</span>q
    e<span class="token operator">=</span><span class="token number">65537</span>

    <span class="token keyword">print</span> <span class="token string">"Hello,let's play rsa~\n"</span>
    <span class="token keyword">print</span> <span class="token string">'Now,I make some numbers,wait a second\n'</span>
    n1<span class="token operator">=</span>getprime<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    n2<span class="token operator">=</span>getprime<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
    number<span class="token operator">=</span>n1<span class="token operator">*</span>n2
    <span class="token keyword">print</span> <span class="token string">"Ok,i will send two numbers to you,one of them was encoded.\n"</span>
    <span class="token keyword">print</span> <span class="token string">"Encode n1:%d,\n"</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">"And n2:%d.\n"</span><span class="token operator">%</span>n2

    <span class="token keyword">print</span> <span class="token string">"Information that can now be made public:the public key (n,e):(%d,%d)\n"</span><span class="token operator">%</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            c<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token string">"ok,now,tell me the value of the number (encode it for safe):"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">"Sorry,the input is illeagal, and the integer is accept~"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    d<span class="token operator">=</span>inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> m<span class="token operator">==</span>number<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"It's easy and interesting,didn't it?\n"</span>
        <span class="token keyword">print</span> <span class="token string">"This is the gift for you :"</span><span class="token operator">+</span>flag
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Emmmmm,there is something wrong, bye~\n"</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    play<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#n =</span>
<span class="token comment">#n2 =</span>
<span class="token comment">#e = 65537</span>
a <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token comment">#题目给出</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> n
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token comment">#提交c及返回flag</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-c1-c2-n1-n2-e%E7%9A%84%E8%8C%83%E5%9B%B4-%E5%90%8C%E5%85%AC%E9%92%A5en%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AF%86%E6%96%87-%E5%85%B7%E6%9C%89%E5%90%8C-q-%E7%9A%84%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86%E7%9A%84%E5%AF%86%E6%96%87">已知 c1、c2、n1、n2、e的范围 (同公钥（e，n）加密的密文、具有同 q 的公钥加密的密文)</h2>

<p><strong>例题 [BJDCTF2020]RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>bytes_to_long

flag<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>e<span class="token operator">&lt;</span><span class="token number">100000</span><span class="token punctuation">)</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> c<span class="token punctuation">,</span>n
<span class="token keyword">print</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">294</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span><span class="token string">"BJD"</span><span class="token operator">*</span><span class="token number">32</span><span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> c<span class="token punctuation">,</span>n

<span class="token triple-quoted-string string">'''
output:
12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120  13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037
381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018
979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721  12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047
'''</span>
</pre><p>两个 n 值公用了一个 q，可以通过 gcd 函数很快找到 q 的值，就可以求出两个 p 的值</p>
<p>此时就差 e 就能解出题目，e 小于 100000，又有关系式 output=pow(294,e,n)，可以通过爆破 e 的取值很快得到 e</p>
<p><strong>解法1</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># python2</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
c1<span class="token operator">=</span><span class="token number">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>
n1<span class="token operator">=</span><span class="token number">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>
c2<span class="token operator">=</span><span class="token number">979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721</span>
n2<span class="token operator">=</span><span class="token number">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>
q<span class="token operator">=</span>gcd<span class="token punctuation">(</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>
<span class="token comment">#print(q)</span>
<span class="token comment">#99855353761764939308265951492116976798674681282941462516956577712943717850048051273358745095906207085170915794187749954588685850452162165059831749303473106541930948723000882713453679904525655327168665295207423257922666721077747911860159181041422993030618385436504858943615630219459262419715816361781062898911</span>

output<span class="token operator">=</span><span class="token number">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	res<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">294</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token operator">==</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token comment">#print(i)</span>
		<span class="token comment">#52361</span>
		e<span class="token operator">=</span>i
		<span class="token keyword">break</span>
e<span class="token operator">=</span><span class="token number">52361</span>
p<span class="token operator">=</span>n1<span class="token operator">//</span>q
phi<span class="token operator">=</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token operator">=</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n1<span class="token punctuation">)</span>
flag<span class="token operator">=</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token comment">#BJD{p_is_common_divisor}</span>
</pre><p><strong>解法2</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># flag=open("flag","rb").read()</span>

<span class="token comment"># p=getPrime(1024)</span>
<span class="token comment"># q=getPrime(1024)</span>
<span class="token comment"># assert(e&lt;100000)</span>
<span class="token comment"># n=p*q</span>
<span class="token comment"># m=bytes_to_long(flag)</span>
<span class="token comment"># c=pow(m,e,n)</span>
<span class="token comment"># print c,n</span>
<span class="token comment"># print pow(294,e,n)</span>

<span class="token comment"># p=getPrime(1024)</span>
<span class="token comment"># n=p*q</span>
<span class="token comment"># m=bytes_to_long("BJD"*32)</span>
<span class="token comment"># c=pow(m,e,n)</span>
<span class="token comment"># print c,n</span>

<span class="token comment">#output:</span>
c <span class="token operator">=</span> <span class="token number">12641635617803746150332232646354596292707861480200207537199141183624438303757120570096741248020236666965755798009656547738616399025300123043766255518596149348930444599820675230046423373053051631932557230849083426859490183732303751744004874183062594856870318614289991675980063548316499486908923209627563871554875612702079100567018698992935818206109087568166097392314105717555482926141030505639571708876213167112187962584484065321545727594135175369233925922507794999607323536976824183162923385005669930403448853465141405846835919842908469787547341752365471892495204307644586161393228776042015534147913888338316244169120</span>
n <span class="token operator">=</span> <span class="token number">13508774104460209743306714034546704137247627344981133461801953479736017021401725818808462898375994767375627749494839671944543822403059978073813122441407612530658168942987820256786583006947001711749230193542370570950705530167921702835627122401475251039000775017381633900222474727396823708695063136246115652622259769634591309421761269548260984426148824641285010730983215377509255011298737827621611158032976420011662547854515610597955628898073569684158225678333474543920326532893446849808112837476684390030976472053905069855522297850688026960701186543428139843783907624317274796926248829543413464754127208843070331063037</span>
<span class="token comment">#n和e相同</span>
_294c <span class="token operator">=</span> <span class="token number">381631268825806469518166370387352035475775677163615730759454343913563615970881967332407709901235637718936184198930226303761876517101208677107311006065728014220477966000620964056616058676999878976943319063836649085085377577273214792371548775204594097887078898598463892440141577974544939268247818937936607013100808169758675042264568547764031628431414727922168580998494695800403043312406643527637667466318473669542326169218665366423043579003388486634167642663495896607282155808331902351188500197960905672207046579647052764579411814305689137519860880916467272056778641442758940135016400808740387144508156358067955215018</span>
<span class="token comment">#e相同</span>
BJDc <span class="token operator">=</span> <span class="token number">979153370552535153498477459720877329811204688208387543826122582132404214848454954722487086658061408795223805022202997613522014736983452121073860054851302343517756732701026667062765906277626879215457936330799698812755973057557620930172778859116538571207100424990838508255127616637334499680058645411786925302368790414768248611809358160197554369255458675450109457987698749584630551177577492043403656419968285163536823819817573531356497236154342689914525321673807925458651854768512396355389740863270148775362744448115581639629326362342160548500035000156097215446881251055505465713854173913142040976382500435185442521721</span>
BJDn <span class="token operator">=</span> <span class="token number">12806210903061368369054309575159360374022344774547459345216907128193957592938071815865954073287532545947370671838372144806539753829484356064919357285623305209600680570975224639214396805124350862772159272362778768036844634760917612708721787320159318432456050806227784435091161119982613987303255995543165395426658059462110056431392517548717447898084915167661172362984251201688639469652283452307712821398857016487590794996544468826705600332208535201443322267298747117528882985955375246424812616478327182399461709978893464093245135530135430007842223389360212803439850867615121148050034887767584693608776323252233254261047</span>

<span class="token comment">#n 和 BJDn公用了一个 q 用gcd欧几里得算法求得p</span>
q <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>gcd<span class="token punctuation">(</span>n<span class="token punctuation">,</span>BJDn<span class="token punctuation">)</span>
p <span class="token operator">=</span> n <span class="token operator">//</span> q
<span class="token comment"># 此时知道e即可解题 因为我们知道pow(294,e,n) 还知道e的范围所以可以**e</span>
<span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> _294c <span class="token operator">==</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">294</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'e = '</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
<span class="token comment">#e =  52361</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#b'BJD{p_is_common_divisor}'</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-m1-m2-n-pq-%E6%8E%A5%E8%BF%91-%E6%B1%82%E5%8E%9F-m">已知 e、m1、m2、n、pq 接近 ,求原 m</h2>

<p><strong>例题 [GWCTF 2019]BabyRSA</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>N=636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163
m1=90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239
m2=487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> sympy
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

flag <span class="token operator">=</span> <span class="token string">'GWHT{******}'</span>
secret <span class="token operator">=</span> <span class="token string">'******'</span>

<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">38</span><span class="token punctuation">)</span>

half <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>

flag1 <span class="token operator">=</span> flag<span class="token punctuation">[</span><span class="token punctuation">:</span>half<span class="token punctuation">]</span>
flag2 <span class="token operator">=</span> flag<span class="token punctuation">[</span>half<span class="token punctuation">:</span><span class="token punctuation">]</span>

secret_num <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">*</span> bytes_to_long<span class="token punctuation">(</span>secret<span class="token punctuation">)</span>

p <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>secret_num<span class="token punctuation">)</span>
q <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

N <span class="token operator">=</span> p <span class="token operator">*</span> q

e <span class="token operator">=</span> <span class="token number">0x10001</span>

F1 <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag1<span class="token punctuation">)</span>
F2 <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag2<span class="token punctuation">)</span>

c1 <span class="token operator">=</span> F1 <span class="token operator">+</span> F2
c2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>F1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>F2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>c2 <span class="token operator">&lt;</span> N<span class="token punctuation">)</span>

m1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> e<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
m2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> N<span class="token punctuation">)</span>

output <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'secret'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
output<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'N='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
output<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'m1='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
output<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'m2='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
output<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>pq接近,那么 n 应该好分解</p>
<p>e 已经给出来了,flag被加密为 F1 F2，要求 c1、c2 还原 flag</p>
<p>先用 yafu 分解 n</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>P327 = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377748737
P327 = 797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377747699
</code></pre><p>算出 c1、c2 还原 F1F2 得到 flag</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">as</span> cun
<span class="token keyword">from</span>  sympy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span>  sympy<span class="token punctuation">.</span>abc <span class="token keyword">import</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c

N<span class="token operator">=</span><span class="token number">636585149594574746909030160182690866222909256464847291783000651837227921337237899651287943597773270944384034858925295744880727101606841413640006527614873110651410155893776548737823152943797884729130149758279127430044739254000426610922834573094957082589539445610828279428814524313491262061930512829074466232633130599104490893572093943832740301809630847541592548921200288222432789208650949937638303429456468889100192613859073752923812454212239908948930178355331390933536771065791817643978763045030833712326162883810638120029378337092938662174119747687899484603628344079493556601422498405360731958162719296160584042671057160241284852522913676264596201906163</span>
m1<span class="token operator">=</span><span class="token number">90009974341452243216986938028371257528604943208941176518717463554774967878152694586469377765296113165659498726012712288670458884373971419842750929287658640266219686646956929872115782173093979742958745121671928568709468526098715927189829600497283118051641107305128852697032053368115181216069626606165503465125725204875578701237789292966211824002761481815276666236869005129138862782476859103086726091860497614883282949955023222414333243193268564781621699870412557822404381213804026685831221430728290755597819259339616650158674713248841654338515199405532003173732520457813901170264713085107077001478083341339002069870585378257051150217511755761491021553239</span>
m2<span class="token operator">=</span><span class="token number">487443985757405173426628188375657117604235507936967522993257972108872283698305238454465723214226871414276788912058186197039821242912736742824080627680971802511206914394672159240206910735850651999316100014691067295708138639363203596244693995562780286637116394738250774129759021080197323724805414668042318806010652814405078769738548913675466181551005527065309515364950610137206393257148357659666687091662749848560225453826362271704292692847596339533229088038820532086109421158575841077601268713175097874083536249006018948789413238783922845633494023608865256071962856581229890043896939025613600564283391329331452199062858930374565991634191495137939574539546</span>

p<span class="token operator">=</span> <span class="token number">797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377748737</span>
q<span class="token operator">=</span> <span class="token number">797862863902421984951231350430312260517773269684958456342860983236184129602390919026048496119757187702076499551310794177917920137646835888862706126924088411570997141257159563952725882214181185531209186972351469946269508511312863779123205322378452194261217016552527754513215520329499967108196968833163329724620251096080377747699</span>
e<span class="token operator">=</span><span class="token number">0x10001</span>

d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

c1<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m1<span class="token punctuation">,</span>d<span class="token punctuation">,</span>N<span class="token punctuation">)</span>
c2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m2<span class="token punctuation">,</span>d<span class="token punctuation">,</span>N<span class="token punctuation">)</span>

aa<span class="token operator">=</span>solve<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token operator">+</span>b<span class="token operator">-</span>c1<span class="token punctuation">,</span><span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">pow</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">-</span>c2<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span>

<span class="token comment">#[(1141553212031156130619789508463772513350070909, 1590956290598033029862556611630426044507841845), (1590956290598033029862556611630426044507841845, 1141553212031156130619789508463772513350070909)]</span>
F1<span class="token operator">=</span><span class="token number">1141553212031156130619789508463772513350070909</span>
F2<span class="token operator">=</span><span class="token number">1590956290598033029862556611630426044507841845</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>cun<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>F1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cun<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>F2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cun<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>F2<span class="token punctuation">)</span><span class="token operator">+</span>cun<span class="token punctuation">.</span>long_to_bytes<span class="token punctuation">(</span>F1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-d-c-%E6%B1%82-m">已知 e、d、c ,求 m</h2>

<p><strong>例题 [NCTF2019]babyRSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> flag <span class="token keyword">import</span> flag

<span class="token keyword">def</span> <span class="token function">nextPrime</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">+=</span> <span class="token number">2</span> <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span>
    <span class="token keyword">while</span> <span class="token keyword">not</span> isPrime<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">+=</span> <span class="token number">2</span>
    <span class="token keyword">return</span> n

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> nextPrime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token comment"># d = 19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913</span>
<span class="token comment"># c = 5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804</span>
</pre><p>题目给了 e,d,c三个值，所以由公式 ed=1 mod (q-1)(p-1) 得到 (ed-1)=k * (q-1)(p-1) (设k为整数)</p>
<p>分析题目可知 p,q 接近，p*q 为 2048 位，</p>
<p>所以 <code>(p-1)*(q-1)&lt;=2048</code> 计算可知 e*d-1 是 2064 位的，所以K的取值范围为（pow(2,15),pow(2,16)）</p>
<p>通过爆破 K 的值，可以得到 (p-1)*(q-1) 的值，对 phi 开平方，进而求得 p,q。</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span> <span class="token operator">*</span>

e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> <span class="token number">19275778946037899718035455438175509175723911466127462154506916564101519923603308900331427601983476886255849200332374081996442976307058597390881168155862238533018621944733299208108185814179466844504468163200369996564265921022888670062554504758512453217434777820468049494313818291727050400752551716550403647148197148884408264686846693842118387217753516963449753809860354047619256787869400297858568139700396567519469825398575103885487624463424429913017729585620877168171603444111464692841379661112075123399343270610272287865200880398193573260848268633461983435015031227070217852728240847398084414687146397303110709214913</span>
c <span class="token operator">=</span> <span class="token number">5382723168073828110696168558294206681757991149022777821127563301413483223874527233300721180839298617076705685041174247415826157096583055069337393987892262764211225227035880754417457056723909135525244957935906902665679777101130111392780237502928656225705262431431953003520093932924375902111280077255205118217436744112064069429678632923259898627997145803892753989255615273140300021040654505901442787810653626524305706316663169341797205752938755590056568986738227803487467274114398257187962140796551136220532809687606867385639367743705527511680719955380746377631156468689844150878381460560990755652899449340045313521804</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        phi <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">*</span>d<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>k
        P1 <span class="token operator">=</span> iroot<span class="token punctuation">(</span>phi<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token comment">#  对(q-1)*(p-1)开平方</span>
        p <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>P1<span class="token punctuation">)</span>     <span class="token comment"># 获取素数P</span>
        q_1 <span class="token operator">=</span> phi<span class="token operator">//</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment"># 得到(q-1)</span>
        q <span class="token operator">=</span> q_1<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isprime<span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>       <span class="token comment"># 对q进行素性检测</span>
                   <span class="token keyword">break</span>
<span class="token triple-quoted-string string">'''
print(p,q)

p=143193611591752210918770476402384783351740028841763223236102885221839966637073188462808195974548579833368313904083095786906479416347681923731100260359652426441593107755892485944809419189348311956308456459523437459969713060653432909873986596042482699670451716296743727525586437248462432327423361080811225076497
q=143193611591752210918770476402384783351740028841763223236102885221839966637073188462808195974548579833368313904083095786906479416347681923731100260359652426441593107755892485944809419189348311956308456459523437459969713060653432909873986596042482699670451716296743727525586437248462432327423361080811225075839
'''</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>--</p>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5%E5%A4%9A%E4%B8%AA-n-c-%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86">已知多个 n、c (中国剩余定理)</h2>

<p><strong>例题 RSA4</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>N = 331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004
c = 310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243

N = 302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114
c = 112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344

N = 332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323
c = 10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>

<span class="token comment"># 将5进制数转换为10进制数  int('',5)</span>
N1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

N2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

N3 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c3 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

N <span class="token operator">=</span> <span class="token punctuation">[</span>N1<span class="token punctuation">,</span>N2<span class="token punctuation">,</span>N3<span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token punctuation">]</span>

<span class="token comment"># 中国剩余定理算法</span>
<span class="token keyword">def</span> <span class="token function">chinese_remainder</span><span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> remainders<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Sum <span class="token operator">=</span> <span class="token number">0</span>
    prod <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a<span class="token operator">*</span>b<span class="token punctuation">,</span> modulus<span class="token punctuation">)</span>
    <span class="token keyword">for</span> m_i<span class="token punctuation">,</span> r_i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>modulus<span class="token punctuation">,</span> remainders<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> prod <span class="token operator">//</span> m_i
        Sum <span class="token operator">+=</span> r_i <span class="token operator">*</span> <span class="token punctuation">(</span>inverse<span class="token punctuation">(</span>p<span class="token punctuation">,</span>m_i<span class="token punctuation">)</span><span class="token operator">*</span>p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Sum <span class="token operator">%</span> prod
e <span class="token operator">=</span> <span class="token number">3</span>

<span class="token comment"># print(chinese_remainder(N,c))</span>
pow_m_e <span class="token operator">=</span> chinese_remainder<span class="token punctuation">(</span>N<span class="token punctuation">,</span>c<span class="token punctuation">)</span>

<span class="token comment"># pow_m_e = 17446992834638639179129969961058029457462398677361658450137832328330435503838651797276948890990069700515669656391607670623897280684064423087023742140145529356863469816868212911716782075239982647322703714504545802436551322108638975695013439206776300941300053940942685511792851350404139366581130688518772175108412341696958930756520037</span>
m <span class="token operator">=</span> iroot<span class="token punctuation">(</span>pow_m_e<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n-c%E6%B1%82%E5%AF%BC%E5%BE%97-pq-%E8%A7%A3-m">已知 e、n、c,求导得 pq 解 m</h2>

<p><strong>例题 [BJDCTF2020]easyrsa</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span>bytes_to_long
<span class="token keyword">from</span> sympy <span class="token keyword">import</span> Derivative
<span class="token keyword">from</span> fractions <span class="token keyword">import</span> Fraction
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

p<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
e<span class="token operator">=</span><span class="token number">65537</span>
n<span class="token operator">=</span>p<span class="token operator">*</span>q
z<span class="token operator">=</span>Fraction<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Derivative<span class="token punctuation">(</span>arctan<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>Fraction<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>Derivative<span class="token punctuation">(</span>arth<span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token operator">=</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>z<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
output:
7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035
32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482
15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441
'''</span>
</pre><p>由加密脚本我们可以得到三个量的值,c,z,n</p>
<ol>
<li>
<p>arctan (p)和 arth(q) ，求导后的值分别为 1/(1+p** 2)  和 1/(1-q** 2)</p>
</li>
<li>
<p>通过构造方程组 <code>z=p** 2+q**2, n = p*q</code> , 求出 pq 的值</p>
</li>
</ol>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2

e<span class="token operator">=</span><span class="token number">65537</span>
c<span class="token operator">=</span><span class="token number">7922547866857761459807491502654216283012776177789511549350672958101810281348402284098310147796549430689253803510994877420135537268549410652654479620858691324110367182025648788407041599943091386227543182157746202947099572389676084392706406084307657000104665696654409155006313203957292885743791715198781974205578654792123191584957665293208390453748369182333152809882312453359706147808198922916762773721726681588977103877454119043744889164529383188077499194932909643918696646876907327364751380953182517883134591810800848971719184808713694342985458103006676013451912221080252735948993692674899399826084848622145815461035</span>
z<span class="token operator">=</span><span class="token number">32115748677623209667471622872185275070257924766015020072805267359839059393284316595882933372289732127274076434587519333300142473010344694803885168557548801202495933226215437763329280242113556524498457559562872900811602056944423967403777623306961880757613246328729616643032628964072931272085866928045973799374711846825157781056965164178505232524245809179235607571567174228822561697888645968559343608375331988097157145264357626738141646556353500994924115875748198318036296898604097000938272195903056733565880150540275369239637793975923329598716003350308259321436752579291000355560431542229699759955141152914708362494482</span>
n<span class="token operator">=</span><span class="token number">15310745161336895413406690009324766200789179248896951942047235448901612351128459309145825547569298479821101249094161867207686537607047447968708758990950136380924747359052570549594098569970632854351825950729752563502284849263730127586382522703959893392329333760927637353052250274195821469023401443841395096410231843592101426591882573405934188675124326997277775238287928403743324297705151732524641213516306585297722190780088180705070359469719869343939106529204798285957516860774384001892777525916167743272419958572055332232056095979448155082465977781482598371994798871917514767508394730447974770329967681767625495394441</span>

p<span class="token operator">=</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>z<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>z<span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token operator">%</span>p<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
q<span class="token operator">=</span>n<span class="token operator">//</span>p
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">import</span> binascii
<span class="token keyword">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n-c%E7%94%B1%E5%A8%81%E5%B0%94%E9%80%8A%E5%AE%9A%E7%90%86%E5%BE%97-pq-%E8%A7%A3-m">已知 e、n、c,由威尔逊定理得 pq 解 m</h2>

<p><strong>例题 [RoarCTF2019]babyRSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> random

<span class="token keyword">def</span> <span class="token function">myGetPrime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    A<span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">513</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
    B<span class="token operator">=</span>A<span class="token operator">-</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1e3</span><span class="token punctuation">,</span><span class="token number">1e5</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextPrime<span class="token punctuation">(</span><span class="token punctuation">(</span>B!<span class="token punctuation">)</span><span class="token operator">%</span>A<span class="token punctuation">)</span>
p<span class="token operator">=</span>myGetPrime<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#A1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span>
<span class="token comment">#B1=21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span>

q<span class="token operator">=</span>myGetPrime<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#A2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span>
<span class="token comment">#B2=16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span>

r<span class="token operator">=</span>myGetPrime<span class="token punctuation">(</span><span class="token punctuation">)</span>

n<span class="token operator">=</span>p<span class="token operator">*</span>q<span class="token operator">*</span>r
<span class="token comment">#n=85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span>
c<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token comment">#e=0x1001</span>
<span class="token comment">#c=75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span>
<span class="token comment">#so,what is the flag?</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span><span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">get_p_q</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>B<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>A<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp <span class="token operator">*=</span> i
        tmp <span class="token operator">%=</span> A
    tmp_inv <span class="token operator">=</span> invert<span class="token punctuation">(</span>tmp<span class="token punctuation">,</span>A<span class="token punctuation">)</span>
    result <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>tmp_inv<span class="token punctuation">)</span>
    <span class="token keyword">return</span> result

A1<span class="token operator">=</span><span class="token number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467234407</span>
B1<span class="token operator">=</span><span class="token number">21856963452461630437348278434191434000066076750419027493852463513469865262064340836613831066602300959772632397773487317560339056658299954464169264467140596</span>

A2<span class="token operator">=</span><span class="token number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858418927</span>
B2<span class="token operator">=</span><span class="token number">16466113115839228119767887899308820025749260933863446888224167169857612178664139545726340867406790754560227516013796269941438076818194617030304851858351026</span>

n<span class="token operator">=</span><span class="token number">85492663786275292159831603391083876175149354309327673008716627650718160585639723100793347534649628330416631255660901307533909900431413447524262332232659153047067908693481947121069070451562822417357656432171870951184673132554213690123308042697361969986360375060954702920656364144154145812838558365334172935931441424096270206140691814662318562696925767991937369782627908408239087358033165410020690152067715711112732252038588432896758405898709010342467882264362733</span>
c<span class="token operator">=</span><span class="token number">75700883021669577739329316795450706204502635802310731477156998834710820770245219468703245302009998932067080383977560299708060476222089630209972629755965140317526034680452483360917378812244365884527186056341888615564335560765053550155758362271622330017433403027261127561225585912484777829588501213961110690451987625502701331485141639684356427316905122995759825241133872734362716041819819948645662803292418802204430874521342108413623635150475963121220095236776428</span>

p<span class="token operator">=</span>get_p_q<span class="token punctuation">(</span>A1<span class="token punctuation">,</span>B1<span class="token punctuation">)</span>
q<span class="token operator">=</span>get_p_q<span class="token punctuation">(</span>A2<span class="token punctuation">,</span>B2<span class="token punctuation">)</span>

r <span class="token operator">=</span> n<span class="token operator">//</span>p<span class="token operator">//</span>q

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

e<span class="token operator">=</span><span class="token number">0x1001</span>

d<span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>

m<span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-c1-c2%E7%94%B1-g1-g2-%E5%BE%97-pq">已知 n、c1、c2,由 g1、g2 得 pq</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
N <span class="token operator">=</span> p <span class="token operator">*</span> q

g<span class="token punctuation">,</span> r1<span class="token punctuation">,</span> r2 <span class="token operator">=</span> <span class="token punctuation">[</span>getRandomRange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
g1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> r1 <span class="token operator">*</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
g2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> r2 <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s1<span class="token punctuation">,</span> s2 <span class="token operator">=</span> <span class="token punctuation">[</span>getRandomRange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    c1 <span class="token operator">=</span> <span class="token punctuation">(</span>m <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g1<span class="token punctuation">,</span> s1<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> N
    c2 <span class="token operator">=</span> <span class="token punctuation">(</span>m <span class="token operator">*</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g2<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> N
    <span class="token keyword">return</span> <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xp <span class="token operator">=</span> c1 <span class="token operator">%</span> p
    xq <span class="token operator">=</span> c2 <span class="token operator">%</span> q
    <span class="token comment"># Chinese Remainder Theorem</span>
    m <span class="token operator">=</span> <span class="token punctuation">(</span>xp<span class="token operator">*</span>inverse<span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token operator">*</span>q <span class="token operator">+</span> xq<span class="token operator">*</span>inverse<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token operator">*</span>p<span class="token punctuation">)</span> <span class="token operator">%</span> N
    <span class="token keyword">return</span> m

c <span class="token operator">=</span> encrypt<span class="token punctuation">(</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># N = 18680643069610062851842282268594530254220611012409807422663284548187050713427682950720783343430650669361838067625768840896513125210105582070603021732086193955893838077699465426052925750736212977005683541174195320832791835197114668838654054444342903298662698415765898335350206380896849522280206304272801325820946987172164086644949521111058774180676742851681476123338557138770304164634321305204827406522957769478330124484710532963132900017800651579612646041955628867746525508376194147796920773364680264059390497210260540079810501777507814448518995581208169818764701641258963569599247156932381367802991222265241699715283</span>
<span class="token comment"># g1 = 9143176283300810019842153344177123108612540016879643936458724056602746667157014763960725115919119704406826965726023263657276550779443988565368344040505696950820899770544814163379169539926317676679421275092688200844094929042154854719312788471536324082041360841253720783220459009201882865091829118575721525038404689868986360373373122049951274015083845966946475469982961355934516388706446794517870569063777231434618411404965077775991870069073539415961610645268985004687402050059891500490949250730689691141954694508001895390336750734542724392709744200091587065816283592253967715080611459937165344139809223328071517060208</span>
<span class="token comment"># g2 = 14068322834597276347776814624877614869834816383564391664570268934537693322688875343215293618493363798985047779057952636529313879548457643220996398640913517182122425631198219387988691569709691279442005545716133131472147592456812502863851227108284027033557263611949365667779259585770738623603814004666845554284808166195201470503432803440754207350347128045893594280079379926676477680556845095378093693409219131090910168117334308781843178748431526974047817218228075136005979538773141427004682344298827618677773735288946271346252828348742296301538573408254015281232250841148556304927266143397565889649305095857756884049430</span>
<span class="token comment"># c1, c2 = (3976514029543484086411168675941075541422870678409709261442618832911574665848843566949154289825219682094719766762966082440586568781997199077781276145091509192208487682443007457513002005089654365915817414921574344557570444253187757317116858499013550050579856269915915792827620535138057468531410166908365364129001407147467636145589396570815405571923148902993581000542566387654639930651683044853608873583911638108204074537952317056718986683846742909366072461130053275195290631718363272923316002049685111871888148244026652658482359335651889139243735138819453744763293112267738369048641158946411500606588429007794613880534, 18524535479582837341745231233387403662294605513261199630593257391163433751052467785080620993007681605662927226603747560698627838567782891522546977611597418150309028806158429831471152782211111046118637630899456903846057977815397285171313888516791822545633820066408276065732715348834255021260666966934592884548856831383262013360819013814149529393178712576141627031723067564594282618223686778534522328204603249125537258294561872667849498796757523663858312311082034700705599706428944071848443463999351872482644584735305157234751806369172212650596041534643187402820399145288902719434158798638116870325144146218568810928344)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xp <span class="token operator">=</span> c1 <span class="token operator">%</span> p
    xq <span class="token operator">=</span> c2 <span class="token operator">%</span> q
    <span class="token comment"># Chinese Remainder Theorem</span>
    m <span class="token operator">=</span> <span class="token punctuation">(</span>xp<span class="token operator">*</span>invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token operator">*</span>q <span class="token operator">+</span> xq<span class="token operator">*</span>invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span><span class="token operator">*</span>p<span class="token punctuation">)</span> <span class="token operator">%</span> N
    <span class="token keyword">return</span> m

N <span class="token operator">=</span> <span class="token number">18680643069610062851842282268594530254220611012409807422663284548187050713427682950720783343430650669361838067625768840896513125210105582070603021732086193955893838077699465426052925750736212977005683541174195320832791835197114668838654054444342903298662698415765898335350206380896849522280206304272801325820946987172164086644949521111058774180676742851681476123338557138770304164634321305204827406522957769478330124484710532963132900017800651579612646041955628867746525508376194147796920773364680264059390497210260540079810501777507814448518995581208169818764701641258963569599247156932381367802991222265241699715283</span>
g1 <span class="token operator">=</span> <span class="token number">9143176283300810019842153344177123108612540016879643936458724056602746667157014763960725115919119704406826965726023263657276550779443988565368344040505696950820899770544814163379169539926317676679421275092688200844094929042154854719312788471536324082041360841253720783220459009201882865091829118575721525038404689868986360373373122049951274015083845966946475469982961355934516388706446794517870569063777231434618411404965077775991870069073539415961610645268985004687402050059891500490949250730689691141954694508001895390336750734542724392709744200091587065816283592253967715080611459937165344139809223328071517060208</span>
g2 <span class="token operator">=</span> <span class="token number">14068322834597276347776814624877614869834816383564391664570268934537693322688875343215293618493363798985047779057952636529313879548457643220996398640913517182122425631198219387988691569709691279442005545716133131472147592456812502863851227108284027033557263611949365667779259585770738623603814004666845554284808166195201470503432803440754207350347128045893594280079379926676477680556845095378093693409219131090910168117334308781843178748431526974047817218228075136005979538773141427004682344298827618677773735288946271346252828348742296301538573408254015281232250841148556304927266143397565889649305095857756884049430</span>
c1<span class="token punctuation">,</span> c2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3976514029543484086411168675941075541422870678409709261442618832911574665848843566949154289825219682094719766762966082440586568781997199077781276145091509192208487682443007457513002005089654365915817414921574344557570444253187757317116858499013550050579856269915915792827620535138057468531410166908365364129001407147467636145589396570815405571923148902993581000542566387654639930651683044853608873583911638108204074537952317056718986683846742909366072461130053275195290631718363272923316002049685111871888148244026652658482359335651889139243735138819453744763293112267738369048641158946411500606588429007794613880534</span><span class="token punctuation">,</span> <span class="token number">18524535479582837341745231233387403662294605513261199630593257391163433751052467785080620993007681605662927226603747560698627838567782891522546977611597418150309028806158429831471152782211111046118637630899456903846057977815397285171313888516791822545633820066408276065732715348834255021260666966934592884548856831383262013360819013814149529393178712576141627031723067564594282618223686778534522328204603249125537258294561872667849498796757523663858312311082034700705599706428944071848443463999351872482644584735305157234751806369172212650596041534643187402820399145288902719434158798638116870325144146218568810928344</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>g1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span>
<span class="token comment"># q = gcd(g2-1,N)</span>
q <span class="token operator">=</span> N<span class="token operator">//</span>p
m <span class="token operator">=</span> decrypt<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-d%E6%B1%82e%E7%9A%84%E9%80%86%E5%85%83-williams-p1">已知 n、d,求e的逆元 (William's p+1)</h2>

<p><strong>例题 [V&amp;N2020 公开赛]easy_RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">def</span> <span class="token function">getprime</span><span class="token punctuation">(</span>bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">while</span> n<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> bits<span class="token punctuation">:</span>
            n <span class="token operator">*=</span> next_prime<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> n <span class="token operator">-</span> <span class="token number">1</span>

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span><span class="token string">b'flag{************************************}'</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> getprime<span class="token punctuation">(</span><span class="token number">505</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
r <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> m <span class="token operator">&lt;</span> q

n <span class="token operator">=</span> p <span class="token operator">*</span> q <span class="token operator">*</span> r
e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> invert<span class="token punctuation">(</span>q <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">,</span> p <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>
cipher <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''
7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409
7515987842794170949444517202158067021118454558360145030399453487603693522695746732547224100845570119375977629070702308991221388721952258969752305904378724402002545947182529859604584400048983091861594720299791743887521228492714135449584003054386457751933095902983841246048952155097668245322664318518861440
1618155233923718966393124032999431934705026408748451436388483012584983753140040289666712916510617403356206112730613485227084128314043665913357106301736817062412927135716281544348612150328867226515184078966397180771624148797528036548243343316501503364783092550480439749404301122277056732857399413805293899249313045684662146333448668209567898831091274930053147799756622844119463942087160062353526056879436998061803187343431081504474584816590199768034450005448200
'''</span>
</pre><p>注释中已经给出n，d，cipher的值，所以基本的思路是先由cipher求出c，再由c求出m</p>
<p>由cipher求出c首先要确定e mod n的逆元，所以需要先求出ϕ(n)，那么需要先对n进行分解得到p,q,r</p>
<p>(题设中知道p是最小的那个)</p>
<p>题设中知道p,q,r都是素数，欧拉函数很简单了就是ϕ(n)=(p−1)(q−1)(r−1)</p>
<p>利用gmpy2.invert函数求e的逆元dec后，有 c=cipher^dec mod n</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy<span class="token punctuation">.</span>ntheory<span class="token punctuation">.</span>residue_ntheory <span class="token keyword">import</span> nthroot_mod
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>

n <span class="token operator">=</span> <span class="token number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span>
d <span class="token operator">=</span> <span class="token number">7515987842794170949444517202158067021118454558360145030399453487603693522695746732547224100845570119375977629070702308991221388721952258969752305904378724402002545947182529859604584400048983091861594720299791743887521228492714135449584003054386457751933095902983841246048952155097668245322664318518861440</span>
cipher <span class="token operator">=</span> <span class="token number">1618155233923718966393124032999431934705026408748451436388483012584983753140040289666712916510617403356206112730613485227084128314043665913357106301736817062412927135716281544348612150328867226515184078966397180771624148797528036548243343316501503364783092550480439749404301122277056732857399413805293899249313045684662146333448668209567898831091274930053147799756622844119463942087160062353526056879436998061803187343431081504474584816590199768034450005448200</span>

p <span class="token operator">=</span> <span class="token number">102634610559478918970860957918259981057327949366949344137104804864768237961662136189827166317524151288799657758536256924609797810164397005081733039415393</span>
q <span class="token operator">=</span> <span class="token number">7534810196420932552168708937019691994681052660068275906973480617604535381306041583841106383688654426129050931519275383386503174076258645141589911492908993</span>
r <span class="token operator">=</span> <span class="token number">10269028767754306217563721664976261924407940883784193817786660413744866184645984238866463711873380072803747092361041245422348883639933712733051005791543841</span>

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment">#欧拉定理</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>

d1 <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>        <span class="token comment">#  cipher^d1  mod n</span>

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span>d1<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
m <span class="token operator">=</span> nthroot_mod<span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>r<span class="token punctuation">)</span>       <span class="token comment"># 参考sympy库的官方文档 nthroot_mod(a,n,p)   x**n = a mod p</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>解法2</strong></p>
<p>注意到 p,q,r 加上1均有一大堆小因子，故采用 William's p+1 算法来分解掉 n.</p>
<pre data-role="codeBlock" data-info="py" class="language-python">python2

<span class="token keyword">import</span> primefac

primefac<span class="token punctuation">.</span>williams_pp1<span class="token punctuation">(</span>n<span class="token operator">=</span><span class="token number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span><span class="token punctuation">)</span>
</pre><p>得到p</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> libnum <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> itertools

p <span class="token operator">=</span> <span class="token number">102634610559478918970860957918259981057327949366949344137104804864768237961662136189827166317524151288799657758536256924609797810164397005081733039415393</span>
n <span class="token operator">=</span> <span class="token number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span>

d <span class="token operator">=</span> <span class="token number">7515987842794170949444517202158067021118454558360145030399453487603693522695746732547224100845570119375977629070702308991221388721952258969752305904378724402002545947182529859604584400048983091861594720299791743887521228492714135449584003054386457751933095902983841246048952155097668245322664318518861440</span>

q2 <span class="token operator">=</span> invert<span class="token punctuation">(</span>d<span class="token punctuation">,</span> p<span class="token operator">*</span>p<span class="token punctuation">)</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> iroot<span class="token punctuation">(</span>q2<span class="token operator">+</span>k<span class="token operator">*</span>p<span class="token operator">*</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

q <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
r <span class="token operator">=</span> n <span class="token operator">//</span> <span class="token punctuation">(</span>p<span class="token operator">*</span>q<span class="token punctuation">)</span>
<span class="token keyword">assert</span> n <span class="token operator">==</span> p<span class="token operator">*</span>q<span class="token operator">*</span>r

cip <span class="token operator">=</span> <span class="token number">1618155233923718966393124032999431934705026408748451436388483012584983753140040289666712916510617403356206112730613485227084128314043665913357106301736817062412927135716281544348612150328867226515184078966397180771624148797528036548243343316501503364783092550480439749404301122277056732857399413805293899249313045684662146333448668209567898831091274930053147799756622844119463942087160062353526056879436998061803187343431081504474584816590199768034450005448200</span>

phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
inv <span class="token operator">=</span> invert<span class="token punctuation">(</span><span class="token number">0x10001</span><span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
c <span class="token operator">=</span> powmod<span class="token punctuation">(</span>cip<span class="token punctuation">,</span> inv<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">assert</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>q<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token number">505</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">modular_sqrt</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Find a quadratic residue (mod p) of 'a'. p
        must be an odd prime.

        Solve the congruence of the form:
            x^2 = a (mod p)
        And returns x. Note that p - x is also a root.

        0 is returned is no square root exists for
        these a and p.

        The Tonelli-Shanks algorithm is used (except
        for some simple cases in which the solution
        is known from an identity). This algorithm
        runs in polynomial time (unless the
        generalized Riemann hypothesis is false).
    """</span>
    <span class="token comment"># Simple cases</span>
    <span class="token comment">#</span>
    <span class="token keyword">if</span> legendre_symbol<span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">elif</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">elif</span> p <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">elif</span> p <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">4</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

    <span class="token comment"># Partition p-1 to s * 2^e for an odd s (i.e.</span>
    <span class="token comment"># reduce all the powers of 2 from p-1)</span>
    <span class="token comment">#</span>
    s <span class="token operator">=</span> p <span class="token operator">-</span> <span class="token number">1</span>
    e <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> s <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        s <span class="token operator">//=</span> <span class="token number">2</span>
        e <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token comment"># Find some 'n' with a legendre symbol n|p = -1.</span>
    <span class="token comment"># Shouldn't take long.</span>
    <span class="token comment">#</span>
    n <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">while</span> legendre_symbol<span class="token punctuation">(</span>n<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        n <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token comment"># Here be dragons!</span>
    <span class="token comment"># Read the paper "Square roots from 1; 24, 51,</span>
    <span class="token comment"># 10 to Dan Shanks" by Ezra Brown for more</span>
    <span class="token comment"># information</span>
    <span class="token comment">#</span>

    <span class="token comment"># x is a guess of the square root that gets better</span>
    <span class="token comment"># with each iteration.</span>
    <span class="token comment"># b is the "fudge factor" - by how much we're off</span>
    <span class="token comment"># with the guess. The invariant x^2 = ab (mod p)</span>
    <span class="token comment"># is maintained throughout the loop.</span>
    <span class="token comment"># g is used for successive powers of n to update</span>
    <span class="token comment"># both a and b</span>
    <span class="token comment"># r is the exponent - decreases with each update</span>
    <span class="token comment">#</span>
    x <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>s <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    b <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> s<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    g <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> s<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    r <span class="token operator">=</span> e

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> b
        m <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> m <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> t <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            t <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>

        <span class="token keyword">if</span> m <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> x

        gs <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token punctuation">(</span>r <span class="token operator">-</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
        g <span class="token operator">=</span> <span class="token punctuation">(</span>gs <span class="token operator">*</span> gs<span class="token punctuation">)</span> <span class="token operator">%</span> p
        x <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> gs<span class="token punctuation">)</span> <span class="token operator">%</span> p
        b <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> g<span class="token punctuation">)</span> <span class="token operator">%</span> p
        r <span class="token operator">=</span> m

<span class="token keyword">def</span> <span class="token function">legendre_symbol</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Compute the Legendre symbol a|p using
        Euler's criterion. p is a prime, a is
        relatively prime to p (if p divides
        a, then a|p = 0)

        Returns 1 if a has a square root modulo
        p, -1 otherwise.
    """</span>
    ls <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">if</span> ls <span class="token operator">==</span> p <span class="token operator">-</span> <span class="token number">1</span> <span class="token keyword">else</span> ls

m <span class="token operator">=</span> modular_sqrt<span class="token punctuation">(</span>c<span class="token punctuation">,</span> r<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="dpdq%E6%B3%84%E9%9C%B2">dp,dq泄露</h2>

<h3 class="mume-header" id="%E5%B7%B2%E7%9F%A5-p-q-dp-dq-c-%E6%B1%82%E6%98%8E%E6%96%87-m-dp-dq-%E6%B3%84%E9%9C%B2">已知 p、q、dp、dq、c 求明文 m (dp、dq 泄露)</h3>

<p>什么是 dp</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>dp=d%(p-1)
</code></pre><p>什么是 dq</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>dq=d%(q-1)
</code></pre><p><strong>例题 BUU RSA1</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python">p <span class="token operator">=</span> <span class="token number">8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229</span>
q <span class="token operator">=</span> <span class="token number">12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469</span>
dp <span class="token operator">=</span> <span class="token number">6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929</span>
dq <span class="token operator">=</span> <span class="token number">783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041</span>
c <span class="token operator">=</span> <span class="token number">24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852</span>

<span class="token keyword">import</span> gmpy2
I <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span>p<span class="token punctuation">)</span>
mp <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>dp<span class="token punctuation">,</span>p<span class="token punctuation">)</span>
mq <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>dq<span class="token punctuation">,</span>q<span class="token punctuation">)</span>               <span class="token comment">#求幂取模运算</span>

m <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mp<span class="token operator">-</span>mq<span class="token punctuation">)</span><span class="token operator">*</span>I<span class="token punctuation">)</span><span class="token operator">%</span>p<span class="token punctuation">)</span><span class="token operator">*</span>q<span class="token operator">+</span>mq       <span class="token comment">#求明文公式</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>                  <span class="token comment">#转为十六进制</span>
</pre><hr>
<h3 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-e-dp-c%E6%B1%82m-dp-%E6%B3%84%E9%9C%B2">已知 n、e、dp、c，求m (dp 泄露)</h3>

<pre data-role="codeBlock" data-info="" class="language-"><code>dp=d%(p-1)
</code></pre><p><strong>例题 RSA2</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span>  gmpy2
<span class="token keyword">import</span>  rsa
<span class="token keyword">import</span>  binascii
p<span class="token operator">=</span><span class="token number">0</span>
e<span class="token operator">=</span><span class="token number">65537</span>
c <span class="token operator">=</span> <span class="token number">140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span>
dp<span class="token operator">=</span><span class="token number">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span>
n<span class="token operator">=</span><span class="token number">248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span>
temp<span class="token operator">=</span>dp<span class="token operator">*</span>e
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span>i<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
        x<span class="token operator">=</span><span class="token punctuation">(</span>temp<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>i<span class="token operator">+</span><span class="token number">1</span>
        y<span class="token operator">=</span>n<span class="token operator">%</span>x
        <span class="token keyword">if</span> y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
            p<span class="token operator">=</span>x
            <span class="token keyword">break</span>
q<span class="token operator">=</span>n<span class="token operator">//</span>p
<span class="token comment">#'//'代表向下取整,'/'得到的是浮点数</span>
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
key<span class="token operator">=</span>rsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">(</span>n<span class="token punctuation">,</span>e<span class="token punctuation">,</span>d<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span>
m<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#unhexlify()的作用是返回16进制数对应的字符串</span>
</pre><hr>
<h2 class="mume-header" id="%E4%BD%8E%E8%A7%A3%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB">低解密指数攻击</h2>

<h3 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n%E6%B1%82-d-e%E6%9E%81%E5%A4%A7-wieners-attack">已知 e、n，求 d (e极大) (Wiener’s Attack)</h3>

<p>e过大 n分解不出来</p>
<p><strong>例题 BUU rsa2</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> owiener
e <span class="token operator">=</span> <span class="token number">3047442173541658754667464233797118324917469250436575767227172319344577259865313428705759330024959317716760816959590728238918140105663188172228696589411452947738069773833351725455888549656717874059636289036277785342126992626060696063089487811946920569580454880169977542532087635095357205433679009382368108273</span>

n <span class="token operator">=</span> <span class="token number">135568509670260054049994954417860747085442883428459182441559553532993752593294067458983143521109377661295622146963670193783017382697726454953197805014428888491744355387957923382241961401063461549210355871385000347645387907568135032087942016502668629010859519249039662555733548461551175133582871220209515648241</span>

d <span class="token operator">=</span> owiener<span class="token punctuation">.</span>attack<span class="token punctuation">(</span>e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token comment"># flag = "flag{" + hashlib.md5(hex(d).encode("utf8")).hexdigest() + "}"</span>
<span class="token comment"># print(flag)</span>
</pre><ul>
<li>
<p><a href="https://github.com/pablocelayes/rsa-wiener-attack">https://github.com/pablocelayes/rsa-wiener-attack</a></p>
<p>如果在运行脚本的时候报错，请在脚本前加上：</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span>   sys
sys<span class="token punctuation">.</span>setrecursionlimit<span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span>
</pre></li>
</ul>
<hr>
<h2 class="mume-header" id="%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB">低加密指数攻击</h2>

<h3 class="mume-header" id="e3-%E5%B0%8F%E5%85%AC%E9%92%A5%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB-%E5%B0%8F%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB-tereotyped-messages%E6%94%BB%E5%87%BB">e=3 (小公钥指数攻击) (小明文攻击) (tereotyped messages攻击)</h3>

<p>e 比较小，一般为 3</p>
<p><strong>例题 Extremely hard RSA</strong></p>
<p>用 openssl 读一下公钥</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>openssl rsa -pubin -in pubkey.pem -text -modulus
</code></pre><p>看到 e=3，很明显是小公钥指数攻击</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#/usr/bin/python</span>
<span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool
pool <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./pubkey.pem'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    N <span class="token operator">=</span> key<span class="token punctuation">.</span>n
    e <span class="token operator">=</span> key<span class="token punctuation">.</span>e
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    cipher <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
    cipher <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cipher<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">calc</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> j
    a<span class="token punctuation">,</span> b <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>cipher <span class="token operator">+</span> j <span class="token operator">*</span> N<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> b <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> a
        <span class="token keyword">print</span> <span class="token string">'{:x}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
        pool<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">SmallE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    inputs <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">130000000</span><span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">(</span>calc<span class="token punctuation">,</span> inputs<span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pool<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">'start'</span>
    SmallE<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p><strong>解法2</strong></p>
<ul>
<li><a href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a><pre data-role="codeBlock" data-info="" class="language-"><code>RsaCtfTool.py --dumpkey --key pubkey.pem
RsaCtfTool.py --publickey pubkey.pem --uncipherfile flag.enc --attack hastads
</code></pre></li>
</ul>
<p><strong>例题2 Dangerous RSA</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>#n:  0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793L
#e:  0x3
#c:0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365
so,how to get the message?
</code></pre><p>公钥中的加密指数 e 很小，但是模数 n 很大</p>
<p>有 RSA 加密公式： C=M^e % n (C 密文，M 明文)</p>
<p>则：</p>
<p>当 M^e &lt; n 时，C = M^e ，所以对 C 开方就能得到 M</p>
<p>当 M^e ＞ n 时，此时用爆破的方法</p>
<p>假设我们 Ｍ^e / n 的商为 k 余数为 C，则Ｍ^e = kn + C，对 K 进行爆破，只要 k 满足 kn + C 能够开 e 次方就可以得明文</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># -*- coding: utf-8 -*-#</span>
<span class="token comment">#python3</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> iroot
<span class="token keyword">import</span> libnum
e <span class="token operator">=</span> <span class="token number">0x3</span>
n <span class="token operator">=</span> <span class="token number">0x52d483c27cd806550fbe0e37a61af2e7cf5e0efb723dfc81174c918a27627779b21fa3c851e9e94188eaee3d5cd6f752406a43fbecb53e80836ff1e185d3ccd7782ea846c2e91a7b0808986666e0bdadbfb7bdd65670a589a4d2478e9adcafe97c6ee23614bcb2ecc23580f4d2e3cc1ecfec25c50da4bc754dde6c8bfd8d1fc16956c74d8e9196046a01dc9f3024e11461c294f29d7421140732fedacac97b8fe50999117d27943c953f18c4ff4f8c258d839764078d4b6ef6e8591e0ff5563b31a39e6374d0d41c8c46921c25e5904a817ef8e39e5c9b71225a83269693e0b7e3218fc5e5a1e8412ba16e588b3d6ac536dce39fcdfce81eec79979ea6872793</span>
c <span class="token operator">=</span> <span class="token number">0x10652cdfaa6b63f6d7bd1109da08181e500e5643f5b240a9024bfa84d5f2cac9310562978347bb232d63e7289283871efab83d84ff5a7b64a94a79d34cfbd4ef121723ba1f663e514f83f6f01492b4e13e1bb4296d96ea5a353d3bf2edd2f449c03c4a3e995237985a596908adc741f32365</span>

k <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> iroot<span class="token punctuation">(</span>c<span class="token operator">+</span>k<span class="token operator">*</span>n<span class="token punctuation">,</span>e<span class="token punctuation">)</span>  <span class="token comment">#c+k*n 开3次方根 能开3次方即可</span>
    <span class="token comment">#print(res)</span>
    <span class="token comment">#res = (mpz(13040004482819713819817340524563023159919305047824600478799740488797710355579494486728991357), True)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#转为字符串</span>
        <span class="token keyword">break</span>
    k<span class="token operator">=</span>k<span class="token operator">+</span><span class="token number">1</span>
</pre><p>第二种写法</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2

n <span class="token operator">=</span> <span class="token number">167301374477410718629594349645281326914434089992530877687003211679782894661758575488565941682050432268001204338578075919668073694767856492057865133587390911825807060433946917820651370344053528328094902693603505568585118920750295647737371418701653965110274085034584682022391405126061404348676703127840773433213906071664938863708646689806198452683548410312536652311486232204374119918052665188194284082981993123933019126250635236195620505623310226819070724330540988059137297320456628211063635075781377794363289036742972802441829857821669593841667056844922354061345810344570226493725115159881741439056901709252614302103855</span>
e <span class="token operator">=</span> <span class="token number">3</span>
c <span class="token operator">=</span><span class="token number">2217344750798296091193230394221582894657909643174934416842588335871298152598368701484028832407289746218387783855373449002121088413603751014125921242419602155087438902181522441026460003722677539409576093794862185483713606547386172606576925933695952279401957552813065318376293</span>

i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token operator">+</span>i<span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment">#开根号</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token operator">+</span>i<span class="token operator">*</span>n<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span>
</pre><p><strong>例题 强网杯2019 Copperstudy 第1层</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">#-*- coding:utf-8 -*-</span>

<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> binascii
c<span class="token operator">=</span><span class="token number">15987554724003100295326076036413163634398600947695096857803937998969441763014731720375196104010794555868069024393647966040593258267888463732184495020709457560043050577198988363754703741636088089472488971050324654162166657678376557110492703712286306868843728466224887550827162442026262163340935333721705267432790268517</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="e2%E6%97%B6%E7%9A%84%E5%B0%8F%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB">e=2时的小明文攻击</h3>

<p>e=2时，直接将密文C开平方获得解</p>
<p>由于e只有2，相当于把明文m平方而已，得到的C也比n小很多。尝试直接将C开根号看能否得到明文。</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>   <span class="token comment">#python第三方库</span>
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>    <span class="token comment">#python第三方库</span>

c<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>              <span class="token comment">#C的值</span>
m<span class="token operator">=</span>isqrt<span class="token punctuation">(</span>c<span class="token punctuation">)</span>            <span class="token comment">#开平方根</span>
<span class="token comment">#m=iroot(c,2)[0]      #开C的二次方根</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p>或</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
<span class="token keyword">import</span> codecs<span class="token punctuation">,</span>binascii
c <span class="token operator">=</span> <span class="token number">9217979941366220275377875095861710925207028551771520610387238734819759256223080175603032167658086669886661302962985046348865181740591251321966682848536331583243529</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>isqrt<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">sss</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            s <span class="token operator">=</span> <span class="token string">"0x"</span> <span class="token operator">+</span> s

    <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>codecs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> sss<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="e1%E6%97%B6%E7%9A%84%E5%B0%8F%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB">e=1时的小明文攻击</h3>

<p>加密过程： C≡m mod n ,明文与密文同模</p>
<p>所以有：m=C+n*k,爆破k</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>

n<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
c<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
max_num <span class="token operator">=</span> <span class="token number">7</span>   <span class="token comment">#设置遍历上限</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>max_num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> c <span class="token operator">+</span> n<span class="token operator">*</span>k
    <span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="e2-rabin%E7%AE%97%E6%B3%95">e=2 (Rabin算法)</h3>

<p><strong>例题 JarvisOJ: hard RSA</strong></p>
<p>Rabin加密中的N可被分解</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>n: 87924348264132406875276140514499937145050893665602592992418171647042491658461
e: 2
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> codecs

<span class="token keyword">def</span> <span class="token function">squareMod</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">:</span>          <span class="token comment"># 模意义下开根，找到 x, 使得 x^2 % mod = c</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>mod <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>mod<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">4</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res<span class="token punctuation">,</span> mod <span class="token operator">-</span> res

<span class="token keyword">def</span> <span class="token function">getPlaintext</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 假设 m%p=x, m%q=y, 求明文</span>
    res <span class="token operator">=</span> x<span class="token operator">*</span>q<span class="token operator">*</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token operator">+</span> y<span class="token operator">*</span>p<span class="token operator">*</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res <span class="token operator">%</span> <span class="token punctuation">(</span>p<span class="token operator">*</span>q<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>             <span class="token comment"># 已知 p,q, 解密 c</span>
    px <span class="token operator">=</span> squareMod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> p<span class="token punctuation">)</span>
    py <span class="token operator">=</span> squareMod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> q<span class="token punctuation">)</span>

    <span class="token keyword">for</span> x <span class="token keyword">in</span> px<span class="token punctuation">:</span>
        <span class="token keyword">for</span> y <span class="token keyword">in</span> py<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> getPlaintext<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>codecs<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> base<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> <span class="token number">275127860351348928173285174381581152299</span>
q <span class="token operator">=</span> <span class="token number">319576316814478949870590164193048041239</span>

<span class="token keyword">for</span> msg <span class="token keyword">in</span> solve<span class="token punctuation">(</span>c<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token operator">+</span> res

    <span class="token keyword">print</span><span class="token punctuation">(</span>codecs<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>例题 buu 坏蛋是雷宾</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>老牌刺客之王混进了女王的住所。一天，女王得到了一个匿名举报，说她的侍卫里有一个刺客，叫做Rabin，而他的信息就在一份文件里，文件中有附带一个Pk，是523798549，密文是162853095，校验码二进制值是110001，根据说明是放在明文后一起加密的，明文与密文长度相同。加密算法和这位老牌刺客同名。快拯救女王，答案是求得的明文，进行32位md5小写哈希字符串，提交即可。 注意：得到的 flag 请包上 flag{} 提交
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> hashlib
n<span class="token operator">=</span><span class="token number">523798549</span>
p<span class="token operator">=</span><span class="token number">10663</span>
q<span class="token operator">=</span><span class="token number">49123</span>
e<span class="token operator">=</span><span class="token number">2</span>
c<span class="token operator">=</span><span class="token number">162853095</span>
inv_p <span class="token operator">=</span> invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
inv_q <span class="token operator">=</span> invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span> p<span class="token punctuation">)</span>

mp <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>
mq <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token punctuation">(</span>q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span>

a <span class="token operator">=</span> <span class="token punctuation">(</span>inv_p <span class="token operator">*</span> p <span class="token operator">*</span> mq <span class="token operator">+</span> inv_q <span class="token operator">*</span> q <span class="token operator">*</span> mp<span class="token punctuation">)</span> <span class="token operator">%</span> n
b <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span>inv_p <span class="token operator">*</span> p <span class="token operator">*</span> mq <span class="token operator">-</span> inv_q <span class="token operator">*</span> q <span class="token operator">*</span> mp<span class="token punctuation">)</span> <span class="token operator">%</span> n
d <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">bin</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB-basic-broadcast-attack-%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E5%B9%BF%E6%92%AD%E6%94%BB%E5%87%BB">广播攻击 (Basic Broadcast Attack) (低加密指数广播攻击)</h3>

<p>如果选取的加密指数较低，并且使用了相同的加密指数给一个接受者的群发送相同的信息，那么可以进行广播攻击得到明文。</p>
<p>识别起来比较简单，一般来说都是给了多组加密的参数和明密文，其中告诉你这多组的明文都是一样的，并且e都取了一个较小的数字。</p>
<p>加密指数 e 非常小</p>
<p>一份明文使用不同的模数 n，相同的加密指数 e 进行多次加密</p>
<p>可以拿到每一份加密后的密文和对应的模数 n、加密指数 e</p>
<p>通过对不同的 n 进行 gcd() 算法，求出最大公约数，（即 p）</p>
<p>求出 P 了，就能求出 q，进而求出 d， 解出明文 m</p>
<p><strong>例题 BUU RSA4</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>N = 331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004
c = 310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243

N = 302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114
c = 112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344

N = 332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323
c = 10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>

<span class="token comment"># 将5进制数转换为10进制数  int('',5)</span>
N1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

N2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

N3 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
c3 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">'10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

e<span class="token operator">=</span><span class="token number">3</span>

n <span class="token operator">=</span> <span class="token punctuation">[</span>N1<span class="token punctuation">,</span>N2<span class="token punctuation">,</span>N3<span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">CRT</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    N <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>x<span class="token operator">*</span>y<span class="token punctuation">,</span>n<span class="token punctuation">)</span>   <span class="token comment"># ni 的乘积,N=n1*n2*n3</span>

    <span class="token keyword">for</span> n_i<span class="token punctuation">,</span> a_i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># zip()将对象打包成元组</span>
        N_i <span class="token operator">=</span> N <span class="token operator">//</span> n_i           <span class="token comment">#Mi=M/ni</span>
        <span class="token builtin">sum</span> <span class="token operator">+=</span> a_i<span class="token operator">*</span>N_i<span class="token operator">*</span>invert<span class="token punctuation">(</span>N_i<span class="token punctuation">,</span>n_i<span class="token punctuation">)</span>   <span class="token comment">#sum=C1M1y1+C2M2y2+C3M3y3</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span> <span class="token operator">%</span> N

x <span class="token operator">=</span> CRT<span class="token punctuation">(</span>c<span class="token punctuation">,</span>n<span class="token punctuation">)</span>

m <span class="token operator">=</span> iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>           <span class="token comment">#开e次方根</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>               <span class="token comment">#数值转字符串</span>
</pre><p><strong>例题 强网杯2019 Copperstudy 第4层</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>[+]e=3

[+]m=random.getrandbits(512)

[+]n1=78642188663937191491235684351005990853149481644703243255021321296087539054265733392095095639539412823093600710316645130404423641473150336492175402885270861906530337207734106926328737198871118125840680572148601743121884788919989184318198417654263598170932154428514561079675550090698019678767738203477097731989


[+]c1=pow(m,e,n1)=23419685303892339080979695469481275906709035609088426118328601771163101123641599051556995351678670765521269546319724616458499631461037359417701720430452076029312714313804716888119910334476982840024696320503747736428099717113471541651211596481005191146454458591558743268791485623924245960696651150688621664860

[+]n2==98174485544103863705821086588292917749386955237408645745685476234349659452606822650329076955303471252833860010724515777826660887118742978051231030080666542833950748806944312437614585352818344599399156268450521239843157288915059003487783576003027303399985723834248634230998110618288843582573006048070816520647


[+]c2=pow(m,e,n2)=72080679612442543693944655041130370753964497034378634203383617624269927191363529233872659451561571441107920350406295389613006330637565645758727103723546610079332161151567096389071050158035757745766399510575237344950873632114050632573903701015749830874081198250578516967517980592506626547273178363503100507676

[+]n3=91638855323231795590642755267985988356764327384001022396221901964430032527111968159623063760057482761918901490239790230176524505469897183382928646349163030620342744192731246392941227433195249399795012672172947919435254998997253131826888070173526892674308708289629739522194864912899817994807268945141349669311

[+]c3=pow(m,e,n3)=22149989692509889061584875630258740744292355239822482581889060656197919681655781672277545701325284646570773490123892626601106871432216449814891757715588851851459306683123591338089745675044763551335899599807235257516935037356212345033087798267959242561085752109746935300735969972249665700075907145744305255616

[-]long_to_bytes(m).encode('hex')=
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> functools <span class="token keyword">import</span> <span class="token builtin">reduce</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> binascii

<span class="token keyword">def</span> <span class="token function">chinese_remainder</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    prod <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> a<span class="token punctuation">,</span> b<span class="token punctuation">:</span> a <span class="token operator">*</span> b<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">for</span> n_i<span class="token punctuation">,</span> a_i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> prod <span class="token operator">//</span> n_i
        <span class="token builtin">sum</span> <span class="token operator">+=</span> a_i <span class="token operator">*</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span> n_i<span class="token punctuation">)</span> <span class="token operator">*</span> p
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">sum</span> <span class="token operator">%</span> prod<span class="token punctuation">)</span>
n1<span class="token operator">=</span><span class="token number">78642188663937191491235684351005990853149481644703243255021321296087539054265733392095095639539412823093600710316645130404423641473150336492175402885270861906530337207734106926328737198871118125840680572148601743121884788919989184318198417654263598170932154428514561079675550090698019678767738203477097731989</span>
c1<span class="token operator">=</span><span class="token number">23419685303892339080979695469481275906709035609088426118328601771163101123641599051556995351678670765521269546319724616458499631461037359417701720430452076029312714313804716888119910334476982840024696320503747736428099717113471541651211596481005191146454458591558743268791485623924245960696651150688621664860</span>
n2<span class="token operator">=</span><span class="token number">98174485544103863705821086588292917749386955237408645745685476234349659452606822650329076955303471252833860010724515777826660887118742978051231030080666542833950748806944312437614585352818344599399156268450521239843157288915059003487783576003027303399985723834248634230998110618288843582573006048070816520647</span>
c2<span class="token operator">=</span><span class="token number">72080679612442543693944655041130370753964497034378634203383617624269927191363529233872659451561571441107920350406295389613006330637565645758727103723546610079332161151567096389071050158035757745766399510575237344950873632114050632573903701015749830874081198250578516967517980592506626547273178363503100507676</span>
n3<span class="token operator">=</span><span class="token number">91638855323231795590642755267985988356764327384001022396221901964430032527111968159623063760057482761918901490239790230176524505469897183382928646349163030620342744192731246392941227433195249399795012672172947919435254998997253131826888070173526892674308708289629739522194864912899817994807268945141349669311</span>
c3<span class="token operator">=</span><span class="token number">22149989692509889061584875630258740744292355239822482581889060656197919681655781672277545701325284646570773490123892626601106871432216449814891757715588851851459306683123591338089745675044763551335899599807235257516935037356212345033087798267959242561085752109746935300735969972249665700075907145744305255616</span>

n<span class="token operator">=</span><span class="token punctuation">[</span>n1<span class="token punctuation">,</span>n2<span class="token punctuation">,</span>n3<span class="token punctuation">]</span>
c<span class="token operator">=</span><span class="token punctuation">[</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token punctuation">]</span>
ans<span class="token operator">=</span>chinese_remainder<span class="token punctuation">(</span>n<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
ans<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>ans<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment"># e = 3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>ans<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="coppersmith%E6%94%BB%E5%87%BB">Coppersmith攻击</h2>

<h3 class="mume-header" id="%E5%B7%B2%E7%9F%A5-e-n-p%E9%AB%98%E4%BD%8D%E5%B7%B2%E7%9F%A5%E4%BD%8E%E4%BD%8D%E6%9C%AA%E7%9F%A5-%E5%B7%B2%E7%9F%A5%E9%AB%98%E4%BD%8D%E6%94%BB%E5%87%BB-factoring-with-high-bits-known-attack">已知 e、n、P高位已知，低位未知 (已知高位攻击) (Factoring with high bits known Attack)</h3>

<pre data-role="codeBlock" data-info="" class="language-"><code># n:0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L
# e:65537
# enc:1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361
# p&gt;&gt;128&lt;&lt;128:0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L
</code></pre><ul>
<li><a href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a></li>
</ul>
<pre data-role="codeBlock" data-info="sage" class="language-sage"><code>n = 0xb119849bc4523e49c6c038a509a74cda628d4ca0e4d0f28e677d57f3c3c7d0d876ef07d7581fe05a060546fedd7d061d3bc70d679b6c5dd9bc66c5bdad8f2ef898b1e785496c4989daf716a1c89d5c174da494eee7061bcb6d52cafa337fc2a7bba42c918bbd3104dff62ecc9d3704a455a6ce282de0d8129e26c840734ffd302bec5f0a66e0e6d00b5c50fa57c546cff9d7e6a978db77997082b4cb927df9847dfffef55138cb946c62c9f09b968033745b5b6868338c64819a8e92a827265f9abd409359a9471d8c3a2631b80e5b462ba42336717700998ff38536c2436e24ac19228cd2d7a909ead1a8494ff6c3a7151e888e115b68cc6a7a8c6cf8a6c005L
p_fake = 0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b00000000000000000000000000000000L

pbits = 1024
kbits = 128
pbar = p_fake &amp; (2^pbits-2^kbits)
print("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))

PR.&lt;x&gt; = PolynomialRing(Zmod(n))
f = x + pbar

x0 = f.small_roots(X=2^kbits, beta=0.4)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.3
print(hex(int(x0 + pbar)))
</code></pre><p>得到 p=0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3</p>
<p>由q=n//p得到q,接下来直接跑就行了</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p2<span class="token operator">=</span><span class="token number">0xe4e4b390c1d201dae2c00a4669c0865cc5767bc444f5d310f3cfc75872d96feb89e556972c99ae20753e3314240a52df5dccd076a47c6b5d11b531b92d901b2b512aeb0b263bbfd624fe3d52e5e238beeb581ebe012b2f176a4ffd1e0d2aa8c4d3a2656573b727d4d3136513a931428b92826225b6d0e735440b613a8336ffa3</span>

n2<span class="token operator">=</span><span class="token number">22356763374676421464625378500213339933332772809897207920729779273423674391734609826525432054721219700275907299132471518921609327317193522567659631757746842030241874692914098354564311806192080734895649520789778880115460999713973202684541940857690744940359412410680906226760273075221532248260114209496048785258860756023841150910290983974843412361701517438220974722832625030127395031631696995777436058406987465592189873785392136925593708921923255186282515777996509326779993612528103615281644689464568237409082282767318227236298791238683706176542426759149262625349498709445342710799386836175120162674849965878446213480453</span>

c<span class="token operator">=</span><span class="token number">1422566584480199878714663051468143513667934216213366733442059106529451931078271460363335887054199577950679102659270179475911101747625120544429262334214483688332111552004535828182425152965223599160129610990036911146029170033592055768983427904835395850414634659565092191460875900237711597421272312032796440948509724492027247376113218678183443222364531669985128032971256792532015051829041230203814090194611041172775368357197854451201260927117792277559690205342515437625417792867692280849139537687763919269337822899746924269847694138899165820004160319118749298031065800530869562704671435709578921901495688124042302500361</span>
e<span class="token operator">=</span><span class="token number">65537</span>
q2<span class="token operator">=</span>n2<span class="token operator">//</span>p2
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>256 的版本</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> flag <span class="token keyword">import</span> flag
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q

m <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>

<span class="token keyword">print</span> n
<span class="token keyword">print</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span> p<span class="token operator">&gt;&gt;</span><span class="token number">256</span><span class="token operator">&lt;&lt;</span><span class="token number">256</span>

<span class="token comment"># output</span>
<span class="token comment"># 26406507468595611843852094067483173843988114465094045314324958205247973393878612589146897816881236818219902539975703710689353618174826904300589643161784341674436810639999244652231756242284615955258973430337702733454791782484002773967293198343866259490519754466626455660967042613249021854707331393440280088268816341057924652807723419166490363777181753297185283416885627445213950857480287818564281651822264024891956284486733856518809532470029519647769749231421957169481281821885757924521580543834665554242403238567286205389138437021157096962185096308108489101554724344868500500476691994206988217768341711716527866730487</span>
<span class="token comment"># 22371088752722216457725632164373582195669473128756299754645443284929524768654545905154985577175225182544638209286885657892360668965805613727315024761409924679131145149936406239774150607378706790494820180586939668429812955766507811860718575149988809217701964019618239260041070894375952033566803105327100696642244951676616707205397327491933042019560545721027871057909242509336729865025061616686254481161431063503607378134616485979961926628954536592552923269161255759846497309277397441639921544384778106116567555705005440627393593876072210594939647990615797269482726733444406876986888296295032722008287447468255108089357</span>
<span class="token comment"># 159945952275533485818121954231313618960321976049710904254772419907677971914439101482974923293074598678164025819370654132149566696084245679106109087142916286461708005676333840438629476722637189134626565206159794947442549588155962485884562239895738265024295739578695834796427810095412842888401159276765814718464</span>
</pre><p>修改位数为256即可解出p</p>
<pre data-role="codeBlock" data-info="sage" class="language-sage"><code>n = 26406507468595611843852094067483173843988114465094045314324958205247973393878612589146897816881236818219902539975703710689353618174826904300589643161784341674436810639999244652231756242284615955258973430337702733454791782484002773967293198343866259490519754466626455660967042613249021854707331393440280088268816341057924652807723419166490363777181753297185283416885627445213950857480287818564281651822264024891956284486733856518809532470029519647769749231421957169481281821885757924521580543834665554242403238567286205389138437021157096962185096308108489101554724344868500500476691994206988217768341711716527866730487
p_fake = 159945952275533485818121954231313618960321976049710904254772419907677971914439101482974923293074598678164025819370654132149566696084245679106109087142916286461708005676333840438629476722637189134626565206159794947442549588155962485884562239895738265024295739578695834796427810095412842888401159276765814718464

pbits = 1024
kbits = 256
pbar = p_fake &amp; (2^pbits-2^kbits)
print("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))

PR.&lt;x&gt; = PolynomialRing(Zmod(n))
f = x + pbar

x0 = f.small_roots(X=2^kbits, beta=0.4)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.3
print(hex(int(x0 + pbar)))
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p2<span class="token operator">=</span><span class="token number">0xe3c545d18d3292c89e6075bdf276824fac4887651f2aa17c1aae5cf7c1638fe280a2f636b3eb5b549239e75519e217610fc59f7b8ffac8cab87a047efc8499b09121ff486cbf929ebb6880092b0a89d4901b13eabdaae047e2f9821b78bb98814c88e444a7a2db5e9f3789a5855791c29cbdd5debbed8eba0714d80cc1583e71</span>

n2<span class="token operator">=</span><span class="token number">26406507468595611843852094067483173843988114465094045314324958205247973393878612589146897816881236818219902539975703710689353618174826904300589643161784341674436810639999244652231756242284615955258973430337702733454791782484002773967293198343866259490519754466626455660967042613249021854707331393440280088268816341057924652807723419166490363777181753297185283416885627445213950857480287818564281651822264024891956284486733856518809532470029519647769749231421957169481281821885757924521580543834665554242403238567286205389138437021157096962185096308108489101554724344868500500476691994206988217768341711716527866730487</span>
c<span class="token operator">=</span><span class="token number">22371088752722216457725632164373582195669473128756299754645443284929524768654545905154985577175225182544638209286885657892360668965805613727315024761409924679131145149936406239774150607378706790494820180586939668429812955766507811860718575149988809217701964019618239260041070894375952033566803105327100696642244951676616707205397327491933042019560545721027871057909242509336729865025061616686254481161431063503607378134616485979961926628954536592552923269161255759846497309277397441639921544384778106116567555705005440627393593876072210594939647990615797269482726733444406876986888296295032722008287447468255108089357</span>
e<span class="token operator">=</span><span class="token number">65537</span>
q2<span class="token operator">=</span>n2<span class="token operator">//</span>p2
d<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>long_to_bytes<span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>例题3</strong></p>
<pre data-role="codeBlock" data-info="sega" class="language-sega"><code># p = 0x00f23799c031b942026e420769b74d22fa2114428189139c43c366c6ab8367c6b3d6f821449aafb2058b0e6ed964fa0ad45fb306f96376e80823a72b58101919e50acad3b5e6d079e7ff9218ed6df6edbef536742714ce88b2e717f45af53ef0d04c89faf01c80b28e764973aba27726c85c0236e8756a865c03577722bac5e391
# q = 0x00c9d24330fa4945cfe1e5d6912d6bde0231035a1cc8d8ae67d949347b895f8d579bce2adaf37c568957b17a6564dbf80d36d81e4622ab30e02132b0155aefbd3912a27c625a9b7b05bc72217039f5aa88c20cbf9871c3228e9d80d9106f94b11c1f50c40c96862b5cd6b6f781883dd2eff80a059d3ca027af6a03edeb34a7390f
# n = p*q
e = 3
n = 0x4ac5cbf84a2f9a1042c552c77075459d2273994453caea11fbf696b9a8d41937b48be43c71ec6c37470ba9d280a23301b817314a94c786962e4a98ddb260bf2d53a51a6f9c87258110fb2bc9fe8fa44a24e6f95fd5d098bd907d5f8565a0ed7c681cf5e6a79b28438077f6b8d3ae1edf4229102b4ebe29d1f37b9357d3ffff39
p = 0x80f7a73798f638d10180223d7b482035b69b51ffe09ad9e42602cc9d489837be7d1ac92e90b09837144c1220ed4ff0ea00000000000000000000000000000000
beta = 0.5
epsilon = beta^2/7

pbits = p.nbits()
kbits = floor(n.nbits()*(beta^2-epsilon))
pbar = p &amp; (2^pbits-2^kbits)
print ("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))

PR.&lt;x&gt; = PolynomialRing(Zmod(n))
f = x + pbar

print ('p_fake =',p)
x0 = f.small_roots(X=2^kbits, beta=0.3)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.3
print ('p =',x0 + pbar)
</code></pre><p><strong>例题4</strong></p>
<pre data-role="codeBlock" data-info="sega" class="language-sega"><code>n = 0x73cec712124b33c0294e01eb52e8c3cd2fe9ddbcbf457b3b950360063dfae42cbbe9855bd986bcfea0948fadfb252f5e2ff3c982ff47afb6596a496636f1fc5ecfe9f5db7620b23fe9e30d230aa9299ab9a78bfb5e0630fd1149259b2b2104ea65d2e27b89785e4bf01d0594d9f94575cbcc3383f63c5aabe4d5b48eb761cce3ab21689b3f3155b5f15efee240d5ac11cee2acbd019de7c06f607ea618b5cd735b5a6972d2b446a12ff58cf8314822fa5ea09d0963acd00441b2a1b37aca01d7f39052927db98a0bd5ca1c49a7ad67923e3aac30ecd33cc8b4b30a40cdb3acc721ee5da53a02977cee959affe672a668525eb78df96af0a14f4ac04fab68efa8eabe9535e1064a5fc2ff7cac9520210311db0c3bf91101bc55a67a81e4f69364c724ee6ad6bdc301df642c9392e9befa4ff0d65481adb6feac251cd207044587da9710809700246cb3c63e659a97249f5e7418568e37db2fb2c1115e719d6682bb2e89b4e23d40ba4c532f289e10e0b89a5647c486a09b9e376844171b229d74f871004d4945a702a391a04ac704f43809e972891e6ab33b3c0f03f0b6f9ae005b26be6e647a1865c727277423f59a595187ffbfea13501e23b6b57ef115eaa6febcb207a3112628652a39578847241c33989e84607b0f683b30ddf773348b07360b063d9120a397809591ca18a04cd32ad9cbfe0494ed3ae8d2c5b43fdb51cb
p_fake = 25469341510015610710601677541490068882874022771473379147959682877979811860690835905177575433486769235926750944378553837429714908846121392087707617153368450157831411033840331452402635316893579428297241392591768100008774205252294780519995317089863801331600746389471563346749402400584048767782402832414560955794979239140648096754408560344380360521300295416056532504527346890878830708030202503589314586128121926254376071861981570648841288044240102936057199541504839050994656267226010545841307490110261343492485615893311098351703701000220286503350522201318815497988460167971677642567134161349144833221240627311534482202273
pbits = p_fake.nbits()
kbits = 900
#kbits = 200
pbar = p_fake &amp; (2^pbits-2^kbits)
print ("upper %d bits (of %d bits) is given" % (pbits-kbits, pbits))
PR.&lt;x&gt; = PolynomialRing(Zmod(n))
f = x + pbar
x0 = f.small_roots(X=2^kbits, beta=0.4)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.3
p= x0 + pbar
print ('p =',p)
</code></pre><p><strong>例题5 强网杯2019 Copperstudy 第2层</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>[+]Generating challenge 2


  [+]n=12784625729032789592766625203074018101354917751492952685083808825504221816847310910447532133616954262271205877651255598995305639194329607493047941212754523879402744065076183778452640602625242851184095546100200565113016690161053808950384458996881574266573992526357954507491397978278604102524731393059303476350167738237822647246425836482533150025923051544431330502522043833872580483142594571802189321599016725741260254170793393777293145010525686561904427613648184843619301241414264343057368192416551134404100386155751297424616254697041043851852081071306219462991969849123668248321130382231769250865190227630009181759219

[+]e=65537

[+]m=random.getrandbits(512)

[+]c=pow(m,e,n)=627824086157119245056478875800598959553774250161670787506083253960788230737588761787385686125828765665617567887904228030839535317987589608761534500003128247164233774794784231518212804270056404565710426613938264302998015421153393879729263551292024543756422702956470022959537221269172084619081368498693930550456153543628170306324206266216348386707008661128717431426237486511309767286175518238620230507201952867261283880986868752676549613958785288914989429224582849218395471672295410036858881836363364885164276983237312235831591858044908369376855484127614933545955544787160352042318378588039587911741028067576722790778

[+]((p&gt;&gt;128)&lt;&lt;128)=97522826022187678545924975588711975512906538181361325096919121233043973599759518562689050415761485716705615149641768982838255403594331293651224395590747133152128042950062103156564440155088882592644046069208405360324372057140890317518802130081198060093576841538008960560391380395697098964411821716664506908672

[-]long_to_bytes(m).encode('hex')=
</code></pre><pre data-role="codeBlock" data-info="sega" class="language-sega"><code>p4 = 286593827663265980875510954967316219073448170030900062579915534986706486906458307884391633081975974889868808093084141196610789229262338742207816117361927894904776552676541036673244090334164798443162932914355966770450894047111793505063044583029134192122352988382684883337
n = 12784625729032789592766625203074018101354917751492952685083808825504221816847310910447532133616954262271205877651255598995305639194329607493047941212754523879402744065076183778452640602625242851184095546100200565113016690161053808950384458996881574266573992526357954507491397978278604102524731393059303476350167738237822647246425836482533150025923051544431330502522043833872580483142594571802189321599016725741260254170793393777293145010525686561904427613648184843619301241414264343057368192416551134404100386155751297424616254697041043851852081071306219462991969849123668248321130382231769250865190227630009181759219
pbits = 1024
kbits = pbits - p4.nbits()
print (p4.nbits())
p4 = p4 &lt;&lt; kbits
PR.&lt;x&gt; = PolynomialRing(Zmod(n))
f = x + p4
x0 = f.small_roots(X=2^kbits, beta=0.4)[0]
print ("x:" ,hex(int(x0)))
p = p4+x0
print ("p: ", hex(int(p)))
assert n % p == 0
q = n/int(p)
print ("q: ", hex(int(q)))
</code></pre><p>有了 p 和 q 就是正常的 RSA 了。</p>
<hr>
<h3 class="mume-header" id="%E5%B7%B2%E7%9F%A5d%E7%9A%84%E4%BD%8E%E4%BD%8D%E6%94%BB%E5%87%BB-partial-key-exposure-attack-%E9%83%A8%E5%88%86%E7%A7%81%E9%92%A5%E6%9A%B4%E9%9C%B2%E6%94%BB%E5%87%BB">已知d的低位攻击 (Partial Key Exposure Attack) (部分私钥暴露攻击)</h3>

<p>可攻击特征</p>
<ul>
<li>题目给出一组公钥n,e以及加密后的密文</li>
<li>若e较小，已知d的低位，则可通过此方法求出完整的d。</li>
</ul>
<p><strong>例题 强网杯2019 Copperstudy 第3层</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>[+]Generating challenge 3


  [+]n=92896523979616431783569762645945918751162321185159790302085768095763248357146198882641160678623069857011832929179987623492267852304178894461486295864091871341339490870689110279720283415976342208476126414933914026436666789270209690168581379143120688241413470569887426810705898518783625903350928784794371176183

[+]e=3

[+]m=random.getrandbits(512)

[+]c=pow(m,e,n)=56164378185049402404287763972280630295410174183649054805947329504892979921131852321281317326306506444145699012788547718091371389698969718830761120076359634262880912417797038049510647237337251037070369278596191506725812511682495575589039521646062521091457438869068866365907962691742604895495670783101319608530

[+]d&amp;((1&lt;&lt;512)-1)=787673996295376297668171075170955852109814939442242049800811601753001897317556022653997651874897208487913321031340711138331360350633965420642045383644955

[-]long_to_bytes(m).encode('hex')=
</code></pre><pre data-role="codeBlock" data-info="sage" class="language-sage"><code>def partial_p(p0, kbits, n):
    PR.&lt;x&gt; = PolynomialRing(Zmod(n))
    nbits = n.nbits()

    f = 2^kbits*x + p0
    f = f.monic()
    roots = f.small_roots(X=2^(nbits//2-kbits), beta=0.3)  # find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3
    if roots:
        x0 = roots[0]
        p = gcd(2^kbits*x0 + p0, n)
        return ZZ(p)

def find_p(d0, kbits, e, n):
    X = var('X')

    for k in range(1, e+1):
        results = solve_mod([e*d0*X - k*X*(n-X+1) + k*n == X], 2^kbits)
        for x in results:
            p0 = ZZ(x[0])
            p = partial_p(p0, kbits, n)
            if p:
                return p


if __name__ == '__main__':
    n = 92896523979616431783569762645945918751162321185159790302085768095763248357146198882641160678623069857011832929179987623492267852304178894461486295864091871341339490870689110279720283415976342208476126414933914026436666789270209690168581379143120688241413470569887426810705898518783625903350928784794371176183
    e = 3
    d = 787673996295376297668171075170955852109814939442242049800811601753001897317556022653997651874897208487913321031340711138331360350633965420642045383644955

    nbits = n.nbits()
    kbits = d.nbits()

    print ("lower %d bits (of %d bits) is given" % (kbits, nbits))

    p = find_p(d, kbits, e, n)
    q = n//p
    print ("d0 = %d" % d)
    print ("d = %d" % inverse_mod(e, (p-1)*(q-1)))
</code></pre><p>得到d后就是正常的RSA解密了：</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

d <span class="token operator">=</span> <span class="token number">61931015986410954522379841763963945834108214123439860201390512063842165571430799255094107119082046571341221952786658415661511901536119262974324197242727901361853519060099176095718398341546521709753140715090423775413590463159715914497625346364363050316931779727154988269576808476796380941227956316802411370267</span>
n <span class="token operator">=</span> <span class="token number">92896523979616431783569762645945918751162321185159790302085768095763248357146198882641160678623069857011832929179987623492267852304178894461486295864091871341339490870689110279720283415976342208476126414933914026436666789270209690168581379143120688241413470569887426810705898518783625903350928784794371176183</span>
e <span class="token operator">=</span> <span class="token number">3</span>
c <span class="token operator">=</span> <span class="token number">56164378185049402404287763972280630295410174183649054805947329504892979921131852321281317326306506444145699012788547718091371389698969718830761120076359634262880912417797038049510647237337251037070369278596191506725812511682495575589039521646062521091457438869068866365907962691742604895495670783101319608530</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h3 class="mume-header" id="%E6%98%8E%E6%96%87%E9%AB%98%E4%BD%8D%E7%9B%B8%E5%90%8C">明文高位相同</h3>

<pre data-role="codeBlock" data-info="sega" class="language-sega"><code>def short_pad_attack(c1, c2, e, n):
    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))
    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))
    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))

    g1 = x^e - c1
    g2 = (x+y)^e - c2

    q1 = g1.change_ring(PRZZ)
    q2 = g2.change_ring(PRZZ)

    h = q2.resultant(q1)
    h = h.univariate_polynomial()
    h = h.change_ring(PRx).subs(y=xn)
    h = h.monic()

    kbits = n.nbits()//(2*e*e)
    diff = h.small_roots(X=2^kbits, beta=0.5)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.5

    return diff

def related_message_attack(c1, c2, diff, e, n):
    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))
    g1 = x^e - c1
    g2 = (x+diff)^e - c2

    def gcd(g1, g2):
        while g2:
            g1, g2 = g2, g1 % g2
        return g1.monic()

    return -gcd(g1, g2)[0]

if __name__ == '__main__':
    n = 0x2030ca024a23fb978752ccc2897947fd9c82b682915771e447fc1eefa6be8cbcc00df7cc2dfc401516b88b06a044b6fa595ce67f7b02f4a441a2a4495fb05463da88b059f4c1a924b3f6bc1e2a4938be37f5a44dd7a495c6bb264fdae9eda265f5a4c2a5147d84566d8122e25954b94575ec97f4d979fff756f95cbfcc49fcc9
    e = 3

    #nbits = n.nbits()
    #kbits = nbits//(2*e*e)
    #print "upper %d bits (of %d bits) is same" % (nbits-kbits, nbits)

    # ^^ = bit-wise XOR
    # http://doc.sagemath.org/html/en/faq/faq-usage.html#how-do-i-use-the-bitwise-xor-operator-in-sage
    #m1 = randrange(2^nbits)
    #m2 = m1 ^^ randrange(2^kbits)
    #c1 = pow(m1, e, n)
    #c2 = pow(m2, e, n)
    c1=0x45204e3e2d780d6fded3ed4c53ca2a0300a78bd7f9b30afb5e3267bcb7074756ab386a165cf0678e3af272151b0635c784df30117f89d92afe83156d55fc8d45f0d9db0b868737cad674e2407fc83e234498542162f86132f2edaed3580b8da605a3d2df4ccd49150aed3686401790e5d0742ef5288d756fd9a011666c4018d
    c2=0x1c17423e4aa0ee916c513f9f6f7f7f6efda060974ad06282bd846a50571c2b26465aba50a48eda745b0bb5b410d0b89a199256d5034cb2932a03b0b9dffa065a01c856ff967addc8834e9e09d8d51c020f2a115144e20ac17dd23bb645db39f71eb22aa9175f92bc822c102270f183b1cf60cd6460d6cc28624a9cedbd17484c

    diff = short_pad_attack(c1, c2, e, n)
    print ("difference of two messages is %d" % diff)

    #print m1
    m1 = related_message_attack(c1, c2, diff, e, n)
    print ('m1 =',m1)
    #print m2
    print ('m2 =',m1 + diff)
    print ('diff =',diff)
</code></pre><h3 class="mume-header" id="%E9%AB%98%E4%BD%8D%E5%90%8Cm-%E7%9F%AD%E5%A1%AB%E5%85%85%E6%94%BB%E5%87%BB-coppersmith-shortpad-attack-related-message-attack">高位同m (短填充攻击) (Coppersmith Shortpad Attack) (Related Message Attack)</h3>

<p><strong>例题 强网杯2019 Copperstudy 第5层</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>[+]Generating challenge 5

  [+]n= 113604829563460357756722229849309932731534576966155520277171862442445354404910882358287832757024693652075211204635679309777620586814014894544893424988818766425089667672311645586528776360047956843961901352792631908859388801090108188344342619580661377758180391734771694803991493164412644148805229529911069578061

[+]e=7

[+]m=random.getrandbits(512)

[+]c=pow(m,e,n)=112992730284209629010217336632593897028023711212853788739137950706145189880318698604512926758021533447981943498594790549326550460216939216988828130624120379925895123186121819609415184887470233938291227816332249857236198616538782622327476603338806349004620909717360739157545735826670038169284252348037995399308

[+]x=pow(m+1,e,n)=112992730284209629010217336632593897028023711212853788739137950706145189880318698604512926758021552486915464025361447529153776277710423467951041523831865232164370127602772602643378592695459331174613894578701940837730590029577336924367384969935652616989527416027725713616493815764725131271563545176286794438175

[-]long_to_bytes(m).encode('hex')=
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">def</span> <span class="token function">short_pad_attack</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    PRxy<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token punctuation">,</span>y<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    PRx<span class="token punctuation">.</span><span class="token operator">&lt;</span>xn<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    PRZZ<span class="token punctuation">.</span><span class="token operator">&lt;</span>xz<span class="token punctuation">,</span>yz<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

    g1 <span class="token operator">=</span> x<span class="token operator">^</span>e <span class="token operator">-</span> c1
    g2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token operator">^</span>e <span class="token operator">-</span> c2

    q1 <span class="token operator">=</span> g1<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRZZ<span class="token punctuation">)</span>
    q2 <span class="token operator">=</span> g2<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRZZ<span class="token punctuation">)</span>

    h <span class="token operator">=</span> q2<span class="token punctuation">.</span>resultant<span class="token punctuation">(</span>q1<span class="token punctuation">)</span>
    h <span class="token operator">=</span> h<span class="token punctuation">.</span>univariate_polynomial<span class="token punctuation">(</span><span class="token punctuation">)</span>
    h <span class="token operator">=</span> h<span class="token punctuation">.</span>change_ring<span class="token punctuation">(</span>PRx<span class="token punctuation">)</span><span class="token punctuation">.</span>subs<span class="token punctuation">(</span>y<span class="token operator">=</span>xn<span class="token punctuation">)</span>
    h <span class="token operator">=</span> h<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>

    kbits <span class="token operator">=</span> n<span class="token punctuation">.</span>nbits<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>e<span class="token operator">*</span>e<span class="token punctuation">)</span>
    diff <span class="token operator">=</span> h<span class="token punctuation">.</span>small_roots<span class="token punctuation">(</span>X<span class="token operator">=</span><span class="token number">2</span><span class="token operator">^</span>kbits<span class="token punctuation">,</span> beta<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># find root &lt; 2^kbits with factor &gt;= n^0.5</span>

    <span class="token keyword">return</span> diff

<span class="token keyword">def</span> <span class="token function">related_message_attack</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> diff<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    PRx<span class="token punctuation">.</span><span class="token operator">&lt;</span>x<span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>Zmod<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    g1 <span class="token operator">=</span> x<span class="token operator">^</span>e <span class="token operator">-</span> c1
    g2 <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">+</span>diff<span class="token punctuation">)</span><span class="token operator">^</span>e <span class="token operator">-</span> c2

    <span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">while</span> g2<span class="token punctuation">:</span>
            g1<span class="token punctuation">,</span> g2 <span class="token operator">=</span> g2<span class="token punctuation">,</span> g1 <span class="token operator">%</span> g2
        <span class="token keyword">return</span> g1<span class="token punctuation">.</span>monic<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token operator">-</span>gcd<span class="token punctuation">(</span>g1<span class="token punctuation">,</span> g2<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">113604829563460357756722229849309932731534576966155520277171862442445354404910882358287832757024693652075211204635679309777620586814014894544893424988818766425089667672311645586528776360047956843961901352792631908859388801090108188344342619580661377758180391734771694803991493164412644148805229529911069578061</span>
    e <span class="token operator">=</span> <span class="token number">7</span>

    <span class="token comment"># nbits = n.nbits()</span>
    <span class="token comment"># kbits = nbits//(2*e*e)</span>
    <span class="token comment"># print ("upper %d bits (of %d bits) is same" % (nbits-kbits, nbits))</span>

    <span class="token comment"># ^^ = bit-wise XOR</span>
    <span class="token comment"># http://doc.sagemath.org/html/en/faq/faq-usage.html#how-do-i-use-the-bitwise-xor-operator-in-sage</span>
    <span class="token comment"># m1 = randrange(2^nbits)</span>
    <span class="token comment"># m2 = m1 ^^ randrange(2^kbits)</span>
    <span class="token comment"># c1 = pow(m1, e, n)</span>
    <span class="token comment"># c2 = pow(m2, e, n)</span>
    c1 <span class="token operator">=</span> <span class="token number">16404985139084147094704300764850430964980485772400565266054075398380588297033201409914512724255440373095027298869259036450071617770755361938461322132693877590521575670718076480353565935028734363256919872879837455527948173237810119579078252909879868459848240229599708133153841801633280283847680255816123323196</span>
    c2 <span class="token operator">=</span> <span class="token number">92463268823628386526871956385934776043432833035349654252757452728405540022093349560058649691620353528569690982904353035470935543182784600771655097406007508218346417446808306197613168219068573563402315939576563452451487014381380516422829248470476887447827532913133023890886210295009811931573875721299817276803</span>

    diff <span class="token operator">=</span> short_pad_attack<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"difference of two messages is %d"</span> <span class="token operator">%</span> diff<span class="token punctuation">)</span>

    <span class="token comment">#print (m1)</span>
    m1 <span class="token operator">=</span> related_message_attack<span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> diff<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>m1<span class="token punctuation">)</span>
    <span class="token comment">#print (m2)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>m1 <span class="token operator">+</span> diff<span class="token punctuation">)</span>
</pre><h3 class="mume-header" id="boneh-and-durfee-attack">Boneh and Durfee attack</h3>

<p><strong>例题 强网杯2019 Copperstudy 第6层</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>[+]Generating challenge 6

  [+]n=0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27L

[+]d=random.getrandbits(1024*0.270)

[+]e=invmod(d,phin)

[+]hex(e)=0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bbL

[+]m=random.getrandbits(512)

[+]c=pow(m,e,n)=0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866cL

[-]long_to_bytes(m).encode('hex')=
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!python3</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> time

<span class="token comment">############################################</span>
<span class="token comment"># Config</span>
<span class="token comment">##########################################</span>

<span class="token triple-quoted-string string">"""
Setting debug to true will display more informations
about the lattice, the bounds, the vectors...
"""</span>
debug <span class="token operator">=</span> <span class="token boolean">True</span>

<span class="token triple-quoted-string string">"""
Setting strict to true will stop the algorithm (and
return (-1, -1)) if we don't have a correct
upperbound on the determinant. Note that this
doesn't necesseraly mean that no solutions
will be found since the theoretical upperbound is
usualy far away from actual results. That is why
you should probably use `strict = False`
"""</span>
strict <span class="token operator">=</span> <span class="token boolean">False</span>

<span class="token triple-quoted-string string">"""
This is experimental, but has provided remarkable results
so far. It tries to reduce the lattice as much as it can
while keeping its efficiency. I see no reason not to use
this option, but if things don't work, you should try
disabling it
"""</span>
helpful_only <span class="token operator">=</span> <span class="token boolean">True</span>
dimension_min <span class="token operator">=</span> <span class="token number">7</span>  <span class="token comment"># stop removing if lattice reaches that dimension</span>

<span class="token comment">############################################</span>
<span class="token comment"># Functions</span>
<span class="token comment">##########################################</span>

<span class="token comment"># display stats on helpful vectors</span>
<span class="token keyword">def</span> <span class="token function">helpful_vectors</span><span class="token punctuation">(</span>BB<span class="token punctuation">,</span> modulus<span class="token punctuation">)</span><span class="token punctuation">:</span>
    nothelpful <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> modulus<span class="token punctuation">:</span>
            nothelpful <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">print</span> nothelpful<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">" vectors are not helpful"</span>

<span class="token comment"># display matrix picture with 0 and X</span>
<span class="token keyword">def</span> <span class="token function">matrix_overview</span><span class="token punctuation">(</span>BB<span class="token punctuation">,</span> bound<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'%02d '</span> <span class="token operator">%</span> ii<span class="token punctuation">)</span>
        <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token string">'0'</span> <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> jj<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">'X'</span>
            <span class="token keyword">if</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">:</span>
                a <span class="token operator">+=</span> <span class="token string">' '</span>
        <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> bound<span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token string">'~'</span>
        <span class="token keyword">print</span> a

<span class="token comment"># tries to remove unhelpful vectors</span>
<span class="token comment"># we start at current = n-1 (last vector)</span>
<span class="token keyword">def</span> <span class="token function">remove_unhelpful</span><span class="token punctuation">(</span>BB<span class="token punctuation">,</span> monomials<span class="token punctuation">,</span> bound<span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># end of our recursive function</span>
    <span class="token keyword">if</span> current <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">or</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> dimension_min<span class="token punctuation">:</span>
        <span class="token keyword">return</span> BB

    <span class="token comment"># we start by checking from the end</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># if it is unhelpful:</span>
        <span class="token keyword">if</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> bound<span class="token punctuation">:</span>
            affected_vectors <span class="token operator">=</span> <span class="token number">0</span>
            affected_vector_index <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token comment"># let's check if it affects other vectors</span>
            <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># if another vector is affected:</span>
                <span class="token comment"># we increase the count</span>
                <span class="token keyword">if</span> BB<span class="token punctuation">[</span>jj<span class="token punctuation">,</span> ii<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    affected_vectors <span class="token operator">+=</span> <span class="token number">1</span>
                    affected_vector_index <span class="token operator">=</span> jj

            <span class="token comment"># level:0</span>
            <span class="token comment"># if no other vectors end up affected</span>
            <span class="token comment"># we remove it</span>
            <span class="token keyword">if</span> affected_vectors <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span> <span class="token string">"* removing unhelpful vector"</span><span class="token punctuation">,</span> ii
                BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>delete_columns<span class="token punctuation">(</span><span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">)</span>
                BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>delete_rows<span class="token punctuation">(</span><span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">)</span>
                monomials<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>ii<span class="token punctuation">)</span>
                BB <span class="token operator">=</span> remove_unhelpful<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> monomials<span class="token punctuation">,</span> bound<span class="token punctuation">,</span> ii <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> BB

            <span class="token comment"># level:1</span>
            <span class="token comment"># if just one was affected we check</span>
            <span class="token comment"># if it is affecting someone else</span>
            <span class="token keyword">elif</span> affected_vectors <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                affected_deeper <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">for</span> kk <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>affected_vector_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># if it is affecting even one vector</span>
                    <span class="token comment"># we give up on this one</span>
                    <span class="token keyword">if</span> BB<span class="token punctuation">[</span>kk<span class="token punctuation">,</span> affected_vector_index<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        affected_deeper <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token comment"># remove both it if no other vector was affected and</span>
                <span class="token comment"># this helpful vector is not helpful enough</span>
                <span class="token comment"># compared to our unhelpful one</span>
                <span class="token keyword">if</span> affected_deeper <span class="token keyword">and</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>bound <span class="token operator">-</span> BB<span class="token punctuation">[</span>affected_vector_index<span class="token punctuation">,</span> affected_vector_index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>
                        bound <span class="token operator">-</span> BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> ii<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span> <span class="token string">"* removing unhelpful vectors"</span><span class="token punctuation">,</span> ii<span class="token punctuation">,</span> <span class="token string">"and"</span><span class="token punctuation">,</span> affected_vector_index
                    BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>delete_columns<span class="token punctuation">(</span><span class="token punctuation">[</span>affected_vector_index<span class="token punctuation">,</span> ii<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>delete_rows<span class="token punctuation">(</span><span class="token punctuation">[</span>affected_vector_index<span class="token punctuation">,</span> ii<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    monomials<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>affected_vector_index<span class="token punctuation">)</span>
                    monomials<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>ii<span class="token punctuation">)</span>
                    BB <span class="token operator">=</span> remove_unhelpful<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> monomials<span class="token punctuation">,</span> bound<span class="token punctuation">,</span> ii <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> BB
    <span class="token comment"># nothing happened</span>
    <span class="token keyword">return</span> BB

<span class="token triple-quoted-string string">"""
Returns:
* 0,0   if it fails
* -1,-1 if `strict=true`, and determinant doesn't bound
* x0,y0 the solutions of `pol`
"""</span>

<span class="token keyword">def</span> <span class="token function">boneh_durfee</span><span class="token punctuation">(</span>pol<span class="token punctuation">,</span> modulus<span class="token punctuation">,</span> mm<span class="token punctuation">,</span> tt<span class="token punctuation">,</span> XX<span class="token punctuation">,</span> YY<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Boneh and Durfee revisited by Herrmann and May

    finds a solution if:
    * d &lt; N^delta
    * |x| &lt; e^delta
    * |y| &lt; e^0.5
    whenever delta &lt; 1 - sqrt(2)/2 ~ 0.292
    """</span>

    <span class="token comment"># substitution (Herrman and May)</span>
    PR<span class="token punctuation">.</span> <span class="token operator">&lt;</span> u<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
    Q <span class="token operator">=</span> PR<span class="token punctuation">.</span>quotient<span class="token punctuation">(</span>x <span class="token operator">*</span> y <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> u<span class="token punctuation">)</span>  <span class="token comment"># u = xy + 1</span>
    polZ <span class="token operator">=</span> Q<span class="token punctuation">(</span>pol<span class="token punctuation">)</span><span class="token punctuation">.</span>lift<span class="token punctuation">(</span><span class="token punctuation">)</span>

    UU <span class="token operator">=</span> XX <span class="token operator">*</span> YY <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token comment"># x-shifts</span>
    gg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> kk <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>mm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>mm <span class="token operator">-</span> kk <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            xshift <span class="token operator">=</span> x <span class="token operator">^</span> ii <span class="token operator">*</span> modulus <span class="token operator">^</span> <span class="token punctuation">(</span>mm <span class="token operator">-</span> kk<span class="token punctuation">)</span> <span class="token operator">*</span> polZ<span class="token punctuation">(</span>u<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">^</span> kk
            gg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>xshift<span class="token punctuation">)</span>
    gg<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># x-shifts list of monomials</span>
    monomials <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> polynomial <span class="token keyword">in</span> gg<span class="token punctuation">:</span>
        <span class="token keyword">for</span> monomial <span class="token keyword">in</span> polynomial<span class="token punctuation">.</span>monomials<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> monomial <span class="token keyword">not</span> <span class="token keyword">in</span> monomials<span class="token punctuation">:</span>
                monomials<span class="token punctuation">.</span>append<span class="token punctuation">(</span>monomial<span class="token punctuation">)</span>
    monomials<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># y-shifts (selected by Herrman and May)</span>
    <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> tt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> kk <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>floor<span class="token punctuation">(</span>mm <span class="token operator">/</span> tt<span class="token punctuation">)</span> <span class="token operator">*</span> jj<span class="token punctuation">,</span> mm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            yshift <span class="token operator">=</span> y <span class="token operator">^</span> jj <span class="token operator">*</span> polZ<span class="token punctuation">(</span>u<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">^</span> kk <span class="token operator">*</span> modulus <span class="token operator">^</span> <span class="token punctuation">(</span>mm <span class="token operator">-</span> kk<span class="token punctuation">)</span>
            yshift <span class="token operator">=</span> Q<span class="token punctuation">(</span>yshift<span class="token punctuation">)</span><span class="token punctuation">.</span>lift<span class="token punctuation">(</span><span class="token punctuation">)</span>
            gg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>yshift<span class="token punctuation">)</span>  <span class="token comment"># substitution</span>

    <span class="token comment"># y-shifts list of monomials</span>
    <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> tt <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> kk <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>floor<span class="token punctuation">(</span>mm <span class="token operator">/</span> tt<span class="token punctuation">)</span> <span class="token operator">*</span> jj<span class="token punctuation">,</span> mm <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            monomials<span class="token punctuation">.</span>append<span class="token punctuation">(</span>u <span class="token operator">^</span> kk <span class="token operator">*</span> y <span class="token operator">^</span> jj<span class="token punctuation">)</span>

    <span class="token comment"># construct lattice B</span>
    nn <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>monomials<span class="token punctuation">)</span>
    BB <span class="token operator">=</span> Matrix<span class="token punctuation">(</span>ZZ<span class="token punctuation">,</span> nn<span class="token punctuation">)</span>
    <span class="token keyword">for</span> ii <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> gg<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> ii <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span> <span class="token keyword">in</span> gg<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">.</span>monomials<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                BB<span class="token punctuation">[</span>ii<span class="token punctuation">,</span> jj<span class="token punctuation">]</span> <span class="token operator">=</span> gg<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token punctuation">.</span>monomial_coefficient<span class="token punctuation">(</span>monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">(</span>UU<span class="token punctuation">,</span> XX<span class="token punctuation">,</span> YY<span class="token punctuation">)</span>

    <span class="token comment"># Prototype to reduce the lattice</span>
    <span class="token keyword">if</span> helpful_only<span class="token punctuation">:</span>
        <span class="token comment"># automatically remove</span>
        BB <span class="token operator">=</span> remove_unhelpful<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> monomials<span class="token punctuation">,</span> modulus <span class="token operator">^</span> mm<span class="token punctuation">,</span> nn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># reset dimension</span>
        nn <span class="token operator">=</span> BB<span class="token punctuation">.</span>dimensions<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> nn <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">"failure"</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>

    <span class="token comment"># check if vectors are helpful</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        helpful_vectors<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> modulus <span class="token operator">^</span> mm<span class="token punctuation">)</span>

    <span class="token comment"># check if determinant is correctly bounded</span>
    det <span class="token operator">=</span> BB<span class="token punctuation">.</span>det<span class="token punctuation">(</span><span class="token punctuation">)</span>
    bound <span class="token operator">=</span> modulus <span class="token operator">^</span> <span class="token punctuation">(</span>mm <span class="token operator">*</span> nn<span class="token punctuation">)</span>
    <span class="token keyword">if</span> det <span class="token operator">&gt;=</span> bound<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"We do not have det &lt; bound. Solutions might not be found."</span>
        <span class="token keyword">print</span> <span class="token string">"Try with highers m and t."</span>
        <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
            diff <span class="token operator">=</span> <span class="token punctuation">(</span>log<span class="token punctuation">(</span>det<span class="token punctuation">)</span> <span class="token operator">-</span> log<span class="token punctuation">(</span>bound<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">"size det(L) - size e^(m*n) = "</span><span class="token punctuation">,</span> floor<span class="token punctuation">(</span>diff<span class="token punctuation">)</span>
        <span class="token keyword">if</span> strict<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"det(L) &lt; e^(m*n) (good! If a solution exists &lt; N^delta, it will be found)"</span>

    <span class="token comment"># display the lattice basis</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        matrix_overview<span class="token punctuation">(</span>BB<span class="token punctuation">,</span> modulus <span class="token operator">^</span> mm<span class="token punctuation">)</span>

    <span class="token comment"># LLL</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"optimizing basis of the lattice via LLL, this can take a long time"</span>

    BB <span class="token operator">=</span> BB<span class="token punctuation">.</span>LLL<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"LLL is done!"</span>

    <span class="token comment"># transform vector i &amp; j -&gt; polynomials 1 &amp; 2</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"looking for independent vectors in the lattice"</span>
    found_polynomials <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">for</span> pol1_idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nn <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> pol2_idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pol1_idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># for i and j, create the two polynomials</span>
            PR<span class="token punctuation">.</span> <span class="token operator">&lt;</span> w<span class="token punctuation">,</span> z <span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
            pol1 <span class="token operator">=</span> pol2 <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> jj <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nn<span class="token punctuation">)</span><span class="token punctuation">:</span>
                pol1 <span class="token operator">+=</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">(</span>w <span class="token operator">*</span> z <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">*</span> BB<span class="token punctuation">[</span>pol1_idx<span class="token punctuation">,</span> jj<span class="token punctuation">]</span> <span class="token operator">/</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">(</span>UU<span class="token punctuation">,</span> XX<span class="token punctuation">,</span> YY<span class="token punctuation">)</span>
                pol2 <span class="token operator">+=</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">(</span>w <span class="token operator">*</span> z <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> w<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">*</span> BB<span class="token punctuation">[</span>pol2_idx<span class="token punctuation">,</span> jj<span class="token punctuation">]</span> <span class="token operator">/</span> monomials<span class="token punctuation">[</span>jj<span class="token punctuation">]</span><span class="token punctuation">(</span>UU<span class="token punctuation">,</span> XX<span class="token punctuation">,</span> YY<span class="token punctuation">)</span>

            <span class="token comment"># resultant</span>
            PR<span class="token punctuation">.</span> <span class="token operator">&lt;</span> q <span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
            rr <span class="token operator">=</span> pol1<span class="token punctuation">.</span>resultant<span class="token punctuation">(</span>pol2<span class="token punctuation">)</span>

            <span class="token comment"># are these good polynomials?</span>
            <span class="token keyword">if</span> rr<span class="token punctuation">.</span>is_zero<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> rr<span class="token punctuation">.</span>monomials<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span> <span class="token string">"found them, using vectors"</span><span class="token punctuation">,</span> pol1_idx<span class="token punctuation">,</span> <span class="token string">"and"</span><span class="token punctuation">,</span> pol2_idx
                found_polynomials <span class="token operator">=</span> <span class="token boolean">True</span>
                <span class="token keyword">break</span>
        <span class="token keyword">if</span> found_polynomials<span class="token punctuation">:</span>
            <span class="token keyword">break</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> found_polynomials<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"no independant vectors could be found. This should very rarely happen..."</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>

    rr <span class="token operator">=</span> rr<span class="token punctuation">(</span>q<span class="token punctuation">,</span> q<span class="token punctuation">)</span>

    <span class="token comment"># solutions</span>
    soly <span class="token operator">=</span> rr<span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>soly<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Your prediction (delta) is too small"</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>

    soly <span class="token operator">=</span> soly<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    ss <span class="token operator">=</span> pol1<span class="token punctuation">(</span>q<span class="token punctuation">,</span> soly<span class="token punctuation">)</span>
    solx <span class="token operator">=</span> ss<span class="token punctuation">.</span>roots<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment">#</span>
    <span class="token keyword">return</span> solx<span class="token punctuation">,</span> soly


<span class="token keyword">def</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">############################################</span>
    <span class="token comment"># How To Use This Script</span>
    <span class="token comment">##########################################</span>

    <span class="token comment">#</span>
    <span class="token comment"># The problem to solve (edit the following values)</span>
    <span class="token comment">#</span>

    <span class="token comment"># the modulus</span>
    N <span class="token operator">=</span> 0xbadd260d14ea665b62e7d2e634f20a6382ac369cd44017305b69cf3a2694667ee651acded7085e0757d169b090f29f3f86fec255746674ffa8a6a3e1c9e1861003eb39f82cf74d84cc18e345f60865f998b33fc182a1a4ffa71f5ae48a1b5cb4c5f154b0997dc9b001e441815ce59c6c825f064fdca678858758dc2cebbc4d27L
    <span class="token comment"># the public exponent</span>
    e <span class="token operator">=</span> 0x11722b54dd6f3ad9ce81da6f6ecb0acaf2cbc3885841d08b32abc0672d1a7293f9856db8f9407dc05f6f373a2d9246752a7cc7b1b6923f1827adfaeefc811e6e5989cce9f00897cfc1fc57987cce4862b5343bc8e91ddf2bd9e23aea9316a69f28f407cfe324d546a7dde13eb0bd052f694aefe8ec0f5298800277dbab4a33bbL
    <span class="token comment"># the cipher</span>
    c <span class="token operator">=</span> 0xe3505f41ec936cf6bd8ae344bfec85746dc7d87a5943b3a7136482dd7b980f68f52c887585d1c7ca099310c4da2f70d4d5345d3641428797030177da6cc0d41e7b28d0abce694157c611697df8d0add3d900c00f778ac3428f341f47ecc4d868c6c5de0724b0c3403296d84f26736aa66f7905d498fa1862ca59e97f8f866cL
    <span class="token comment"># N = 12238605063252292170613110607692779326628090745751955692266649177882959231822580682548279800443278979485092243645806337103841086023159482786712759291169541633901936290854044069486201989034158882661270017305064348254800318759062921744741432214818915527537124001063995865927527037625277330117588414586505635959411443039463168463608235165929831344586283875119363703480280602514451713723663297066810128769907278246434745483846869482536367912810637275405943566734099622063142293421936734750356828712268385319217225803602442033960930413469179550331907541244416573641309943913383658451409219852933526106735587605884499707827</span>
    <span class="token comment"># e = 11850552481503020257392808424743510851763548184936536180317707155841959788151862976445957810691568475609821000653594584717037528429828330763571556164988619635320288125983463358648887090031957900011546300841211712664477474767941406651977784177969001025954167441377912326806132232375497798238928464025466905201977180541053129691501120197010080001677260814313906843670652972019631997467352264392296894192998971542816081534808106792758008676039929763345402657578681818891775091140555977382868531202964486261123748663752490909455324860302967636149379567988941803701512680099398021640317868259975961261408500449965277690517</span>
    <span class="token comment"># c = 9472193174575536616954091686751964873836697237500198884451530469300324470671555310791335185133679697207007374620225900775502162690848135615431624557389304657410880981454777737587420426091879654002644281066474715074536611611252677882396384453641127487515845176069574754606670518031472235144795376526854484442135299818868525539923568705203042265537204111153151119105287648912908771710419648445826883069030285651763726003413418764301988228077415599665616637501056116290476861280240577145515875430665394216054222788697052979429015400411487342877096677666406389711074591330476335174211990429870900468249946600544116793793</span>

    <span class="token comment"># the hypothesis on the private exponent (the theoretical maximum is 0.292)</span>
    delta <span class="token operator">=</span> <span class="token number">.18</span>  <span class="token comment"># this means that d &lt; N^delta</span>

    <span class="token comment">#</span>
    <span class="token comment"># Lattice (tweak those values)</span>
    <span class="token comment">#</span>

    <span class="token comment"># you should tweak this (after a first run), (e.g. increment it until a solution is found)</span>
    m <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># size of the lattice (bigger the better/slower)</span>

    <span class="token comment"># you need to be a lattice master to tweak these</span>
    t <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> delta<span class="token punctuation">)</span> <span class="token operator">*</span> m<span class="token punctuation">)</span>  <span class="token comment"># optimization from Herrmann and May</span>
    X <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> floor<span class="token punctuation">(</span>N <span class="token operator">^</span> delta<span class="token punctuation">)</span>  <span class="token comment"># this _might_ be too much</span>
    Y <span class="token operator">=</span> floor<span class="token punctuation">(</span>N <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># correct if p, q are ~ same size</span>

    <span class="token comment">#</span>
    <span class="token comment"># Don't touch anything below</span>
    <span class="token comment">#</span>

    <span class="token comment"># Problem put in equation</span>
    P<span class="token punctuation">.</span> <span class="token operator">&lt;</span> x<span class="token punctuation">,</span> y <span class="token operator">&gt;</span> <span class="token operator">=</span> PolynomialRing<span class="token punctuation">(</span>ZZ<span class="token punctuation">)</span>
    A <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>N <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
    pol <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> x <span class="token operator">*</span> <span class="token punctuation">(</span>A <span class="token operator">+</span> y<span class="token punctuation">)</span>

    <span class="token comment">#</span>
    <span class="token comment"># Find the solutions!</span>
    <span class="token comment">#</span>

    <span class="token comment"># Checking bounds</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"=== checking values ==="</span>
        <span class="token keyword">print</span> <span class="token string">"* delta:"</span><span class="token punctuation">,</span> delta
        <span class="token keyword">print</span> <span class="token string">"* delta &lt; 0.292"</span><span class="token punctuation">,</span> delta <span class="token operator">&lt;</span> <span class="token number">0.292</span>
        <span class="token keyword">print</span> <span class="token string">"* size of e:"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>log<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">/</span> log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">"* size of N:"</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>log<span class="token punctuation">(</span>N<span class="token punctuation">)</span> <span class="token operator">/</span> log<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">"* m:"</span><span class="token punctuation">,</span> m<span class="token punctuation">,</span> <span class="token string">", t:"</span><span class="token punctuation">,</span> t

    <span class="token comment"># boneh_durfee</span>
    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"=== running algorithm ==="</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    solx<span class="token punctuation">,</span> soly <span class="token operator">=</span> boneh_durfee<span class="token punctuation">(</span>pol<span class="token punctuation">,</span> e<span class="token punctuation">,</span> m<span class="token punctuation">,</span> t<span class="token punctuation">,</span> X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>

    <span class="token comment"># found a solution?</span>
    <span class="token keyword">if</span> solx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"=== solution found ==="</span>
        <span class="token keyword">if</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">"x:"</span><span class="token punctuation">,</span> solx
            <span class="token keyword">print</span> <span class="token string">"y:"</span><span class="token punctuation">,</span> soly

        d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pol<span class="token punctuation">(</span>solx<span class="token punctuation">,</span> soly<span class="token punctuation">)</span> <span class="token operator">/</span> e<span class="token punctuation">)</span>
        m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'[-]d is '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'[-]m is: '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'[-]hex(m) is: '</span> <span class="token operator">+</span> <span class="token string">'{:x}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'[-]str(m) is: '</span> <span class="token operator">+</span> <span class="token string">'{:x}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"[!]no solution was found!"</span>
        <span class="token keyword">print</span> <span class="token string">'[!]All Done!'</span>

    <span class="token keyword">if</span> debug<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[!]Timer: %s s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start_time<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'[!]All Done!'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    example<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p><strong>例题 2020西湖论剑-RSA-BrokenSystems</strong></p>
<p>给了两个文件，message 和 public.key，还有一个脚本如下：</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_OAEP
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
<span class="token keyword">import</span> os
rsa <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
public_key <span class="token operator">=</span> rsa<span class="token punctuation">.</span>publickey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"public.key"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>public_key<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

rsakey<span class="token operator">=</span>RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"public.key"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rsa <span class="token operator">=</span> PKCS1_OAEP<span class="token punctuation">.</span>new<span class="token punctuation">(</span>rsakey<span class="token punctuation">)</span>
msg<span class="token operator">=</span>rsa<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token string">"wb"</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>这里边的 e 特别大, 用 RsaCtfTool 的 boneh_durfee 爆破出了结果</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>./RsaCtfTool.py --publickey ./2020ctf-BrokenSystems/public.key --private
</code></pre><p>获得 Private Key 后，我们将该密钥保存为 pri.key，使用 openssl 解出结果，需要注意的是解密时要指定填充模式为 PKCS1_OAEP</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>cd 2020ctf-BrokenSystems &amp;&amp; openssl rsautl -decrypt -oaep -in message -inkey pri.key
</code></pre><hr>
<h2 class="mume-header" id="%E5%85%B1%E6%A8%A1%E6%94%BB%E5%87%BBbase64%E9%9A%90%E5%86%99">共模攻击+base64隐写</h2>

<p><strong>例题 RSA &amp; what</strong></p>
<p>HUB1</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>785095419718268286866508214304816985447077293766819398728046411166917810820484759314291028976498223661229395009474063173705162627037610993539617751905443039278227583504604808251931083818909467613277587874545761074364427549966555519371913859875313577282243053150056274667798049694695703660313532933165449312949725581708965417273055582216295994587600975970124811496270080896977076946000102701030260990598181466447208054713391526313700681341093922240317428173599031624125155188216489476825606191521182034969120343287691181300399683515414809262700457525876691808180257730351707673660380698973884642306898810000633684878715402823143549139850732982897459698089649561190746850698130299458080255582312696873149210028240898137822888492559957665067936573356367589784593119016624072433872744537432005911668494455733330689385141214653091888017782049043434862620306783436169856564175929871100669913438980899219579329897753233450934770193915434791427728636586218049874617231705308003720066269312729135764175698611068808404054125581540114956463603240222497919384691718744014002554201602395969312999994159599536026359879060218056496345745457493919771337601177449899066579857630036350871090452649830775029695488575574985078428560054253180863725364147
1697

412629526163150748619328091306742267675740578011800062477174189782151273970783531227579758540364970485350157944321579108232221072397135934034064481497887079641131808838242743811511451355024436983050572020925065644355566434625618133203024215941534926113892937988520918939061441606915556516246057349589921494351383160036280826024605351878408056180907759973804117263002554923041750587548819746346813966673034182913325507826219961923932100526305289894965216608254252188398580139545189681875824089456195044984585824938384521905334289906422454152976834867304693292466676355760173232407753256256317546190171995276258924613533179898467683358934751999655196790168438343198229183747091108262988777659858609744709324571850262293294975336628234767258858873839342596887193772615000676401522431518310648303975593582965021189182246986957349253156736526071639973844039068996404290548474640668851856078201093335425412842295604919065487301340901573809617549185106072798799159726375235125260509158832996701927878713084753334549129580912412168594170659605421750204835970231909591063407612779337478065175988365401590396247576709343727196106058477166945670117868989025903023998142850338956985816131805349549059377047477131270847579095628384569645636821650
494644347943710545224678831941589086572700792465459558770782213550069709458568349686998660541810166872034041584767487150140111151788221460027897193248273461607411027815984883969396220626358625041781558277804930212654296704055890683796941327712758797770820006623289146990000114915293539639766846910274034245607746230740851938158390562286057002223177609606376329007676845450142537930798148258428701466415483232670659815791064681384406494388237742330786225557303988025468036820082959712050733095860546860468575857084616069132051094882919253745234762029759124776348047587755897123575123506976140900565238840752841856713613368250071926171873213897914794115466890719123299469964019450899291410760762179836946570945555295288184698184555018368687708432612286248476073758067175481771199066581572870175460016017100414479346437034291784837132240891321931601494414908927713208448927221095745802380014441841139882391378410438764884597938773868771896252329517440068673532468372840830510218585255432000690265226016573313570977945083879214961394087065558376158826938257664840570952233832852869328785568175434516247720356520242602299510374317488182738732700078879665745909603766482100138001417023680647717824323143388857817595766172152883484274718248
152942283599728307168144137370127212672611894072038732126041098102628831053000986759260271210671922070555948023688596575415822984026159010574404359474670428678518262175033880513984372909748992727828381694416776740981021730545374002974037896534944567124543272737618380646771071804878796585983783360553761828325817820260204820004421979881871027255562690952334900616675606524933557440263648233514757200263521499508373975003431306847453046714027687108396945719803444444954079308404947126216395526551292104722047878178373207886033071857277857997932255251315982837892164421298202073945919187779856785892717251746704537315003771369737854896595170485152591013676942418134278534037654467840633528916812275267230155352077736583130992587670941654695382287023971261529987384520843829695778029311786431227409189019205818351911572757145556993606643464336196802350204616056286497246016800105003143046120608673496196758720552776772796609670537056331996894322779267635281472481559819839042424017171718303214059720568484939239370144038161541354254182769979771948759413102933987773401644506930205164891773826513161783736386604783484446345744957119469799231796368324927570694496679453313927562345656690240414624431304646248599226046524702364131095964335
79717988936247951265489157583697956031893477858854186991051529161879478488281744062318600470906120960002282886511477294555606503083169449335174864424180701080203993329996226566203834693869525797695969610065991941396723959032680019082506816443041598300477625793433080664346470586416385854692124426348587211026568667694805849554780794033764714016521711467557284846737236374990121316809833819996821592832639024026411520407330206281265390130763948165694574512140518775603040182029818771866749548761938870605590174330887949847420877829240131490902432602005681085180807294176837646062568094875766945890382971790015490163385088144673549085079635083262975154206269679142412897438231719704933258660779310737302680265445437771977749959110744959368586293082016067927548564967400845992380076107522755566531760628823374519718763740378295585535591752887339222947397184116326706799921515431185636740825707782742373783475781052674257292910213843986132987466810027275052416774693363446184518901899202502828670309452622347532932678874990809930682575738653876289384151496807194146308614368821006660626870989784697045160231069428458961107751207771093777394616856305293335603892178327520756554333365975114235981173451368131680404850832773147333013716920
123111353650401158556639983459870663057297871992927053886971224773529636525110628183715748795987525113177540092814119928708272290370336537110381023134637759740716140969662183269370676630325583385284994943164692397459103195434968057377474610500216801375394703781249039351368816958227409657934091741509357152328382960684515093945552479461382281913961956745154260686029997827565075768703774895750561575155143606297116391666385705899138085693913246313778033627210312268959737394553510894720099165193981333775907531107232556909478156441457899797515694348816961762796703443502856101079430585547997496001098926600499728389113862894833789669213630332988693669889340482430613291490613803204484751470676686041002772556117213612152322606737150858116122936539131795111263513114569794532805886643087299918196635113037777138666914296986040549274559835214505300618256105508764026461518876579387159881983544667258537064954616097750399839661065797883103731694314852301848272092388637114950059216922969842082648527035538090054093890365647676119748995243416337805666557501345234056968476142608491830438065401219751688687373709390057521910942736632126729711606256158399963682990881473178216060827021373776598901281958527655543318413664277921492723185984
36869806815936046911848195817405817350259890871483063184373728397968909458432625046025376290214729914038387534731762237978339011724858818860181178811639468996206294711495853807311240013786226884265118119546377272154555615363105236192878292703331473547623021744317034819416624562896226194523639793573028006666236271812390759036235867495803255905843636447252225413871038762657801345647584493917576263471587347202664391908570140389126903204602391093990827188675090199750617303773574821926387194478875191828814971296674530519321530805302667925998711835019806761133078403281404889374663875077339168901297819436499920958268483684335998301056068380228873524800383911402490807139268964095165069610454677558808756444381542173782815227920906224931028457073652453777424387873533280455944646592996920617956675786286711447540353883400282402551158169958389450168079568459656526911857835375748015814860506707921852997096156275804955989964215077733621769938075413007804223217091604613132253046399456747595300404564172224333936405545921819654435437072133387523533568472443532200069133022979195685683508297337961701169394794966256415112246587706103819620428258245999539040721929317130088874161577093962579487428358736401687123174207198251449851429295
</code></pre><p>HUB2</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>785095419718268286866508214304816985447077293766819398728046411166917810820484759314291028976498223661229395009474063173705162627037610993539617751905443039278227583504604808251931083818909467613277587874545761074364427549966555519371913859875313577282243053150056274667798049694695703660313532933165449312949725581708965417273055582216295994587600975970124811496270080896977076946000102701030260990598181466447208054713391526313700681341093922240317428173599031624125155188216489476825606191521182034969120343287691181300399683515414809262700457525876691808180257730351707673660380698973884642306898810000633684878715402823143549139850732982897459698089649561190746850698130299458080255582312696873149210028240898137822888492559957665067936573356367589784593119016624072433872744537432005911668494455733330689385141214653091888017782049043434862620306783436169856564175929871100669913438980899219579329897753233450934770193915434791427728636586218049874617231705308003720066269312729135764175698611068808404054125581540114956463603240222497919384691718744014002554201602395969312999994159599536026359879060218056496345745457493919771337601177449899066579857630036350871090452649830775029695488575574985078428560054253180863725364147
599

592169079372093727306100216011395857825646323934289480976073629037543922902098120901138454462177159996376654176248238979132528728327590301098966139983157980612320563496546128644967731000716697705104079039156276714872147463350811303393260622707024952543509891692246246277965823414460326811240048060543656588688604452353899779068825120910282167004715339763187734797180326976132213325054697165320479166356562518029805927741656605174809726397565772271562066078076105491745903986597877400370206718954975288721072048333678609055008135809089304229015364348490924974097403734627265297637171818849461766523691595241613878709865506436588268999163342945070495338153600520537498539457396582804692959296612715752573140296135784933206146091436617979599749774330699946637591406356289409716084034451049094715202196203486088368791744107629271647320273259836915312794297246589501008666299165717722507702866033454215783240025504356157664454861755286285777763585177751796252655008206383024707883077513745863312079349790275094080707502392866946325796914450602264462588722052297430827681750827349094323968337670311272933785838850649376115667223821665435911506351891489985627506615492005617098615432522564204152887767244129985681083657783356557756654335186
373940646416832740878733255707567753033716583448402000789202767511920210382830343955553654111486728333980557319799362514960627879016797491389812007768832730979916230647641872759001906846747977631675704310179448857128160385701185892914523053669366534408863734305635222625590986006420486092550427301086984563126480814987024980594613542978310129247678826691418335300577577527951623696426435497835228167084738007750914270251001921329521479047662848650808989996085600197309361410863238526802127877523767262921515150984998560136647154865791163316503073285223966216441025637452229043510097323724381056976302288136843260163922706692913035222445496716008888946581535004546355744211680390731257309941902587303353139951102244865270295414474488798335404630458489706639805186573874814586736746232358849677477533671968344154242963289415569487579895910660999043578737461300406937828924818002658292769882181668784501439254131996848948120781562158861495883827848139425862249576454689133681009549361314460818658995959098228995702202268649635363105549975932395335076521137604288520082040121286614922986554652700056148966514178935952363036963217619879899671383604638416567950421350546204434902113156720006282720889591288850271076074941927715678306057176
527630926460622936571385649841758214453416849039412401087443444317101857090904711485538107058823056085840539073345920792871368232355475394571098380596835468509997340505604333730547799560998822989747473780307779717715522787724471724766494090783971030594671013168209717686720448579582618378459567979027822271918653169622428153856198907810040224340270362413432495029672123261375400927159831537760709974778708160583252613784358234858583174544777979242887938827573604837766801998381379999076416444683891078093889686055482709838668356120916040352123019019255084513769603803814947774554028717814638951416291274696771515474086351482107953150253616922787262398450376249126999644026382478413080973933173079111305142716133389111399235545279259017424722601848670061556859163943895466553927946412523750166582734005733378328468250568944945912238495877929717101722314678120172228493787964904072583905721074766711732215815561012960394537195757832959268603775112932862105945720853959285187521763557915356428113876893276879775603217718981852114599706699524551973934242045743122744146361596971245034059345915315495232135483464496114770357536576200511490922413208178149869347802988786513451486411409887164516065062084917556120712465074206435831498113605
8786437178698940322877889807009957616777351844979869726962356553244050911283984280960665761649310895230455072977431415102053987735969326553978994853162483051544656873294555116009995592043183070208706258164840540599577072097104139505857517663273929851202628854185356185647194933800084230503413037858893307713037149307477830536758283681093517617820169181420796105338681582230788318108428132051793761014952837330456262272828627355701464740578197966332613127307037255647286823496355917642353327912440019621838870388091824748629637425759125214639885130163183752378908729773517053259212525494555880921052679512582051516604297098204363525081039382358483926727008679327719083138865969291911863630382097160230960738043575559330264018212774424527719153248563876760067931499029384228993253862501939337758514377472011933279273181144830381169849387893799390755052093069179605579485710343655570028592595882436632426527654452895431758715126580164902410286422637215098476316042367916779431052267545769495994723721129943616294879642305545894912914632980455031755879087401575310699765408473606166727137934224515998416625122213056208800095077933103150699272650116151674702438463062734472714004926103668378506804002740045547964716693536349447660850580
205314962204511500352858372254132533167549960825498949618514841570703199264867431580754674275990554478140637041427842111391746883257447120035947621456863890934062044010795443059281736346976175772415034838334682726635263432655537852942177334888025283748611576171534251461847349566505628290587224150869640386437623371249743165260396675220683302142805646368906930575140628610003919131999295855501215111393294818218799982703289304596989070475000081175510085432290264502023736899104746316830742226946395027029820825791831870857382647221322734605026210073093918331247494307555600335550942340526536281372036612138713881098866303169425501998978400008829873080965592009371176208668290074288903681417933657472279670688597862835627506340169978450918788539270346340385928840299573889292189531738082166408734046381423516467694328971385421907314814283489322619386570046183556572383980777277173349209330683424343658179781015072259378576130442222984963071166207642585589822061597282467850868050737957726423713761694231879497037175627546427449730638216214828463003483408928375620315193290871300316930139260521382533279767663839278693750409419493280753368451508802658272220767624766390639285308433607255253282702383762149755935518922075584637512494819
271453634732502613378948161256470991260052778799128789839624515809143527363206813219580098196957510291648493698144497567392065251244844074992734669490296293997386198359280316655904691639367482203210051809125904410431506925238374843856343243276508280641059690938930957474434518308646618959004216831130099873532714372402117796666560677624822509159287675432413016478948594640872091688482149004426363946048517480052906306290126242866034249478040406351940088231081456109195799442996799641647167552689564613346415247906852055588498305665928450828756152103096629274760601528737639415361467941349982213641454967962723875032638267311935042334584913897338553953961877439389588793074211502597238465542889335363559052368180212013206172712561221352833891640659020253527584706465205486408990762759230842192028381048563437724528409174790022752557512795782713125166158329880702730769957185428522011430144840232256419113631679343171680631630775266488738173707357123139368825087043785842169049943237537188129367275730984789479909103397937113837824575137021012333461552176687570010445744268373840742899299977372834041925102853718964831225250407279578465008537542659673685686242773379131904890865110699190451534445434533919127658976874721029586168106207
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> bytes_to_long<span class="token punctuation">,</span> getPrime
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> powmod

p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span>
N <span class="token operator">=</span> p<span class="token operator">*</span>q
Phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_enc_key</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span>Phi<span class="token punctuation">)</span><span class="token punctuation">:</span>
    e <span class="token operator">=</span> getPrime<span class="token punctuation">(</span>N<span class="token punctuation">)</span>
    <span class="token keyword">if</span> Phi <span class="token operator">%</span> e <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> get_enc_key<span class="token punctuation">(</span>N<span class="token punctuation">,</span> Phi<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> e
e1 <span class="token operator">=</span> get_enc_key<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Phi<span class="token punctuation">)</span>
e2 <span class="token operator">=</span> get_enc_key<span class="token punctuation">(</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Phi<span class="token punctuation">)</span>

fr <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r"./base64"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span>  <span class="token comment">#flag 被 base64</span>
f1 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r"./HUB1"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
f2 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">r"./HUB2"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
base64 <span class="token operator">=</span> fr<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"%d\n%d\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>N<span class="token punctuation">,</span> e1<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># HUB1 和 HUB2 文件中的是模 N 和私钥 e</span>
f2<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"%d\n%d\n"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>N<span class="token punctuation">,</span> e2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># HUB1 和 HUB2 文件中的是模 N 和私钥 e</span>
<span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token comment"># 共模攻击</span>
    pt <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>base64<span class="token punctuation">)</span>
    ct1 <span class="token operator">=</span> powmod<span class="token punctuation">(</span>pt<span class="token punctuation">,</span> e1<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
    ct2 <span class="token operator">=</span> powmod<span class="token punctuation">(</span>pt<span class="token punctuation">,</span> e2<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
    f1<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n%d"</span> <span class="token operator">%</span> ct1<span class="token punctuation">)</span>
    f2<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n%d"</span> <span class="token operator">%</span> ct2<span class="token punctuation">)</span>
    base64 <span class="token operator">=</span> fr<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
fr<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
f1<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
f2<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> binascii

N <span class="token operator">=</span><span class="token number">785095419718268286866508214304816985447077293766819398728046411166917810820484759314291028976498223661229395009474063173705162627037610993539617751905443039278227583504604808251931083818909467613277587874545761074364427549966555519371913859875313577282243053150056274667798049694695703660313532933165449312949725581708965417273055582216295994587600975970124811496270080896977076946000102701030260990598181466447208054713391526313700681341093922240317428173599031624125155188216489476825606191521182034969120343287691181300399683515414809262700457525876691808180257730351707673660380698973884642306898810000633684878715402823143549139850732982897459698089649561190746850698130299458080255582312696873149210028240898137822888492559957665067936573356367589784593119016624072433872744537432005911668494455733330689385141214653091888017782049043434862620306783436169856564175929871100669913438980899219579329897753233450934770193915434791427728636586218049874617231705308003720066269312729135764175698611068808404054125581540114956463603240222497919384691718744014002554201602395969312999994159599536026359879060218056496345745457493919771337601177449899066579857630036350871090452649830775029695488575574985078428560054253180863725364147</span>
e2 <span class="token operator">=</span> <span class="token number">599</span>
c21<span class="token operator">=</span><span class="token number">592169079372093727306100216011395857825646323934289480976073629037543922902098120901138454462177159996376654176248238979132528728327590301098966139983157980612320563496546128644967731000716697705104079039156276714872147463350811303393260622707024952543509891692246246277965823414460326811240048060543656588688604452353899779068825120910282167004715339763187734797180326976132213325054697165320479166356562518029805927741656605174809726397565772271562066078076105491745903986597877400370206718954975288721072048333678609055008135809089304229015364348490924974097403734627265297637171818849461766523691595241613878709865506436588268999163342945070495338153600520537498539457396582804692959296612715752573140296135784933206146091436617979599749774330699946637591406356289409716084034451049094715202196203486088368791744107629271647320273259836915312794297246589501008666299165717722507702866033454215783240025504356157664454861755286285777763585177751796252655008206383024707883077513745863312079349790275094080707502392866946325796914450602264462588722052297430827681750827349094323968337670311272933785838850649376115667223821665435911506351891489985627506615492005617098615432522564204152887767244129985681083657783356557756654335186</span>
c22<span class="token operator">=</span><span class="token number">373940646416832740878733255707567753033716583448402000789202767511920210382830343955553654111486728333980557319799362514960627879016797491389812007768832730979916230647641872759001906846747977631675704310179448857128160385701185892914523053669366534408863734305635222625590986006420486092550427301086984563126480814987024980594613542978310129247678826691418335300577577527951623696426435497835228167084738007750914270251001921329521479047662848650808989996085600197309361410863238526802127877523767262921515150984998560136647154865791163316503073285223966216441025637452229043510097323724381056976302288136843260163922706692913035222445496716008888946581535004546355744211680390731257309941902587303353139951102244865270295414474488798335404630458489706639805186573874814586736746232358849677477533671968344154242963289415569487579895910660999043578737461300406937828924818002658292769882181668784501439254131996848948120781562158861495883827848139425862249576454689133681009549361314460818658995959098228995702202268649635363105549975932395335076521137604288520082040121286614922986554652700056148966514178935952363036963217619879899671383604638416567950421350546204434902113156720006282720889591288850271076074941927715678306057176</span>
c23<span class="token operator">=</span><span class="token number">527630926460622936571385649841758214453416849039412401087443444317101857090904711485538107058823056085840539073345920792871368232355475394571098380596835468509997340505604333730547799560998822989747473780307779717715522787724471724766494090783971030594671013168209717686720448579582618378459567979027822271918653169622428153856198907810040224340270362413432495029672123261375400927159831537760709974778708160583252613784358234858583174544777979242887938827573604837766801998381379999076416444683891078093889686055482709838668356120916040352123019019255084513769603803814947774554028717814638951416291274696771515474086351482107953150253616922787262398450376249126999644026382478413080973933173079111305142716133389111399235545279259017424722601848670061556859163943895466553927946412523750166582734005733378328468250568944945912238495877929717101722314678120172228493787964904072583905721074766711732215815561012960394537195757832959268603775112932862105945720853959285187521763557915356428113876893276879775603217718981852114599706699524551973934242045743122744146361596971245034059345915315495232135483464496114770357536576200511490922413208178149869347802988786513451486411409887164516065062084917556120712465074206435831498113605</span>
c24<span class="token operator">=</span><span class="token number">8786437178698940322877889807009957616777351844979869726962356553244050911283984280960665761649310895230455072977431415102053987735969326553978994853162483051544656873294555116009995592043183070208706258164840540599577072097104139505857517663273929851202628854185356185647194933800084230503413037858893307713037149307477830536758283681093517617820169181420796105338681582230788318108428132051793761014952837330456262272828627355701464740578197966332613127307037255647286823496355917642353327912440019621838870388091824748629637425759125214639885130163183752378908729773517053259212525494555880921052679512582051516604297098204363525081039382358483926727008679327719083138865969291911863630382097160230960738043575559330264018212774424527719153248563876760067931499029384228993253862501939337758514377472011933279273181144830381169849387893799390755052093069179605579485710343655570028592595882436632426527654452895431758715126580164902410286422637215098476316042367916779431052267545769495994723721129943616294879642305545894912914632980455031755879087401575310699765408473606166727137934224515998416625122213056208800095077933103150699272650116151674702438463062734472714004926103668378506804002740045547964716693536349447660850580</span>
c25<span class="token operator">=</span><span class="token number">205314962204511500352858372254132533167549960825498949618514841570703199264867431580754674275990554478140637041427842111391746883257447120035947621456863890934062044010795443059281736346976175772415034838334682726635263432655537852942177334888025283748611576171534251461847349566505628290587224150869640386437623371249743165260396675220683302142805646368906930575140628610003919131999295855501215111393294818218799982703289304596989070475000081175510085432290264502023736899104746316830742226946395027029820825791831870857382647221322734605026210073093918331247494307555600335550942340526536281372036612138713881098866303169425501998978400008829873080965592009371176208668290074288903681417933657472279670688597862835627506340169978450918788539270346340385928840299573889292189531738082166408734046381423516467694328971385421907314814283489322619386570046183556572383980777277173349209330683424343658179781015072259378576130442222984963071166207642585589822061597282467850868050737957726423713761694231879497037175627546427449730638216214828463003483408928375620315193290871300316930139260521382533279767663839278693750409419493280753368451508802658272220767624766390639285308433607255253282702383762149755935518922075584637512494819</span>
c26<span class="token operator">=</span><span class="token number">271453634732502613378948161256470991260052778799128789839624515809143527363206813219580098196957510291648493698144497567392065251244844074992734669490296293997386198359280316655904691639367482203210051809125904410431506925238374843856343243276508280641059690938930957474434518308646618959004216831130099873532714372402117796666560677624822509159287675432413016478948594640872091688482149004426363946048517480052906306290126242866034249478040406351940088231081456109195799442996799641647167552689564613346415247906852055588498305665928450828756152103096629274760601528737639415361467941349982213641454967962723875032638267311935042334584913897338553953961877439389588793074211502597238465542889335363559052368180212013206172712561221352833891640659020253527584706465205486408990762759230842192028381048563437724528409174790022752557512795782713125166158329880702730769957185428522011430144840232256419113631679343171680631630775266488738173707357123139368825087043785842169049943237537188129367275730984789479909103397937113837824575137021012333461552176687570010445744268373840742899299977372834041925102853718964831225250407279578465008537542659673685686242773379131904890865110699190451534445434533919127658976874721029586168106207</span>

e1 <span class="token operator">=</span> <span class="token number">1697</span>
c11<span class="token operator">=</span><span class="token number">412629526163150748619328091306742267675740578011800062477174189782151273970783531227579758540364970485350157944321579108232221072397135934034064481497887079641131808838242743811511451355024436983050572020925065644355566434625618133203024215941534926113892937988520918939061441606915556516246057349589921494351383160036280826024605351878408056180907759973804117263002554923041750587548819746346813966673034182913325507826219961923932100526305289894965216608254252188398580139545189681875824089456195044984585824938384521905334289906422454152976834867304693292466676355760173232407753256256317546190171995276258924613533179898467683358934751999655196790168438343198229183747091108262988777659858609744709324571850262293294975336628234767258858873839342596887193772615000676401522431518310648303975593582965021189182246986957349253156736526071639973844039068996404290548474640668851856078201093335425412842295604919065487301340901573809617549185106072798799159726375235125260509158832996701927878713084753334549129580912412168594170659605421750204835970231909591063407612779337478065175988365401590396247576709343727196106058477166945670117868989025903023998142850338956985816131805349549059377047477131270847579095628384569645636821650</span>
c12<span class="token operator">=</span><span class="token number">494644347943710545224678831941589086572700792465459558770782213550069709458568349686998660541810166872034041584767487150140111151788221460027897193248273461607411027815984883969396220626358625041781558277804930212654296704055890683796941327712758797770820006623289146990000114915293539639766846910274034245607746230740851938158390562286057002223177609606376329007676845450142537930798148258428701466415483232670659815791064681384406494388237742330786225557303988025468036820082959712050733095860546860468575857084616069132051094882919253745234762029759124776348047587755897123575123506976140900565238840752841856713613368250071926171873213897914794115466890719123299469964019450899291410760762179836946570945555295288184698184555018368687708432612286248476073758067175481771199066581572870175460016017100414479346437034291784837132240891321931601494414908927713208448927221095745802380014441841139882391378410438764884597938773868771896252329517440068673532468372840830510218585255432000690265226016573313570977945083879214961394087065558376158826938257664840570952233832852869328785568175434516247720356520242602299510374317488182738732700078879665745909603766482100138001417023680647717824323143388857817595766172152883484274718248</span>
c13<span class="token operator">=</span><span class="token number">152942283599728307168144137370127212672611894072038732126041098102628831053000986759260271210671922070555948023688596575415822984026159010574404359474670428678518262175033880513984372909748992727828381694416776740981021730545374002974037896534944567124543272737618380646771071804878796585983783360553761828325817820260204820004421979881871027255562690952334900616675606524933557440263648233514757200263521499508373975003431306847453046714027687108396945719803444444954079308404947126216395526551292104722047878178373207886033071857277857997932255251315982837892164421298202073945919187779856785892717251746704537315003771369737854896595170485152591013676942418134278534037654467840633528916812275267230155352077736583130992587670941654695382287023971261529987384520843829695778029311786431227409189019205818351911572757145556993606643464336196802350204616056286497246016800105003143046120608673496196758720552776772796609670537056331996894322779267635281472481559819839042424017171718303214059720568484939239370144038161541354254182769979771948759413102933987773401644506930205164891773826513161783736386604783484446345744957119469799231796368324927570694496679453313927562345656690240414624431304646248599226046524702364131095964335</span>
c14<span class="token operator">=</span><span class="token number">79717988936247951265489157583697956031893477858854186991051529161879478488281744062318600470906120960002282886511477294555606503083169449335174864424180701080203993329996226566203834693869525797695969610065991941396723959032680019082506816443041598300477625793433080664346470586416385854692124426348587211026568667694805849554780794033764714016521711467557284846737236374990121316809833819996821592832639024026411520407330206281265390130763948165694574512140518775603040182029818771866749548761938870605590174330887949847420877829240131490902432602005681085180807294176837646062568094875766945890382971790015490163385088144673549085079635083262975154206269679142412897438231719704933258660779310737302680265445437771977749959110744959368586293082016067927548564967400845992380076107522755566531760628823374519718763740378295585535591752887339222947397184116326706799921515431185636740825707782742373783475781052674257292910213843986132987466810027275052416774693363446184518901899202502828670309452622347532932678874990809930682575738653876289384151496807194146308614368821006660626870989784697045160231069428458961107751207771093777394616856305293335603892178327520756554333365975114235981173451368131680404850832773147333013716920</span>
c15<span class="token operator">=</span><span class="token number">123111353650401158556639983459870663057297871992927053886971224773529636525110628183715748795987525113177540092814119928708272290370336537110381023134637759740716140969662183269370676630325583385284994943164692397459103195434968057377474610500216801375394703781249039351368816958227409657934091741509357152328382960684515093945552479461382281913961956745154260686029997827565075768703774895750561575155143606297116391666385705899138085693913246313778033627210312268959737394553510894720099165193981333775907531107232556909478156441457899797515694348816961762796703443502856101079430585547997496001098926600499728389113862894833789669213630332988693669889340482430613291490613803204484751470676686041002772556117213612152322606737150858116122936539131795111263513114569794532805886643087299918196635113037777138666914296986040549274559835214505300618256105508764026461518876579387159881983544667258537064954616097750399839661065797883103731694314852301848272092388637114950059216922969842082648527035538090054093890365647676119748995243416337805666557501345234056968476142608491830438065401219751688687373709390057521910942736632126729711606256158399963682990881473178216060827021373776598901281958527655543318413664277921492723185984</span>
c16<span class="token operator">=</span><span class="token number">36869806815936046911848195817405817350259890871483063184373728397968909458432625046025376290214729914038387534731762237978339011724858818860181178811639468996206294711495853807311240013786226884265118119546377272154555615363105236192878292703331473547623021744317034819416624562896226194523639793573028006666236271812390759036235867495803255905843636447252225413871038762657801345647584493917576263471587347202664391908570140389126903204602391093990827188675090199750617303773574821926387194478875191828814971296674530519321530805302667925998711835019806761133078403281404889374663875077339168901297819436499920958268483684335998301056068380228873524800383911402490807139268964095165069610454677558808756444381542173782815227920906224931028457073652453777424387873533280455944646592996920617956675786286711447540353883400282402551158169958389450168079568459656526911857835375748015814860506707921852997096156275804955989964215077733621769938075413007804223217091604613132253046399456747595300404564172224333936405545921819654435437072133387523533568472443532200069133022979195685683508297337961701169394794966256415112246587706103819620428258245999539040721929317130088874161577093962579487428358736401687123174207198251449851429295</span>

c1 <span class="token operator">=</span> <span class="token punctuation">[</span>c11<span class="token punctuation">,</span>c12<span class="token punctuation">,</span>c13<span class="token punctuation">,</span>c14<span class="token punctuation">,</span>c15<span class="token punctuation">,</span>c16<span class="token punctuation">]</span>
c2 <span class="token operator">=</span> <span class="token punctuation">[</span>c21<span class="token punctuation">,</span>c22<span class="token punctuation">,</span>c23<span class="token punctuation">,</span>c24<span class="token punctuation">,</span>c25<span class="token punctuation">,</span>c26<span class="token punctuation">]</span>

s <span class="token operator">=</span> <span class="token string">''</span>
a <span class="token operator">=</span> gcdext<span class="token punctuation">(</span>e1<span class="token punctuation">,</span>e2<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token operator">*</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token operator">%</span>N
    s <span class="token operator">+=</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span>                                        <span class="token comment">#16进制转字符串</span>
    <span class="token comment">#s += binascii.unhexlify(hex(m)[2:]).decode()     16进制转字符串（另一种写法）</span>
ans<span class="token operator">=</span>s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>   <span class="token comment"># 通过分隔符\n对 s 内的字符串进行切片操作</span>

<span class="token comment"># 关键代码</span>
libase64<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">,</span><span class="token string">'D'</span><span class="token punctuation">,</span><span class="token string">'E'</span><span class="token punctuation">,</span><span class="token string">'F'</span><span class="token punctuation">,</span><span class="token string">'G'</span><span class="token punctuation">,</span><span class="token string">'H'</span><span class="token punctuation">,</span><span class="token string">'I'</span><span class="token punctuation">,</span><span class="token string">'J'</span><span class="token punctuation">,</span><span class="token string">'K'</span><span class="token punctuation">,</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token string">'M'</span><span class="token punctuation">,</span><span class="token string">'N'</span><span class="token punctuation">,</span><span class="token string">'O'</span><span class="token punctuation">,</span><span class="token string">'P'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'R'</span><span class="token punctuation">,</span><span class="token string">'S'</span><span class="token punctuation">,</span><span class="token string">'T'</span><span class="token punctuation">,</span><span class="token string">'U'</span><span class="token punctuation">,</span><span class="token string">'V'</span><span class="token punctuation">,</span><span class="token string">'W'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">,</span><span class="token string">'d'</span><span class="token punctuation">,</span><span class="token string">'e'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span><span class="token string">'h'</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">,</span><span class="token string">'j'</span><span class="token punctuation">,</span><span class="token string">'k'</span><span class="token punctuation">,</span><span class="token string">'l'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'n'</span><span class="token punctuation">,</span><span class="token string">'o'</span><span class="token punctuation">,</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token string">'q'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span><span class="token string">'s'</span><span class="token punctuation">,</span><span class="token string">'t'</span><span class="token punctuation">,</span><span class="token string">'u'</span><span class="token punctuation">,</span><span class="token string">'v'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">,</span><span class="token string">'z'</span><span class="token punctuation">,</span><span class="token string">'0'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">,</span><span class="token string">'6'</span><span class="token punctuation">,</span><span class="token string">'7'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">,</span><span class="token string">'+'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">myb64_bytes</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token operator">=</span><span class="token string">''</span>
    temp<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>         <span class="token comment">#去掉=号</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> temp<span class="token punctuation">:</span>
        s<span class="token operator">+=</span><span class="token builtin">bin</span><span class="token punctuation">(</span>libase64<span class="token punctuation">.</span>index<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> s

<span class="token keyword">def</span> <span class="token function">bytes_to_string</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    s<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        s<span class="token operator">+=</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token string">'0b'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> s

flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> ans<span class="token punctuation">:</span>
    b<span class="token operator">=</span>myb64_bytes<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    temp<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">8</span>
    <span class="token keyword">if</span> temp <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> b<span class="token punctuation">[</span><span class="token operator">-</span>temp<span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag<span class="token operator">=</span>flag

<span class="token keyword">print</span><span class="token punctuation">(</span>bytes_to_string<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E7%A6%BB%E6%95%A3%E5%AF%B9%E6%95%B0">离散对数</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> random

n <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">512</span>
m <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">1</span>
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'m = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token string">'c = '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>

<span class="token comment"># m = 391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span>
<span class="token comment"># c = 6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span>
</pre><p>c = m ** flag mod n (这里的等号是同余号)。<br>
意思为 c同余m的flag次方 模 n</p>
<p>我们要解flag的值，用函数 discrete_log(n,c,m) (模数，同余数，同余数)</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>

n <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">512</span>
<span class="token comment"># n = 13407807929942597099574024998205846127479365820592393377723561443721764030073546976801874298166903427690031858186486050853753882811946569946433649006084096</span>
m <span class="token operator">=</span> <span class="token number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span>
c <span class="token operator">=</span> <span class="token number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span>

flag <span class="token operator">=</span> discrete_log<span class="token punctuation">(</span>n<span class="token punctuation">,</span>c<span class="token punctuation">,</span>m<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%BF%AB%E9%80%9F%E5%B9%82">快速幂</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">import</span> random
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> gcd<span class="token punctuation">,</span> invert
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> getRandomNBitInteger<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>
flag <span class="token operator">=</span> <span class="token string">b"MRCTF{xxxx}"</span>
base <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token keyword">def</span> <span class="token function">GCD</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    B <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        B <span class="token operator">=</span> gcd<span class="token punctuation">(</span>A<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> B

<span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    P<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        P<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>P<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_p :"</span><span class="token punctuation">,</span> P<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">*=</span> P<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    factor <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> base<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_factor :"</span><span class="token punctuation">,</span> factor<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sub_Q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_1 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q_2 <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    Q <span class="token operator">=</span> sub_Q <span class="token operator">**</span> Q_2 <span class="token operator">%</span> Q_1
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_1: "</span><span class="token punctuation">,</span> Q_1<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_2: "</span><span class="token punctuation">,</span> Q_2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"sub_Q: "</span><span class="token punctuation">,</span> sub_Q<span class="token punctuation">)</span>
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    _E <span class="token operator">=</span> base
    _P <span class="token operator">=</span> gen_p<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _Q <span class="token operator">=</span> gen_q<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>gcd<span class="token punctuation">(</span>_E<span class="token punctuation">,</span> <span class="token punctuation">(</span>_P <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>_Q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    _M <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    _C <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>_M<span class="token punctuation">,</span> _E<span class="token punctuation">,</span> _P <span class="token operator">*</span> _Q<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ciphertext = "</span><span class="token punctuation">,</span> _C<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
P_p : 206027926847308612719677572554991143421
P_factor : 213671742765908980787116579976289600595864704574134469173111790965233629909513884704158446946409910475727584342641848597858942209151114627306286393390259700239698869487469080881267182803062488043469138252786381822646126962323295676431679988602406971858136496624861228526070581338082202663895710929460596143281673761666804565161435963957655012011051936180536581488499059517946308650135300428672486819645279969693519039407892941672784362868653243632727928279698588177694171797254644864554162848696210763681197279758130811723700154618280764123396312330032986093579531909363210692564988076206283296967165522152288770019720928264542910922693728918198338839
Q_1:  103766439849465588084625049495793857634556517064563488433148224524638105971161051763127718438062862548184814747601299494052813662851459740127499557785398714481909461631996020048315790167967699932967974484481209879664173009585231469785141628982021847883945871201430155071257803163523612863113967495969578605521
Q_2:  151010734276916939790591461278981486442548035032350797306496105136358723586953123484087860176438629843688462671681777513652947555325607414858514566053513243083627810686084890261120641161987614435114887565491866120507844566210561620503961205851409386041194326728437073995372322433035153519757017396063066469743
sub_Q:  168992529793593315757895995101430241994953638330919314800130536809801824971112039572562389449584350643924391984800978193707795909956472992631004290479273525116959461856227262232600089176950810729475058260332177626961286009876630340945093629959302803189668904123890991069113826241497783666995751391361028949651
Ciphertext =  1709187240516367141460862187749451047644094885791761673574674330840842792189795049968394122216854491757922647656430908587059997070488674220330847871811836724541907666983042376216411561826640060734307013458794925025684062804589439843027290282034999617915124231838524593607080377300985152179828199569474241678651559771763395596697140206072537688129790126472053987391538280007082203006348029125729650207661362371936196789562658458778312533505938858959644541233578654340925901963957980047639114170033936570060250438906130591377904182111622236567507022711176457301476543461600524993045300728432815672077399879668276471832
'''</span>
</pre><p>解题的关键就是得到 _Q和_P的值</p>
<p>得到_P 需要先求得 n 值，即 p[i] 的积，已知 p[9] 所以可以得到其他数的值。通过nextprime()和prevprime()获取。</p>
<p>由下面的代码可知 n *= p[i]</p>
<p>用快速幂求出_Q</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span><span class="token operator">*</span>

e <span class="token operator">=</span> <span class="token number">65537</span>
P_factor <span class="token operator">=</span> <span class="token number">213671742765908980787116579976289600595864704574134469173111790965233629909513884704158446946409910475727584342641848597858942209151114627306286393390259700239698869487469080881267182803062488043469138252786381822646126962323295676431679988602406971858136496624861228526070581338082202663895710929460596143281673761666804565161435963957655012011051936180536581488499059517946308650135300428672486819645279969693519039407892941672784362868653243632727928279698588177694171797254644864554162848696210763681197279758130811723700154618280764123396312330032986093579531909363210692564988076206283296967165522152288770019720928264542910922693728918198338839</span>
Q_1 <span class="token operator">=</span> <span class="token number">103766439849465588084625049495793857634556517064563488433148224524638105971161051763127718438062862548184814747601299494052813662851459740127499557785398714481909461631996020048315790167967699932967974484481209879664173009585231469785141628982021847883945871201430155071257803163523612863113967495969578605521</span>
Q_2 <span class="token operator">=</span> <span class="token number">151010734276916939790591461278981486442548035032350797306496105136358723586953123484087860176438629843688462671681777513652947555325607414858514566053513243083627810686084890261120641161987614435114887565491866120507844566210561620503961205851409386041194326728437073995372322433035153519757017396063066469743</span>
sub_Q <span class="token operator">=</span> <span class="token number">168992529793593315757895995101430241994953638330919314800130536809801824971112039572562389449584350643924391984800978193707795909956472992631004290479273525116959461856227262232600089176950810729475058260332177626961286009876630340945093629959302803189668904123890991069113826241497783666995751391361028949651</span>
c <span class="token operator">=</span> <span class="token number">1709187240516367141460862187749451047644094885791761673574674330840842792189795049968394122216854491757922647656430908587059997070488674220330847871811836724541907666983042376216411561826640060734307013458794925025684062804589439843027290282034999617915124231838524593607080377300985152179828199569474241678651559771763395596697140206072537688129790126472053987391538280007082203006348029125729650207661362371936196789562658458778312533505938858959644541233578654340925901963957980047639114170033936570060250438906130591377904182111622236567507022711176457301476543461600524993045300728432815672077399879668276471832</span>
P_p <span class="token operator">=</span> <span class="token number">206027926847308612719677572554991143421</span>

<span class="token comment">#求出16个素数</span>
p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    P_p <span class="token operator">=</span> prevprime<span class="token punctuation">(</span>P_p<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>append<span class="token punctuation">(</span>P_p<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nextprime<span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> <span class="token number">1</span>
phi <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">*=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token comment">#求素数p的积</span>
    phi <span class="token operator">*=</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">#求欧拉函数phi</span>
d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
_P <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>P_factor<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>     <span class="token comment">#求出_P的值</span>
_P <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>_P<span class="token punctuation">)</span>

<span class="token comment">#求_Q的值</span>
Q <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>sub_Q<span class="token punctuation">,</span>Q_2<span class="token punctuation">,</span>Q_1<span class="token punctuation">)</span>
_Q <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>Q<span class="token punctuation">)</span>

N <span class="token operator">=</span> _P<span class="token operator">*</span>_Q
Phi <span class="token operator">=</span> <span class="token punctuation">(</span>_Q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>_P<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
_d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>Phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>_d<span class="token punctuation">)</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86%E4%BD%8E%E5%8A%A0%E5%AF%86%E6%8C%87%E6%95%B0%E6%94%BB%E5%87%BB%E7%88%86%E7%A0%B4ephi-%E4%B8%8D%E4%BA%92%E7%B4%A0">中国剩余定理+低加密指数攻击爆破+e，phi 不互素</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> binascii
<span class="token keyword">from</span> data <span class="token keyword">import</span> e1<span class="token punctuation">,</span>e2<span class="token punctuation">,</span>p<span class="token punctuation">,</span>q1p<span class="token punctuation">,</span>q1q<span class="token punctuation">,</span>hint<span class="token punctuation">,</span>flag

n <span class="token operator">=</span>  <span class="token punctuation">[</span>20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423L<span class="token punctuation">,</span> 31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421L<span class="token punctuation">,</span> 29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303L<span class="token punctuation">,</span> 25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791L<span class="token punctuation">]</span>
c <span class="token operator">=</span>  <span class="token punctuation">[</span>19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569L<span class="token punctuation">,</span> 15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031L<span class="token punctuation">,</span> 18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446L<span class="token punctuation">,</span> 2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797L<span class="token punctuation">]</span>
f<span class="token operator">=</span><span class="token keyword">lambda</span> m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">,</span>c<span class="token punctuation">:</span><span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">==</span>c
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span>n<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span>

ee1 <span class="token operator">=</span> <span class="token number">42</span>
ee2 <span class="token operator">=</span> <span class="token number">3</span>
ce1 <span class="token operator">=</span>  <span class="token number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span>
ce2 <span class="token operator">=</span>  <span class="token number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span>
tmp <span class="token operator">=</span>  <span class="token number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span>
n  <span class="token operator">=</span>  <span class="token number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e1<span class="token punctuation">,</span>ee1<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">==</span>ce1<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span>e2<span class="token operator">+</span>tmp<span class="token punctuation">,</span>ee2<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">==</span>ce2<span class="token punctuation">)</span>

e <span class="token operator">=</span> <span class="token number">46531</span>
n <span class="token operator">=</span> <span class="token number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span>
c <span class="token operator">=</span> <span class="token number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span>
hint<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>hint<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>q1p<span class="token operator">*</span>q1q<span class="token operator">==</span>n<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>q1p<span class="token operator">&lt;</span>q1q<span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>c<span class="token operator">==</span><span class="token builtin">pow</span><span class="token punctuation">(</span>hint<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>

flag<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>hexlify<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
q1<span class="token operator">=</span>q1p
q2 <span class="token operator">=</span>  <span class="token number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span>
c1 <span class="token operator">=</span>  <span class="token number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span>
c2 <span class="token operator">=</span>  <span class="token number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>c1<span class="token operator">==</span><span class="token builtin">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span>e1<span class="token punctuation">,</span>p<span class="token operator">*</span>q1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>c2<span class="token operator">==</span><span class="token builtin">pow</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span>e2<span class="token punctuation">,</span>p<span class="token operator">*</span>q2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>

<span class="token comment">#第一步，CRT 求出p值</span>
<span class="token keyword">def</span> <span class="token function">CRT</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    N <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span>x<span class="token operator">*</span>y<span class="token punctuation">,</span>n<span class="token punctuation">)</span>   <span class="token comment"># ni 的乘积</span>

    <span class="token keyword">for</span> n_i<span class="token punctuation">,</span> a_i <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># zip()将对象打包成元组</span>
        N_i <span class="token operator">=</span> N <span class="token operator">//</span> n_i
        <span class="token builtin">sum</span> <span class="token operator">+=</span> a_i<span class="token operator">*</span>N_i<span class="token operator">*</span>invert<span class="token punctuation">(</span>N_i<span class="token punctuation">,</span>n_i<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">sum</span> <span class="token operator">%</span> N

n <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423</span><span class="token punctuation">,</span><span class="token number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421</span><span class="token punctuation">,</span><span class="token number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303</span><span class="token punctuation">,</span><span class="token number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791</span><span class="token punctuation">]</span>
c <span class="token operator">=</span>  <span class="token punctuation">[</span><span class="token number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569</span><span class="token punctuation">,</span><span class="token number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031</span><span class="token punctuation">,</span><span class="token number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446</span><span class="token punctuation">,</span><span class="token number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797</span><span class="token punctuation">]</span>
x <span class="token operator">=</span> CRT<span class="token punctuation">(</span>c<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
p <span class="token operator">=</span> iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">#p = 109935857933867829728985398563235455481120300859311421762540858762721955038310117609456763338082237907005937380873151279351831600225270995344096532750271070807051984097524900957809427861441436796934012393707770012556604479065826879107677002380580866325868240270494148512743861326447181476633546419262340100453</span>

ee1 <span class="token operator">=</span> <span class="token number">42</span>
ee2 <span class="token operator">=</span> <span class="token number">3</span>
ce1 <span class="token operator">=</span>  <span class="token number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span>
ce2 <span class="token operator">=</span>  <span class="token number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span>
tmp <span class="token operator">=</span>  <span class="token number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span>
n  <span class="token operator">=</span>  <span class="token number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span>

<span class="token comment">#第二步，求出e1,e2的值(低加密指数攻击)</span>
<span class="token keyword">def</span> <span class="token function">cal_e</span><span class="token punctuation">(</span>ce<span class="token punctuation">,</span>ee<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> ce<span class="token operator">+</span>k<span class="token operator">*</span>n
        <span class="token keyword">if</span><span class="token punctuation">(</span>iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>ee<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span>ee<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        k<span class="token operator">+=</span><span class="token number">1</span>
e1 <span class="token operator">=</span> cal_e<span class="token punctuation">(</span>ce1<span class="token punctuation">,</span>ee1<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
e2 <span class="token operator">=</span> cal_e<span class="token punctuation">(</span>ce2<span class="token punctuation">,</span>ee2<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">-</span>tmp

<span class="token comment">#第三步，分解n，把小的作为q1</span>
q1 <span class="token operator">=</span>  <span class="token number">127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088834871</span>
q2 <span class="token operator">=</span>  <span class="token number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span>
c1 <span class="token operator">=</span>  <span class="token number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span>
c2 <span class="token operator">=</span>  <span class="token number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span>

<span class="token comment">#第四步（e,phi不互素）</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>q1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># print(gcd(e1,phi))       #gcd = 2</span>
dq <span class="token operator">=</span> invert<span class="token punctuation">(</span>e1<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span>dq<span class="token punctuation">,</span>q1<span class="token punctuation">)</span>
m <span class="token operator">=</span> iroot<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%B7%B2%E7%9F%A5-n-%E8%B4%A8%E6%95%B0%E7%9B%B8%E4%B9%981-pollards-p-1">已知 n、质数相乘+1 (Pollard's p-1)</h2>

<p><strong>例题 [NCTF2019]childRSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> choice
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> isPrime<span class="token punctuation">,</span> sieve_base <span class="token keyword">as</span> primes
<span class="token keyword">from</span> flag <span class="token keyword">import</span> flag

<span class="token keyword">def</span> <span class="token function">getPrime</span><span class="token punctuation">(</span>bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">while</span> n<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> bits<span class="token punctuation">:</span>
            n <span class="token operator">*=</span> choice<span class="token punctuation">(</span>primes<span class="token punctuation">)</span>
        <span class="token keyword">if</span> isPrime<span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> n <span class="token operator">+</span> <span class="token number">1</span>

e <span class="token operator">=</span> <span class="token number">0x10001</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>
p<span class="token punctuation">,</span> q <span class="token operator">=</span> <span class="token punctuation">[</span>getPrime<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q
c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

<span class="token comment"># n = 32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span>
<span class="token comment"># c = 26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span>
</pre><p>注意到生成质数的过程，是在质数库里面选一堆质数乘起来，最后加上 1。这会导致  拥有小因子。采用 Pollard's p-1 攻击</p>
<pre data-role="codeBlock" data-info="py" class="language-python">python <span class="token operator">-</span>m primefac <span class="token operator">-</span>vs <span class="token operator">-</span>m<span class="token operator">=</span>p<span class="token operator">-</span><span class="token number">1</span> <span class="token number">32849718197337581823002243717057659218502519004386996660885100592872201948834155543125924395614928962750579667346279456710633774501407292473006312537723894221717638059058796679686953564471994009285384798450493756900459225040360430847240975678450171551048783818642467506711424027848778367427338647282428667393241157151675410661015044633282064056800913282016363415202171926089293431012379261585078566301060173689328363696699811123592090204578098276704877408688525618732848817623879899628629300385790344366046641825507767709276622692835393219811283244303899850483748651722336996164724553364097066493953127153066970594638491950199605713033004684970381605908909693802373826516622872100822213645899846325022476318425889580091613323747640467299866189070780620292627043349618839126919699862580579994887507733838561768581933029077488033326056066378869170169389819542928899483936705521710423905128732013121538495096959944889076705471928490092476616709838980562233255542325528398956185421193665359897664110835645928646616337700617883946369110702443135980068553511927115723157704586595844927607636003501038871748639417378062348085980873502535098755568810971926925447913858894180171498580131088992227637341857123607600275137768132347158657063692388249513</span>
</pre><p>得到 pq</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> libnum

c <span class="token operator">=</span> <span class="token number">26308018356739853895382240109968894175166731283702927002165268998773708335216338997058314157717147131083296551313334042509806229853341488461087009955203854253313827608275460592785607739091992591431080342664081962030557042784864074533380701014585315663218783130162376176094773010478159362434331787279303302718098735574605469803801873109982473258207444342330633191849040553550708886593340770753064322410889048135425025715982196600650740987076486540674090923181664281515197679745907830107684777248532278645343716263686014941081417914622724906314960249945105011301731247324601620886782967217339340393853616450077105125391982689986178342417223392217085276465471102737594719932347242482670320801063191869471318313514407997326350065187904154229557706351355052446027159972546737213451422978211055778164578782156428466626894026103053360431281644645515155471301826844754338802352846095293421718249819728205538534652212984831283642472071669494851823123552827380737798609829706225744376667082534026874483482483127491533474306552210039386256062116345785870668331513725792053302188276682550672663353937781055621860101624242216671635824311412793495965628876036344731733142759495348248970313655381407241457118743532311394697763283681852908564387282605279108</span>

p <span class="token operator">=</span> <span class="token number">178449493212694205742332078583256205058672290603652616240227340638730811945224947826121772642204629335108873832781921390308501763661154638696935732709724016546955977529088135995838497476350749621442719690722226913635772410880516639651363626821442456779009699333452616953193799328647446968707045304702547915799734431818800374360377292309248361548868909066895474518333089446581763425755389837072166970684877011663234978631869703859541876049132713490090720408351108387971577438951727337962368478059295446047962510687695047494480605473377173021467764495541590394732685140829152761532035790187269724703444386838656193674253139</span>
q <span class="token operator">=</span> <span class="token number">184084121540115307597161367011014142898823526027674354555037785878481711602257307508985022577801782788769786800015984410443717799994642236194840684557538917849420967360121509675348296203886340264385224150964642958965438801864306187503790100281099130863977710204660546799128755418521327290719635075221585824217487386227004673527292281536221958961760681032293340099395863194031788435142296085219594866635192464353365034089592414809332183882423461536123972873871477755949082223830049594561329457349537703926325152949582123419049073013144325689632055433283354999265193117288252918515308767016885678802217366700376654365502867</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token operator">*</span>q<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E7%A7%81%E9%92%A5%E6%96%87%E4%BB%B6%E4%BF%AE%E5%A4%8D">私钥文件修复</h2>

<p>适用情况：提供破损的私钥文件。</p>
<p><strong>例题 Jarvis OJ-God Like RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">#-*- coding:utf-8 -*-</span>

<span class="token keyword">import</span> re
<span class="token keyword">import</span> pickle
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> product
<span class="token keyword">from</span> libnum <span class="token keyword">import</span> invmod<span class="token punctuation">,</span> gcd

<span class="token keyword">def</span> <span class="token function">solve_linear</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> b <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>b <span class="token operator">*</span> invmod<span class="token punctuation">(</span>a<span class="token punctuation">,</span> mod<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>mod <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># hack for mod = power of 2</span>

<span class="token keyword">def</span> <span class="token function">to_n</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r"[^0-9a-f]"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">msk</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cleaned <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msk_ranges<span class="token punctuation">(</span>cleaned<span class="token punctuation">)</span><span class="token punctuation">,</span> msk_mask<span class="token punctuation">(</span>cleaned<span class="token punctuation">)</span><span class="token punctuation">,</span> msk_val<span class="token punctuation">(</span>cleaned<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">msk_ranges</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">msk_mask</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">else</span> <span class="token string">"f"</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">msk_val</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"0"</span> <span class="token keyword">if</span> c <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">else</span> c <span class="token keyword">for</span> c <span class="token keyword">in</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

E <span class="token operator">=</span> <span class="token number">65537</span>

N <span class="token operator">=</span> to_n<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""00:c0:97:78:53:45:64:84:7d:8c:c4:b4:20:e9:33:
    58:67:ec:78:3e:6c:f5:f0:5c:a0:3e:ee:dc:25:63:
    d0:eb:2a:9e:ba:8f:19:52:a2:67:0b:e7:6e:b2:34:
    b8:6d:50:76:e0:6a:d1:03:cf:77:33:d8:b1:e9:d7:
    3b:e5:eb:1c:65:0c:25:96:fd:96:20:b9:7a:de:1d:
    bf:fd:f2:b6:bf:81:3e:3e:47:44:43:98:bf:65:2f:
    67:7e:27:75:f9:56:47:ba:c4:f0:4e:67:2b:da:e0:
    1a:77:14:40:29:c1:a8:67:5a:8f:f5:2e:be:8e:82:
    31:3d:43:26:d4:97:86:29:15:14:a9:69:36:2c:76:
    ed:b5:90:eb:ec:6f:ce:d5:ca:24:1c:aa:f6:63:f8:
    06:a2:62:cb:26:74:d3:5b:82:4b:b6:d5:e0:49:32:
    7b:62:f8:05:c4:f7:0e:86:59:9b:f3:17:25:02:aa:
    3c:97:78:84:7b:16:fd:1a:f5:67:cf:03:17:97:d0:
    c6:69:85:f0:8d:fa:ce:ee:68:24:63:06:24:e1:e4:
    4c:f8:e9:ad:25:c7:e0:c0:15:bb:b4:67:48:90:03:
    9b:20:7f:0c:17:eb:9d:13:44:ab:ab:08:a5:c3:dc:
    c1:98:88:c5:ce:4f:5a:87:9b:0b:bf:bd:d7:0e:a9:
    09:59:81:fa:88:4f:59:60:6b:84:84:ad:d9:c7:25:
    8c:e8:c0:e8:f7:26:9e:37:95:7c:e1:48:29:0f:51:
    e7:bd:98:2f:f6:cc:80:e7:f0:32:0b:89:51:92:4e:
    c2:6d:50:53:2b:3b:77:72:d1:bd:1a:1f:92:d7:12:
    79:61:61:c5:a4:7e:b3:85:eb:f0:7c:6d:46:03:c5:
    e6:d5:81:2c:ba:7e:ea:8d:51:7d:63:55:34:2a:b6:
    d4:dc:31:5a:f1:99:e3:dc:8c:83:0b:a2:2a:d5:3c:
    41:48:41:54:1a:a9:e8:b6:70:bf:d3:fe:ed:19:17:
    14:94:13:b3:17:e3:8b:8e:6f:53:ed:e2:44:e8:4a:
    32:d6:5c:0d:a8:80:f5:fc:02:e9:46:55:d5:a4:d3:
    e7:c6:30:77:f9:73:e9:44:52:d8:13:9d:5d:bf:9e:
    fa:3a:b5:96:79:82:5b:cd:19:5c:06:a9:00:96:fd:
    4c:a4:73:88:1a:ec:3c:11:de:b9:3d:e0:50:00:1e:
    ac:21:97:a1:96:7d:6b:15:f9:6c:c9:34:7f:70:d7:
    9d:2d:d1:48:4a:81:71:f8:12:dd:32:ba:64:31:60:
    08:26:4b:09:22:03:83:90:17:7f:f3:a7:72:57:bf:
    89:6d:e4:d7:40:24:8b:7b:bd:df:33:c0:ff:30:2e:
    e8:6c:1d"""</span><span class="token punctuation">)</span>

p_ranges<span class="token punctuation">,</span> pmask_msk<span class="token punctuation">,</span> pmask_val <span class="token operator">=</span> msk<span class="token punctuation">(</span><span class="token triple-quoted-string string">""" 0: e:  :  :  :c :c :  :  :  :b :  :  :  :  :
      :ab: e: 2: 8:c :  :  : 1:6 :6 : 6: f:d9: 0:
    8 :5c:7 :06:  :  :  :0 : 3:5 :4b:  :6 :  :  :
    2 :  :6 :  :  :  :2 :bc: c:  :85:1 : 1:d : 3:
     1:b4:  : b: 1: 3: d:a :  :  :6e: 0:b :2 :  :
      :b :  :9 :e :  :82:8d:  :  :13:  :  : a: a:
      :  :4 :  :c : f:  :  :7 :e :0a:  :  : b: 5:
      : e:91:3 :  :3c: 9:  : 6:  :  :b5:7d: 1:  :
      :  :  :b :a1:99:6 :4 :3 :c :1a:02:4 :  : 9:
    9 :f : d:bd:  :0 :  :  :  :b3:  : 4:  :e9: 9:
      : d:  :  :7 :  :93:  : e:dc:  : 0:  :e7:  :
    e :  :2 : b: 2:5 :  :  :  :  : c:5f:  :  :e2:
      :  : 9:  :2a:  : e:  :  :2 :  :9f: 7:3 :  :
    b : f:b :  : 8: 7:  :  :f :6 :e :c :  :3 :  :
    f7: 5: 8: 5:  :  :  :  :  : 8: e:  :03: c:  :
    33:76:e : 1:7 : c:  : 0:  :0b:  : a:  : 2: 9:
      :c8:bf:  :  :06: 7:d5:  :02: c:b :e2: 7:2 :
      :  """</span><span class="token punctuation">)</span>

q_ranges<span class="token punctuation">,</span> qmask_msk<span class="token punctuation">,</span> qmask_val <span class="token operator">=</span> msk<span class="token punctuation">(</span><span class="token triple-quoted-string string">""" 0: f:  :d0: 1:55: 4:31:  : b:c4:8 :  : e: d:
    34: 3:f :  :  :  :  : 8:99:1 :  : a:0 :  :4 :
    0 :  :f :  :a4:41:2 :  :a :  : 1:  : a: c:  :
      :  : 9:  :  : 2:f4: f:  :  :  :  :1 : 4:9 :
    a :  :  :79:0 :  :  :  :  : 2: 8:b :  :4 : 8:
      :9b: 1:  :d :  :f :e4:  :4 :c :e :  :3 :  :
     7:2 :  :d :8 :2 :7 :  :d :67:fc:e : 0:f9: 7:
    8 :  :  :  :1 :2f:  :51:  :  :2e:0a: e:3d: 6:
    b :  :dd:  : 0:fb:  :f4:  :  :  :b4: 9:c :  :
     a:  :  :  :d :  :  :6b: 2:  :9b: a:60:  :d6:
     0:4f:16:d1:  :  :5 :fc:  :f :  :8 :  :  :  :
     1: 6:e1:9 : e:4 : 6: c: d:d :73: 3:  :  :7 :
      :8 : 9:  :3b:f : 2:  :  :f1: e:  :  :1e:  :
    8 :  :  : 6:0 : 4:99:e :  : 5:  :  : 4:  :  :
      : a:81:64:  :7 :f : 9: d:  :9 :  : 7:93:f :
    ac:8c:  : 8:  : 0: d: 8:  :7 :  :1d:  :f :  :
    1 :a :6 :8 :  :60:  :b3:  :  :  :89:  :  :14:
      :5 """</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span> dmask_msk<span class="token punctuation">,</span> dmask_val <span class="token operator">=</span> msk<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""  :  :  : f:8 :a5:d : 2: 0:b :7 :  : 1:  : 4:
     1:0d:  :3 :  :6 :  :  : b:  :  :  :e :  :  :
    0e: 0:db:  :1a:1c:c0:  : e:  :  :99:bc:8 :a5:
    7 :7 :7 : b:  :  : 8: 8:  :7 :55: 2:  :  :f :
    b2:  :  :b :f :4 :  : 8:  :b :  :  :  : 0:  :
    0 :  :6 :9 :  :  :  : b: 4:  : 0: a: 5:07:b :
     9: c:9a: 9:  : 7:9e:  : b:60:f :  :  :  :0 :
      : 3:0 :  :  :  : 1:b :  :  : b: 6:0 :f :  :
      : 2:18: 6: b:1 :  :  :  :  :d3:f3:  :a :  :
     3:  :  :  :  : 3: d: 1: 2:7 :  : d:  : 2: d:
      :  : d:4 :  :d :  :6d: c:a :b6:  :  :  : 1:
    69:  : 7:  :89:  :c :8 :61: d:25: 3:7 :1b: 4:
    b :  :8 :55:  :49: 1:2 :3 :  :1 :e9:a8: 3:  :
    9 :  : 1:f8:d3:  :e :  :d :  :9 :b6:  :  :71:
    1 :  :c1:  : b: 1:  : 6:e :  :64:  :  :1a:c :
      : b:  :bf:c :  : 0:  : 8:a :4 :  :26:a :5 :
    6 :  :  :  :eb:  :e5: a:  :3e:f9:10:0 :  :  :
     6:0 :  : 8:  : 1:72: c:0 : f:5 : f:9c: 0: e:
     7:b :  :  :  :  :d9: 4:  : e:c :68:  :  :  :
     c:  :3a:  :  :a0:ea: 3: 4:  :72:a :d : 8:  :
      :0d:5 :0 : a: 7:c :bb: 6: 4:a :ce:d :2 : 1:
      :  :17:6 :  : c: b:  : f:  :3 : 5:6 :3 :0e:
      : 7:c :3e: 2: 9: 7: 6: f: e: f: 9:  :f3: 9:
    a :c1:6 :  : 1:9 :  :43:  : f: 5:  :0 :27: 4:
    4 :a :  :e9:  : 8: 4:3 :8a: 6:16:d5:c : e: e:
      :d : c:b :a8:  : 7:  : 9:  :7 :7d:  :  :  :
      :  :  :4 :2 :  : 3: 3: 6:  :  :  :7b:0 :  :
     e:  :0 :  :a :  : 5:  :  :  : 5:1 :82:c :0d:
    4 :2 :fd:36: 5:50:0 :  :  :d : f: 6:  :  :e :
    0 :  :  :ce:  :9e:8 :  :0 :d :07:b3:  :  :  :
    0 :e4:  :  :68:b :c :  : c:5 :  :  :3 : 7: 2:
     c:e0:  :5 :  :  :b4:  :ef: 7:  :1 :e : 0:f :
      :6 :  :  :  :e0:c :3 :  :  : 3:  : d:  :  :
     3: 3: c: a:  :b : a:71: 3: 0:a :  :4 :5d:  :
    0 :4 """</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span> dpmask_msk<span class="token punctuation">,</span> dpmask_val <span class="token operator">=</span> msk<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""  : 3:2a:  : d:  :  :  :  :0 :1 : f:  :  : 6:
    1 :2 :1b:07: a:e :b :c5:58:7 :  :e8: 7: 1: c:
      : 1:b :a0: 4:0f:5 :67:  :3 :7 :6 :f9:  : c:
      :79: 0:1 :65:  :8 :  :99: d:d :  :2 :9 :0 :
     e:  :0 :  :  :  : d:  :d :7 :6 :a9: a:8b: b:
      :  : 7: a:37:  :  :7 :1 :6 :  :c2: 7:6 :b :
     e:  :  :  :  :  :  :b :3a:5 :  :  :  :  :  :
      :  :  :cd:8 :  : d:  :7 : 3:  : f:e : c:  :
      : a:  :c : f:c : 7:b :5 :  :  :2 :8 :8 :6 :
    0a: a:  :  :3 :db:  : 4:00:  : d:  :b : 5:  :
    20: 2: 5:  :82:  : 0: 6:  :8a:  :7 :  : 8:  :
     4: 1:  :  :  : 8:46:  :  :  :  :  : 0:f :c8:
    2 :  : c:7 :  : 1:  :  :2 : 0: 5:  :  : 1:9b:
     6:9 : 0:74:  :c :  :e :  :  :cb:b :3 :3 :  :
     2:  :  :47:  :2 : 0:5 :  :  : d: 6:83:  :  :
      :c7:  :  :0b:  :  : c:  :3 :8 :  :9 :4 : 7:
    5 :c0:fe:  :f9: 1:  :0 : e: 8:02:  : f:  :c :
    55:61"""</span><span class="token punctuation">)</span>

_<span class="token punctuation">,</span> dqmask_msk<span class="token punctuation">,</span> dqmask_val <span class="token operator">=</span> msk<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""  :0b:7 :4 :0 : 0:6 : 7:7e:  : 5:  : 7:  : a:
    a :d : 0: 6: 4:86:  :  :8 :  :  :  :  :e :8f:
     9:  :  :  : 1:  :2 :  : 7: b:1 :5 : f:  :8 :
      :d :21:  :e : d:  :c9:e : b:  :  :1 :  :  :
      :d :a2:b7:  :  :  :f3:  :42:  :e : c:  :f :
      : 0:f :7 : 4: 5:34:  :4 : c:  :  :8 :d : 8:
    5 :af: 3:1d: 5:4 :  :2 :  :6 :c : 6:a :1 :5 :
     a:9 :  :d :  :  :0a:a1:  :f :7 :9 :b :  :  :
     f:2 :27: f:  :0 :f6:4d:  :  :  :  :  :5 :  :
     4:08:  : 5:  : 8: 5:  :  :  :18: 4: 8:57: 2:
     f: a:  :  :a8: f: c:f : e: 1:9 :c : 4:9 :  :
      :  :  :  :  : 1:  :2 :  :d1:  : 6:e : d:  :
      : f:04:2 :8d:  : 3:  :  :b : 8:  :d6:  : 2:
      :  :  :6 :  : f:  :  : 0:6 :  :51:  :48:19:
      :  :  :69:4 : c:  :c :  : f:  :f4:d :  : f:
     d:0 :0d:b :3 : 3:2 :  :  :6 : b:5 :2 :  : c:
     1:5a: f:f :  :  :7e:3e:  :d :f :0 : d: c: 6:
     1"""</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">search</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Kp<span class="token punctuation">,</span> Kq<span class="token punctuation">,</span> check_level<span class="token punctuation">,</span> break_step<span class="token punctuation">)</span><span class="token punctuation">:</span>
    max_step <span class="token operator">=</span> <span class="token number">0</span>
    cands <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> break_step <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#print " ", step, "( max =", max_step, ")"</span>
        max_step <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> max_step<span class="token punctuation">)</span>

        mod <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">*</span> step<span class="token punctuation">)</span>
        mask <span class="token operator">=</span> mod <span class="token operator">-</span> <span class="token number">1</span>

        cands_next <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> p<span class="token punctuation">,</span> new_digit <span class="token keyword">in</span> product<span class="token punctuation">(</span>cands<span class="token punctuation">,</span> p_ranges<span class="token punctuation">[</span><span class="token operator">-</span>step<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            pval <span class="token operator">=</span> <span class="token punctuation">(</span>new_digit <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>step <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> p

            <span class="token keyword">if</span> check_level <span class="token operator">&gt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
                qval <span class="token operator">=</span> solve_linear<span class="token punctuation">(</span>pval<span class="token punctuation">,</span> N <span class="token operator">&amp;</span> mask<span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
                <span class="token keyword">if</span> qval <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> check_val<span class="token punctuation">(</span>qval<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> qmask_msk<span class="token punctuation">,</span> qmask_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">if</span> check_level <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> solve_linear<span class="token punctuation">(</span>E<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> K <span class="token operator">*</span> <span class="token punctuation">(</span>N <span class="token operator">-</span> pval <span class="token operator">-</span> qval <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
                <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> check_val<span class="token punctuation">(</span>val<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> dmask_msk<span class="token punctuation">,</span> dmask_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">if</span> check_level <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> solve_linear<span class="token punctuation">(</span>E<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> Kp <span class="token operator">*</span> <span class="token punctuation">(</span>pval <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
                <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> check_val<span class="token punctuation">(</span>val<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> dpmask_msk<span class="token punctuation">,</span> dpmask_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">if</span> check_level <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> solve_linear<span class="token punctuation">(</span>E<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">+</span> Kq <span class="token operator">*</span> <span class="token punctuation">(</span>qval <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mod<span class="token punctuation">)</span>
                <span class="token keyword">if</span> val <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token keyword">not</span> check_val<span class="token punctuation">(</span>val<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> dqmask_msk<span class="token punctuation">,</span> dqmask_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>

                <span class="token keyword">if</span> pval <span class="token operator">*</span> qval <span class="token operator">==</span> N<span class="token punctuation">:</span>
                    <span class="token keyword">print</span> <span class="token string">"Kq ="</span><span class="token punctuation">,</span> Kq
                    <span class="token keyword">print</span> <span class="token string">"pwned"</span>
                    <span class="token keyword">print</span> <span class="token string">"p ="</span><span class="token punctuation">,</span> pval
                    <span class="token keyword">print</span> <span class="token string">"q ="</span><span class="token punctuation">,</span> qval
                    p <span class="token operator">=</span> pval
                    q <span class="token operator">=</span> qval
                    d <span class="token operator">=</span> invmod<span class="token punctuation">(</span>E<span class="token punctuation">,</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    coef <span class="token operator">=</span> invmod<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>

                    <span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
                    <span class="token keyword">print</span> RSA<span class="token punctuation">.</span>construct<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>N<span class="token punctuation">,</span> E<span class="token punctuation">,</span> d<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">,</span> coef<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exportKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    quit<span class="token punctuation">(</span><span class="token punctuation">)</span>

            cands_next<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pval<span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> cands_next<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        cands <span class="token operator">=</span> cands_next
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">check_val</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> mask<span class="token punctuation">,</span> mask_msk<span class="token punctuation">,</span> mask_val<span class="token punctuation">)</span><span class="token punctuation">:</span>
    test_mask <span class="token operator">=</span> mask_msk <span class="token operator">&amp;</span> mask
    test_val <span class="token operator">=</span> mask_val <span class="token operator">&amp;</span> mask
    <span class="token keyword">return</span> val <span class="token operator">&amp;</span> test_mask <span class="token operator">==</span> test_val

<span class="token comment"># K = 4695</span>
<span class="token comment"># Kp = 15700</span>
<span class="token comment"># Kq = 5155</span>

<span class="token keyword">for</span> K <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> K <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"checking"</span><span class="token punctuation">,</span> K
    <span class="token keyword">if</span> search<span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> check_level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> break_step<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"K ="</span><span class="token punctuation">,</span> K
        <span class="token keyword">break</span>

<span class="token keyword">for</span> Kp <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> Kp <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"checking"</span><span class="token punctuation">,</span> Kp
    <span class="token keyword">if</span> search<span class="token punctuation">(</span>K<span class="token punctuation">,</span> Kp<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> check_level<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> break_step<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Kp ="</span><span class="token punctuation">,</span> Kp
        <span class="token keyword">break</span>

<span class="token keyword">for</span> Kq <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> Kq <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"checking"</span><span class="token punctuation">,</span> Kq
    <span class="token keyword">if</span> search<span class="token punctuation">(</span>K<span class="token punctuation">,</span> Kp<span class="token punctuation">,</span> Kq<span class="token punctuation">,</span> check_level<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> break_step<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"Kq ="</span><span class="token punctuation">,</span> Kq
        <span class="token keyword">break</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_OAEP
<span class="token keyword">import</span> libnum
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>

p <span class="token operator">=</span> <span class="token number">30061432003658510087798871614869318011389940352798147030129806359975911392091235344042288409629143229311060231549478211871643725394470760528211801310601767727834886942210718412087541234398453046895030858579989874035849439867334906873642352112428914855967993998732685221108379784833027771293275558876952608462050146340591449046825135890871650866799299533696175818103240024841274114925018619060818213433528894936128306780366785977567327073724428211445259983614467640785163297734447975723664659822673456683284394386723716344090232882990461174301609971805075768328757325956784604364401827152431260896927633163074694121679</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'pubkey.pem'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    pk <span class="token operator">=</span> RSA<span class="token punctuation">.</span>importKey<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> pk<span class="token punctuation">.</span>n
e <span class="token operator">=</span> pk<span class="token punctuation">.</span>e
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span><span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    flag <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
q <span class="token operator">=</span> n<span class="token operator">//</span>p
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E6%A0%B9%E6%8D%AE%E5%85%AC%E9%92%A5%E8%AE%A1%E7%AE%97%E5%BE%97%E5%88%B0%E7%A7%81%E9%92%A5">根据公钥计算得到私钥</h2>

<pre data-role="codeBlock" data-info="" class="language-"><code>python RsaCtfTool.py --publickey pub.key --private

# 把这个私钥命名保存为pri.key然后用openssl解出来

openssl rsautl -decrypt -inkey pri.key -in enc1 -out 123.txt
</code></pre><hr>
<h2 class="mume-header" id="lsb-oracle-attack">LSB Oracle Attack</h2>

<p>适用情况：可以选择密文并泄露最低位。</p>
<p>在一次RSA加密中，明文为m，模数为n，加密指数为e，密文为c。我们可以构造出 <code>c'=((2^e)*c)%n=((2^e)*(m^e))%n=((2*m)^e)%n</code> ， 因为m的两倍可能大于n，所以经过解密得到的明文是 <code>m'=(2*m)%n</code> 。我们还能够知道 <code>m'</code> 的最低位lsb 是1还是0。 因为n是奇数，而<code>2*m</code> 是偶数，所以如果lsb 是0，说明(2*m)%n 是偶数，没有超过n，即<code>m&lt;n/2.0</code> ，反之则<code>m&gt;n/2.0</code> 。举个例子就能明白2%3=2 是偶数，而4%3=1 是奇数。以此类推，构造密文<code>c"=(4^e)*c)%n</code> 使其解密后为<code>m"=(4*m)%n</code> ，判断<code>m"</code> 的奇偶性可以知道m 和 n/4 的大小关系。所以我们就有了一个二分算法，可以在对数时间内将m的范围逼近到一个足够狭窄的空间。</p>
<p><strong>例题 QCTF2018-XMan选拔赛/Baby RSA</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>e = 0x10001
n = 0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db
c = 0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0

λ nc 47.96.239.28 23333
----------------------------- baby rsa -----------------------------
Come and Decode your data
If you give me ciphertext, I can tell you whether decoded data is even or odd
You can input ciphertext(hexdecimal) now
1
odd
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">import</span> libnum<span class="token punctuation">,</span> gmpy2<span class="token punctuation">,</span> socket<span class="token punctuation">,</span> time<span class="token punctuation">,</span> decimal

<span class="token keyword">def</span> <span class="token function">oracle</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
    hostname <span class="token operator">=</span> <span class="token string">'47.96.239.28'</span>
    port <span class="token operator">=</span> <span class="token number">23333</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>hostname<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">"lL"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">'even'</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">if</span> res <span class="token operator">==</span> <span class="token string">'odd'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">partial</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> c_of_2
    k <span class="token operator">=</span> n<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span>
    decimal<span class="token punctuation">.</span>getcontext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>prec <span class="token operator">=</span> k  <span class="token comment"># allows for 'precise enough' floats</span>
    lower <span class="token operator">=</span> decimal<span class="token punctuation">.</span>Decimal<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    upper <span class="token operator">=</span> decimal<span class="token punctuation">.</span>Decimal<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
        possible_plaintext <span class="token operator">=</span> <span class="token punctuation">(</span>lower <span class="token operator">+</span> upper<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token comment"># lower==0 when i&lt;1809</span>
        flag <span class="token operator">=</span> oracle<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> flag<span class="token punctuation">:</span>
            upper <span class="token operator">=</span> possible_plaintext  <span class="token comment"># plaintext is in the lower half</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            lower <span class="token operator">=</span> possible_plaintext  <span class="token comment"># plaintext is in the upper half</span>
        c <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">*</span> c_of_2<span class="token punctuation">)</span> <span class="token operator">%</span> n  <span class="token comment"># multiply y by the encryption of 2 again</span>
        <span class="token keyword">print</span> i<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>upper <span class="token operator">-</span> lower<span class="token punctuation">)</span>
        <span class="token comment"># time.sleep(0.2)</span>
    <span class="token comment"># By now, our plaintext is revealed!</span>
    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>upper<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">"[*] Conducting Oracle attack..."</span>
    <span class="token keyword">return</span> partial<span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">*</span> c_of_2<span class="token punctuation">)</span> <span class="token operator">%</span> n<span class="token punctuation">,</span> n<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    e <span class="token operator">=</span> <span class="token number">0x10001</span>
    n <span class="token operator">=</span> <span class="token number">0x0b765daa79117afe1a77da7ff8122872bbcbddb322bb078fe0786dc40c9033fadd639adc48c3f2627fb7cb59bb0658707fe516967464439bdec2d6479fa3745f57c0a5ca255812f0884978b2a8aaeb750e0228cbe28a1e5a63bf0309b32a577eecea66f7610a9a4e720649129e9dc2115db9d4f34dc17f8b0806213c035e22f2c5054ae584b440def00afbccd458d020cae5fd1138be6507bc0b1a10da7e75def484c5fc1fcb13d11be691670cf38b487de9c4bde6c2c689be5adab08b486599b619a0790c0b2d70c9c461346966bcbae53c5007d0146fc520fa6e3106fbfc89905220778870a7119831c17f98628563ca020652d18d72203529a784ca73716db</span>
    c <span class="token operator">=</span> <span class="token number">0x4f377296a19b3a25078d614e1c92ff632d3e3ded772c4445b75e468a9405de05d15c77532964120ae11f8655b68a630607df0568a7439bc694486ae50b5c0c8507e5eecdea4654eeff3e75fb8396e505a36b0af40bd5011990663a7655b91c9e6ed2d770525e4698dec9455db17db38fa4b99b53438b9e09000187949327980ca903d0eef114afc42b771657ea5458a4cb399212e943d139b7ceb6d5721f546b75cd53d65e025f4df7eb8637152ecbb6725962c7f66b714556d754f41555c691a34a798515f1e2a69c129047cb29a9eef466c206a7f4dbc2cea1a46a39ad3349a7db56c1c997dc181b1afcb76fa1bbbf118a4ab5c515e274ab2250dba1872be0</span>
    c_of_2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    m <span class="token operator">=</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># m = 560856645743734814774953158390773525781916094468093308691660509501812349</span>
    <span class="token keyword">print</span> libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%88%86%E8%A7%A3n%E5%BE%97%E5%88%B0%E7%9B%B8%E5%90%8C%E7%9A%84%E5%87%A0%E4%B8%AAp">分解n得到相同的几个p</h2>

<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> libnum
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> long_to_bytes<span class="token punctuation">,</span>bytes_to_long
c <span class="token operator">=</span> <span class="token string">"YXmuOsaD1W4poLAG2wPrJ/nYZCkeOh2igCYKnZA6ecCeJadT6B3ZVTciPN6LJ8AcAsRXNnkC6+9PNJPhmosSG5UGGbpIcg2JaZ1iA8Sm3fGiFacGvQsJOqqIWb01rjaQ3rDBKB331rrNo9QNOfMnjKr0ejGG+dNObTtvnskICbYbNnSxMxLQF57H5JnWZ3LbbKQ493vmZzwvC6iH8blNPAp3dBlVzDqIAmxmUbk0OzFjPoHphD1oxHdzXyQNW+sLxVldrf9xcItq92jN5sqBYrG8wADIqY1/sqhTMZvkIYFMHqoMQuiRSnVrCF2h2RtGDEayLo0evgXI/0W3YveyKCHViOnG6wypcBFm91ZWdjp3fVW/4DyxW6xu9hg/NlXyRP6pT/OyQpcyTqKRuiXJLWgFUJI/8TRgyAjBLLgSd3U0N3VM8kewXw5j+fMUTCW9/Gy4iP8m52Zabx/vEKdwdGZ0QyvgvAWGUFZ96EK0g1BM/LU9Tuu2R+VKcCSCprg283x6NfYxmU26KlQE6ZrrjLmbCOe0327uaW9aDbLxZytPYIE5ZkzhSsD9JpQBKL30dCy3UKDbcuNgB6SrDddrbIuUd0/kLxuwh6kTqNbC4NDrOT4WAuP4se8GGOK8Wz0dL6rE6FkzMnI4Qg501MTSNQZ4Bp7cNf6H9lTa/4DNOl0="</span>
e <span class="token operator">=</span> <span class="token number">58134567416061346246424950552806959952164141873988197038339318172373514096258823300468791726051378264715940131129676561677588167620420173326653609778206847514019727947838555201787320799426605222230914672691109516799571428125187628867529996213312357571123877040878478311539048041218856094075106182505973331343540958942283689866478426396304208219428741602335233702611371265705949787097256178588070830596507292566654989658768800621743910199053418976671932555647943277486556407963532026611905155927444039372549162858720397597240249353233285982136361681173207583516599418613398071006829129512801831381836656333723750840780538831405624097443916290334296178873601780814920445215584052641885068719189673672829046322594471259980936592601952663772403134088200800288081609498310963150240614179242069838645027877593821748402909503021034768609296854733774416318828225610461884703369969948788082261611019699410587591866516317251057371710851269512597271573573054094547368524415495010346641070440768673619729280827372954003276250541274122907588219152496998450489865181536173702554116251973661212376735405818115479880334020160352217975358655472929210184877839964775337545502851880977049299029101466287659419446724781305689536816523774995178046989696610897508786776845460908137698543091418571263630383061605011820139755322231913029643701770497299157169690586232187419462594477116374977216427311975598620616618808494138669546120288334682865354702356192972496556372279363023366842805886601834278434406709218165445335977049796015123909789363819484954615665668979</span>
p <span class="token operator">=</span> <span class="token number">165740755190793304655854506052794072378181046252118367693457385632818329041540419488625472007710062128632942664366383551452498541560538744582922713808611320176770401587674618121885719953831122487280978418110380597358747915420928053860076414097300832349400288770613227105348835005596365488460445438176193451867</span>
n <span class="token operator">=</span> p<span class="token operator">**</span><span class="token number">4</span>
phi <span class="token operator">=</span> p<span class="token operator">**</span><span class="token number">4</span><span class="token operator">-</span>p<span class="token operator">**</span><span class="token number">3</span>
c <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>c<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">print</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E5%A4%9A%E5%9B%A0%E5%AD%90">多因子</h2>

<p>N可被分解为多个素数</p>
<p><strong>例题</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>n=p1p2p3=2279269
​p1=137
​p2=131
​p3=127
​e=19
c=768924
</code></pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2
n<span class="token operator">=</span><span class="token number">2279269</span>
p1<span class="token operator">=</span><span class="token number">137</span>
p2<span class="token operator">=</span><span class="token number">131</span>
p3<span class="token operator">=</span><span class="token number">127</span>
e<span class="token operator">=</span><span class="token number">19</span>
c<span class="token operator">=</span><span class="token number">768924</span>
dp1<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>p1<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
dp2<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>p2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
dp3<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>p3<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
m1<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>dp1<span class="token punctuation">,</span>p1<span class="token punctuation">)</span>
m2<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>dp2<span class="token punctuation">,</span>p2<span class="token punctuation">)</span>
m3<span class="token operator">=</span><span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>dp3<span class="token punctuation">,</span>p3<span class="token punctuation">)</span>
qInv1<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>p2<span class="token punctuation">,</span>p1<span class="token punctuation">)</span>
h1<span class="token operator">=</span><span class="token punctuation">(</span>qInv1<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m1<span class="token operator">-</span>m2<span class="token punctuation">)</span> <span class="token operator">%</span> p1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> p1
m4<span class="token operator">=</span>m2<span class="token operator">+</span>h1<span class="token operator">*</span>p2
p4<span class="token operator">=</span>p1<span class="token operator">*</span>p2
qInv2<span class="token operator">=</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>p3<span class="token punctuation">,</span>p4<span class="token punctuation">)</span>
h2<span class="token operator">=</span><span class="token punctuation">(</span>qInv2<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m4<span class="token operator">-</span>m3<span class="token punctuation">)</span><span class="token operator">%</span> p4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> p4
m<span class="token operator">=</span>m3<span class="token operator">+</span>h2<span class="token operator">*</span>p3
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre><p><strong>例题 2018 picoctf：Super Safe RSA 3</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>c: 2214959746368961374343866619773680463913808855252144119575578619282028038148568609891198127966225495311682540323131579203618894145626046974546075970616339033486317429461235324910794466410074881752239541146624247745072518241741204968025293372054661473208051944193745386532992238774551013797836031291096741
n: 5564465787507426784189854287795264081761345977763964262369153883931335062166838686916377911069328789715623668583315372050520387414170383621534793892389463905512682152442890656361180400315699526374103389751180954335677791471685242043876553878553597343813515063304714971565013966010693181624796612216036537
e: 65537
</code></pre><p>用 yafu 经过多次分解直到所有因子都为素数，可以得到 32 个素数因子，然后直接求解即可：</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/python</span>
<span class="token comment">#-*- coding:utf-8 -*-</span>

c <span class="token operator">=</span> <span class="token number">2214959746368961374343866619773680463913808855252144119575578619282028038148568609891198127966225495311682540323131579203618894145626046974546075970616339033486317429461235324910794466410074881752239541146624247745072518241741204968025293372054661473208051944193745386532992238774551013797836031291096741</span>

n <span class="token operator">=</span> <span class="token number">5564465787507426784189854287795264081761345977763964262369153883931335062166838686916377911069328789715623668583315372050520387414170383621534793892389463905512682152442890656361180400315699526374103389751180954335677791471685242043876553878553597343813515063304714971565013966010693181624796612216036537</span>

e <span class="token operator">=</span> <span class="token number">65537</span>

p1 <span class="token operator">=</span> <span class="token number">2175350609</span>
p2 <span class="token operator">=</span> <span class="token number">2182560491</span>
p3 <span class="token operator">=</span> <span class="token number">2196605027</span>
p4 <span class="token operator">=</span> <span class="token number">2209029391</span>
p5 <span class="token operator">=</span> <span class="token number">2466547367</span>
p6 <span class="token operator">=</span> <span class="token number">2510616961</span>
p7 <span class="token operator">=</span> <span class="token number">2588079563</span>
p8 <span class="token operator">=</span> <span class="token number">2704140821</span>
p9 <span class="token operator">=</span> <span class="token number">2736762829</span>
p10 <span class="token operator">=</span> <span class="token number">2796597043</span>
p11 <span class="token operator">=</span> <span class="token number">2809479437</span>
p12 <span class="token operator">=</span> <span class="token number">2829659713</span>
p13 <span class="token operator">=</span> <span class="token number">2837556643</span>
p14 <span class="token operator">=</span> <span class="token number">2858051057</span>
p15 <span class="token operator">=</span> <span class="token number">3032087491</span>
p16 <span class="token operator">=</span> <span class="token number">3042267581</span>
p17 <span class="token operator">=</span> <span class="token number">3063304267</span>
p18 <span class="token operator">=</span> <span class="token number">3102491383</span>
p19 <span class="token operator">=</span> <span class="token number">3219243151</span>
p20 <span class="token operator">=</span> <span class="token number">3284737447</span>
p21 <span class="token operator">=</span> <span class="token number">3392021827</span>
p22 <span class="token operator">=</span> <span class="token number">3789952469</span>
p23 <span class="token operator">=</span> <span class="token number">3812358577</span>
p24 <span class="token operator">=</span> <span class="token number">3858988619</span>
p25 <span class="token operator">=</span> <span class="token number">3864352469</span>
p26 <span class="token operator">=</span> <span class="token number">3877179469</span>
p27 <span class="token operator">=</span> <span class="token number">3910354507</span>
p28 <span class="token operator">=</span> <span class="token number">3985847791</span>
p29 <span class="token operator">=</span> <span class="token number">3990903569</span>
p30 <span class="token operator">=</span> <span class="token number">4041031661</span>
p31 <span class="token operator">=</span> <span class="token number">4069378073</span>
p32 <span class="token operator">=</span> <span class="token number">4203209281</span>

primes <span class="token operator">=</span> <span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> p4<span class="token punctuation">,</span> p5<span class="token punctuation">,</span> p6<span class="token punctuation">,</span> p7<span class="token punctuation">,</span> p8<span class="token punctuation">,</span> p9<span class="token punctuation">,</span> p10<span class="token punctuation">,</span> p11<span class="token punctuation">,</span> p12<span class="token punctuation">,</span> p13<span class="token punctuation">,</span> \
          p14<span class="token punctuation">,</span> p15<span class="token punctuation">,</span> p16<span class="token punctuation">,</span> p17<span class="token punctuation">,</span> p18<span class="token punctuation">,</span> p19<span class="token punctuation">,</span> p20<span class="token punctuation">,</span> p21<span class="token punctuation">,</span> p22<span class="token punctuation">,</span> p23<span class="token punctuation">,</span> p24<span class="token punctuation">,</span> p25<span class="token punctuation">,</span> \
          p26<span class="token punctuation">,</span> p27<span class="token punctuation">,</span> p28<span class="token punctuation">,</span> p29<span class="token punctuation">,</span> p30<span class="token punctuation">,</span> p31<span class="token punctuation">,</span> p32<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">egcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        g<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">=</span> egcd<span class="token punctuation">(</span>b <span class="token operator">%</span> a<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>g<span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token punctuation">(</span>b <span class="token operator">//</span> a<span class="token punctuation">)</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">modinv</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y <span class="token operator">=</span> egcd<span class="token punctuation">(</span>a<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
    <span class="token keyword">if</span> g <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'modular inverse does not exist'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">%</span> m


<span class="token comment"># From https://crypto.stackexchange.com/questions/31109/rsa-enc-decryption-with-multiple-prime-modulus-using-crt</span>
ts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
xs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
ds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>primes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ds<span class="token punctuation">.</span>append<span class="token punctuation">(</span>modinv<span class="token punctuation">(</span>e<span class="token punctuation">,</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

m <span class="token operator">=</span> primes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>primes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ts<span class="token punctuation">.</span>append<span class="token punctuation">(</span>modinv<span class="token punctuation">(</span>m<span class="token punctuation">,</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> m <span class="token operator">*</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>primes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    xs<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token operator">%</span>primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> xs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
m <span class="token operator">=</span> primes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>primes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> x <span class="token operator">+</span> m <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> x <span class="token operator">%</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ts<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> m <span class="token operator">*</span> primes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>


<span class="token keyword">print</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token operator">%</span>n<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E6%9C%89%E9%99%90%E5%9F%9F%E5%86%85%E5%BC%8010%E6%AC%A1%E6%96%B9%E6%A0%B9">有限域内开10次方根</h2>

<p><strong>例题 [NCTF2019]easyRSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> flag <span class="token keyword">import</span> flag

e <span class="token operator">=</span> <span class="token number">0x1337</span>
p <span class="token operator">=</span> <span class="token number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span>
q <span class="token operator">=</span> <span class="token number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span>
n <span class="token operator">=</span> p <span class="token operator">*</span> q

<span class="token keyword">assert</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'NCTF'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>bit_length<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1337</span><span class="token punctuation">)</span>

c <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token comment"># 10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2

<span class="token keyword">def</span> <span class="token function">n2s</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"hex"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        flag<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">return</span> flag

<span class="token keyword">def</span> <span class="token function">onemod</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t<span class="token operator">=</span>p<span class="token operator">-</span><span class="token number">2</span>
    <span class="token keyword">while</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>r<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span> t<span class="token operator">-=</span><span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>r<span class="token punctuation">,</span>p<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solution</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>root<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g<span class="token operator">=</span>onemod<span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token number">0x1337</span><span class="token punctuation">)</span>
    may<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x1337</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        may<span class="token punctuation">.</span>append<span class="token punctuation">(</span>root<span class="token operator">*</span><span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>i<span class="token punctuation">,</span>p<span class="token punctuation">)</span><span class="token operator">%</span>p<span class="token punctuation">)</span>
    <span class="token keyword">return</span> may

c <span class="token operator">=</span> <span class="token number">10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span>
p <span class="token operator">=</span> <span class="token number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span>
q <span class="token operator">=</span> <span class="token number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span>
e <span class="token operator">=</span> <span class="token number">0x1337</span>
n <span class="token operator">=</span> p<span class="token operator">*</span>q

c_p <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">3307</span><span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>e<span class="token punctuation">)</span><span class="token operator">/</span>e<span class="token punctuation">,</span>p<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"find one"</span><span class="token punctuation">)</span>
C1<span class="token operator">=</span>solution<span class="token punctuation">(</span>p<span class="token punctuation">,</span>c_p<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"find all"</span><span class="token punctuation">)</span>
c_q <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token number">2649</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>e<span class="token punctuation">,</span>q<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"find another"</span><span class="token punctuation">)</span>
C2<span class="token operator">=</span>solution<span class="token punctuation">(</span>q<span class="token punctuation">,</span>c_q<span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"find all"</span><span class="token punctuation">)</span>
a<span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>p<span class="token punctuation">,</span>q<span class="token punctuation">)</span>
b <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>q<span class="token punctuation">,</span>p<span class="token punctuation">)</span>
<span class="token comment">#x = (b*q*c_p+a*p*c_q)%n</span>
flag<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> C1<span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> C2<span class="token punctuation">:</span>
        flag<span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">if</span> flag<span class="token operator">%</span><span class="token number">1000000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token punctuation">(</span>b<span class="token operator">*</span>q<span class="token operator">*</span>i<span class="token operator">+</span>a<span class="token operator">*</span>p<span class="token operator">*</span>j<span class="token punctuation">)</span><span class="token operator">%</span>n
        <span class="token keyword">if</span> <span class="token string">"NCTF"</span> <span class="token keyword">in</span> n2s<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E9%9B%85%E5%85%8B%E6%AF%94%E7%AC%A6%E5%8F%B7">雅克比符号</h2>

<p><strong>例题 N1CTF 2019 BabyRSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/env python2</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util <span class="token keyword">import</span> number
<span class="token keyword">import</span> random
<span class="token keyword">from</span> secret <span class="token keyword">import</span> flag
N <span class="token operator">=</span> <span class="token number">23981306327188221819291352455300124608114670714977979223022816906368788909398653961976023086718129607035805397846230124785550919468973090809881210560931396002918119995710297723411794214888622784232065592366390586879306041418300835178522354945438521139847806375923379136235993890801176301812907708937658277646761892297209069757559519399120988948212988924583632878840216559421398253025960456164998680766732013248599742397199862820924441357624187811402515396393385081892966284318521068948266144251848088067639941653475035145362236917008153460707675427945577597137822575880268720238301307972813226576071488632898694390629</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>
m <span class="token operator">=</span> number<span class="token punctuation">.</span>bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">while</span> m<span class="token punctuation">:</span>
        padding <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
        message <span class="token operator">=</span> padding <span class="token operator">&lt;&lt;</span> <span class="token number">1</span> <span class="token operator">+</span> m <span class="token operator">%</span> <span class="token number">2</span>
        cipher <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> e<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'n'</span><span class="token punctuation">)</span>
        m <span class="token operator">/=</span> <span class="token number">2</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token comment">#!/usr/bin/env python3</span>

<span class="token comment"># Then x2 ≡ a (mod n) is solvable if and only if:</span>
<span class="token comment"># The Legendre symbol ( a p ) = 1  ({\tfrac {a}{p}})=1} ({\tfrac {a}{p}} =1 } for all odd prime divisors p of n.</span>
<span class="token keyword">import</span> gmpy2

N <span class="token operator">=</span> <span class="token number">23981306327188221819291352455300124608114670714977979223022816906368788909398653961976023086718129607035805397846230124785550919468973090809881210560931396002918119995710297723411794214888622784232065592366390586879306041418300835178522354945438521139847806375923379136235993890801176301812907708937658277646761892297209069757559519399120988948212988924583632878840216559421398253025960456164998680766732013248599742397199862820924441357624187811402515396393385081892966284318521068948266144251848088067639941653475035145362236917008153460707675427945577597137822575880268720238301307972813226576071488632898694390629</span>
e <span class="token operator">=</span> <span class="token number">0x10001</span>
invert2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">,</span>N<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.enc'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    l <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>

byte <span class="token operator">=</span> <span class="token string">""</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> c <span class="token keyword">in</span> l<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> gmpy2<span class="token punctuation">.</span>jacobi<span class="token punctuation">(</span>c <span class="token operator">*</span> invert2<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            byte <span class="token operator">=</span> <span class="token string">"1"</span> <span class="token operator">+</span> byte
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            byte <span class="token operator">=</span> <span class="token string">"0"</span> <span class="token operator">+</span> byte

        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">8</span><span class="token punctuation">:</span>
            flag <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>byte<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> flag
            byte <span class="token operator">=</span> <span class="token string">""</span>

flag <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>byte<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> flag
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</pre><hr>
<h2 class="mume-header" id="%E8%B4%B9%E9%A9%AC%E5%9B%A0%E5%AD%90%E5%88%86%E8%A7%A3">费马因子分解</h2>

<p><strong>例题 2021 绿城杯 RSA2-PLUS</strong></p>
<p>内容较多,移至 CODE-AUDIT 中</p>
<hr>
<h2 class="mume-header" id="%E6%9A%82%E6%97%B6%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E6%80%BB%E7%BB%93%E7%9A%84%E9%A2%98%E5%9E%8B">暂时不知道怎么总结的题型</h2>

<p><strong>例题 [MRCTF2020]Easy_RSA</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> sympy
<span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> gcd<span class="token punctuation">,</span> invert
<span class="token keyword">from</span> random <span class="token keyword">import</span> randint
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> getPrime<span class="token punctuation">,</span> isPrime<span class="token punctuation">,</span> getRandomNBitInteger<span class="token punctuation">,</span> bytes_to_long<span class="token punctuation">,</span> long_to_bytes
<span class="token keyword">import</span> base64

<span class="token keyword">from</span> zlib <span class="token keyword">import</span> <span class="token operator">*</span>
flag <span class="token operator">=</span> <span class="token string">b"MRCTF{XXXX}"</span>
base <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token keyword">def</span> <span class="token function">gen_prime</span><span class="token punctuation">(</span>N<span class="token punctuation">)</span><span class="token punctuation">:</span>
    A <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        A <span class="token operator">=</span> getPrime<span class="token punctuation">(</span>N<span class="token punctuation">)</span>
        <span class="token keyword">if</span> A <span class="token operator">%</span> <span class="token number">8</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> A

<span class="token keyword">def</span> <span class="token function">gen_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"P_F_n = "</span><span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">gen_q</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    q <span class="token operator">=</span> getPrime<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>p <span class="token operator">&lt;</span> q<span class="token punctuation">)</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_n = "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    F_n <span class="token operator">=</span> <span class="token punctuation">(</span>p <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> gcd<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> getRandomNBitInteger<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> F_n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Q_E_D = "</span><span class="token punctuation">,</span> e <span class="token operator">*</span> d<span class="token punctuation">)</span>
    factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
    <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
    <span class="token keyword">return</span> sympy<span class="token punctuation">.</span>nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    _E <span class="token operator">=</span> base
    _P <span class="token operator">=</span> gen_p<span class="token punctuation">(</span><span class="token punctuation">)</span>
    _Q <span class="token operator">=</span> gen_q<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token punctuation">(</span>gcd<span class="token punctuation">(</span>_E<span class="token punctuation">,</span> <span class="token punctuation">(</span>_P <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>_Q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    _M <span class="token operator">=</span> bytes_to_long<span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    _C <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>_M<span class="token punctuation">,</span> _E<span class="token punctuation">,</span> _P <span class="token operator">*</span> _Q<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Ciphertext = "</span><span class="token punctuation">,</span> _C<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">'''
P_n =  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693
P_F_n =  14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740
Q_n =  20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947
Q_E_D =  100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201
Ciphertext =  40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021
'''</span>
</pre><p>分析题目代码可知，要得到flag，最根本的点在于获取 _P 和 _Q 的值。</p>
<p>_M = bytes_to_long(flag)<br>
_C = pow(_M, _E, _P * _Q)</p>
<p>所以 _M = _C ** d mod _P * _Q<br>
由 e*d = 1 mod (_P-1) * (_Q-1) 求e的逆就可以得到 d 了</p>
<p>分析_P的获取：<br>
P_n = pq<br>
P_F_n = (p-1)(q-1)<br>
建立方程组，用sympy.solve()函数求解，得到p,q。注意这里 q &gt; p。</p>
<p>分析_Q的获取：<br>
这里我们已知了的点：<br>
Q_n = n<br>
Q_E_D = e*d</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> sympy<span class="token punctuation">.</span>abc <span class="token keyword">import</span> a<span class="token punctuation">,</span>b       <span class="token comment">#定义变量a=p,b=q</span>
<span class="token keyword">from</span> libnum <span class="token keyword">import</span><span class="token operator">*</span>
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span><span class="token operator">*</span>

e <span class="token operator">=</span> <span class="token number">65537</span>
P_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024336556028267742021320891681762543660468484018686865891073110757394154024833552558863671537491089957038648328973790692356014778420333896705595252711514117478072828880198506187667924020260600124717243067420876363980538994101929437978668709128652587073901337310278665778299513763593234951137512120572797739181693</span>
P_F_n <span class="token operator">=</span>  <span class="token number">14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199039812208100301939365080328518578704076769147484922508482686658959347725753762078590928561862163337382463252361958145933210306431342748775024099427363967321110127562039879018616082926935567951378185280882426903064598376668106616694623540074057210432790309571018778281723710994930151635857933293394780142192586806292968028305922173313521186946635709194350912242693822450297748434301924950358561859804256788098033426537956252964976682327991427626735740</span>
Q_n <span class="token operator">=</span>  <span class="token number">20714298338160449749545360743688018842877274054540852096459485283936802341271363766157976112525034004319938054034934880860956966585051684483662535780621673316774842614701726445870630109196016676725183412879870463432277629916669130494040403733295593655306104176367902352484367520262917943100467697540593925707162162616635533550262718808746254599456286578409187895171015796991910123804529825519519278388910483133813330902530160448972926096083990208243274548561238253002789474920730760001104048093295680593033327818821255300893423412192265814418546134015557579236219461780344469127987669565138930308525189944897421753947</span>
Q_E_D <span class="token operator">=</span>  <span class="token number">100772079222298134586116156850742817855408127716962891929259868746672572602333918958075582671752493618259518286336122772703330183037221105058298653490794337885098499073583821832532798309513538383175233429533467348390389323225198805294950484802068148590902907221150968539067980432831310376368202773212266320112670699737501054831646286585142281419237572222713975646843555024731855688573834108711874406149540078253774349708158063055754932812675786123700768288048445326199880983717504538825498103789304873682191053050366806825802602658674268440844577955499368404019114913934477160428428662847012289516655310680119638600315228284298935201</span>
c <span class="token operator">=</span>  <span class="token number">40855937355228438525361161524441274634175356845950884889338630813182607485910094677909779126550263304194796000904384775495000943424070396334435810126536165332565417336797036611773382728344687175253081047586602838685027428292621557914514629024324794275772522013126464926990620140406412999485728750385876868115091735425577555027394033416643032644774339644654011686716639760512353355719065795222201167219831780961308225780478482467294410828543488412258764446494815238766185728454416691898859462532083437213793104823759147317613637881419787581920745151430394526712790608442960106537539121880514269830696341737507717448946962021</span>

<span class="token comment">#通过sympy.solve()函数解方程来求    _P</span>
pq <span class="token operator">=</span> solve<span class="token punctuation">(</span><span class="token punctuation">[</span>P_n <span class="token operator">-</span> <span class="token punctuation">(</span>a <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span>P_n <span class="token operator">-</span> P_F_n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment"># print(pq)</span>
Pp <span class="token operator">=</span> pq<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
Pq <span class="token operator">=</span> pq<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
factor1 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> Pp <span class="token operator">+</span> <span class="token number">2020</span> <span class="token operator">*</span> Pq
_P <span class="token operator">=</span> nextprime<span class="token punctuation">(</span>factor1<span class="token punctuation">)</span>
<span class="token comment">#print(_P)</span>

<span class="token comment">#这里涉及已知d,e,n,求p,q值的算法。获取 _Q</span>
<span class="token keyword">def</span> <span class="token function">getpq</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>ed<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p<span class="token operator">=</span><span class="token number">1</span>
        q<span class="token operator">=</span><span class="token number">1</span>
        <span class="token keyword">while</span> p<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> q<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
                k <span class="token operator">=</span> ed <span class="token operator">-</span> <span class="token number">1</span>
                g <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
                <span class="token keyword">while</span> p<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> q<span class="token operator">==</span><span class="token number">1</span> <span class="token keyword">and</span> k <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">:</span>
                        k <span class="token operator">//=</span> <span class="token number">2</span>
                        x <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span>k<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> x <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token keyword">and</span> gcd<span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
                                p <span class="token operator">=</span> gcd<span class="token punctuation">(</span>x<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
                                q <span class="token operator">=</span> n <span class="token operator">//</span> p
                                factor2 <span class="token operator">=</span> <span class="token number">2021</span> <span class="token operator">*</span> p <span class="token operator">-</span> <span class="token number">2020</span> <span class="token operator">*</span> q
                                <span class="token keyword">if</span> factor2 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                                        factor2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> factor2
        <span class="token keyword">return</span> nextprime<span class="token punctuation">(</span>factor2<span class="token punctuation">)</span>

_Q <span class="token operator">=</span> getpq<span class="token punctuation">(</span>Q_n<span class="token punctuation">,</span>Q_E_D<span class="token punctuation">)</span>

<span class="token comment">#加密 _C = pow(_M, _E, _P * _Q)</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>_P<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>_Q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span>phi<span class="token punctuation">)</span><span class="token punctuation">)</span>
_M <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>_P<span class="token operator">*</span>_Q<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>n2s<span class="token punctuation">(</span>_M<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>例题 [RoarCTF2019]RSA</strong></p>
<pre data-role="codeBlock" data-info="" class="language-"><code>A=(((y%x)**5)%(x%y))**2019+y**316+(y+1)/x
p=next_prime(z*x*y)
q=next_prime(z)
A =  2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724
n =  117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127
c =  41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128
</code></pre><p>猜测 e 为 65537</p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">import</span> gmpy2<span class="token punctuation">,</span> libnum<span class="token punctuation">,</span> codecs<span class="token punctuation">,</span> itertools

x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">83</span>
A<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y<span class="token operator">%</span>x<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>x<span class="token operator">%</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2019</span><span class="token operator">+</span>y<span class="token operator">**</span><span class="token number">316</span><span class="token operator">+</span><span class="token punctuation">(</span>y<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span>x
<span class="token keyword">assert</span> A <span class="token operator">==</span> <span class="token number">2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724</span>

n <span class="token operator">=</span>  <span class="token number">117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127</span>
c <span class="token operator">=</span>  <span class="token number">41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128</span>

<span class="token keyword">for</span> q <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>count<span class="token punctuation">(</span>gmpy2<span class="token punctuation">.</span>iroot<span class="token punctuation">(</span>n<span class="token operator">//</span><span class="token number">166</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n<span class="token operator">%</span>q <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>

p <span class="token operator">=</span> n <span class="token operator">//</span> q
e <span class="token operator">=</span> <span class="token number">65537</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>libnum<span class="token punctuation">.</span>n2s<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><p><strong>例题 2018 CodeGate CTF Rsababy</strong></p>
<pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> gmpy2 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">import</span> struct

<span class="token keyword">def</span> <span class="token function">xgcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x0<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y0<span class="token punctuation">,</span> y1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span>
    <span class="token keyword">while</span> n <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        q<span class="token punctuation">,</span> b<span class="token punctuation">,</span> n <span class="token operator">=</span> b <span class="token operator">//</span> n<span class="token punctuation">,</span> n<span class="token punctuation">,</span> b <span class="token operator">%</span> n
        x0<span class="token punctuation">,</span> x1 <span class="token operator">=</span> x1<span class="token punctuation">,</span> x0 <span class="token operator">-</span> q <span class="token operator">*</span> x1
        y0<span class="token punctuation">,</span> y1 <span class="token operator">=</span> y1<span class="token punctuation">,</span> y0 <span class="token operator">-</span> q <span class="token operator">*</span> y1
    <span class="token keyword">return</span>  b<span class="token punctuation">,</span> x0<span class="token punctuation">,</span> y0

<span class="token keyword">def</span> <span class="token function">mulinv</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    g<span class="token punctuation">,</span> x<span class="token punctuation">,</span> _ <span class="token operator">=</span> xgcd<span class="token punctuation">(</span>b<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">if</span> g <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> x <span class="token operator">%</span> n

<span class="token keyword">def</span> <span class="token function">GenerateN</span><span class="token punctuation">(</span>randomST<span class="token punctuation">)</span><span class="token punctuation">:</span>
    k1 <span class="token operator">=</span> mpz_urandomb<span class="token punctuation">(</span>randomST<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span>
    k2 <span class="token operator">=</span> mpz_urandomb<span class="token punctuation">(</span>randomST<span class="token punctuation">,</span> <span class="token number">2048</span><span class="token punctuation">)</span>

    p <span class="token operator">=</span> next_prime<span class="token punctuation">(</span>k1<span class="token punctuation">)</span>
    q <span class="token operator">=</span> next_prime<span class="token punctuation">(</span>k2<span class="token punctuation">)</span>

    <span class="token keyword">if</span> is_prime<span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">and</span> is_prime<span class="token punctuation">(</span>q<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>p<span class="token punctuation">,</span> q<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">GenerateKeys</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    e <span class="token operator">=</span> <span class="token number">65537</span>
    n <span class="token operator">=</span> p <span class="token operator">*</span> q
    pi_n <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    d <span class="token operator">=</span> mulinv<span class="token punctuation">(</span>e<span class="token punctuation">,</span> pi_n<span class="token punctuation">)</span>
    h <span class="token operator">=</span> <span class="token punctuation">(</span>d<span class="token operator">+</span>p<span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>d<span class="token operator">-</span>p<span class="token punctuation">)</span>
    g <span class="token operator">=</span> d<span class="token operator">*</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">0xdeadbeef</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">[</span>e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> h<span class="token punctuation">,</span> g<span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">EncryptMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    Flag <span class="token operator">=</span> <span class="token string">"########################################"</span>

    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/dev/urandom"</span><span class="token punctuation">)</span>
    seed <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    randomST <span class="token operator">=</span> random_state<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">"&gt;Q"</span><span class="token punctuation">,</span> seed<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Generating Key ...\n"</span><span class="token punctuation">)</span>
    p<span class="token punctuation">,</span> q <span class="token operator">=</span> GenerateN<span class="token punctuation">(</span>randomST<span class="token punctuation">)</span>
    e<span class="token punctuation">,</span> N<span class="token punctuation">,</span> hint<span class="token punctuation">,</span> gint <span class="token operator">=</span> GenerateKeys<span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Completed !!!\n"</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    Flag <span class="token operator">=</span> Flag<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token string">"\x2a"</span><span class="token punctuation">)</span>
    Flag <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>Flag<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>

    EncryptedData <span class="token operator">=</span> powmod<span class="token punctuation">(</span>Flag<span class="token punctuation">,</span> e<span class="token punctuation">,</span> N<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] Encrypted Data : %d\n"</span> <span class="token operator">%</span> EncryptedData<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] N : %d\n"</span> <span class="token operator">%</span> N<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] h : %d\n"</span> <span class="token operator">%</span> hint<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] g : %d\n"</span> <span class="token operator">%</span> gint<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    EncryptMsg<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="py" class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Util<span class="token punctuation">.</span>number <span class="token keyword">import</span> <span class="token operator">*</span>
g <span class="token operator">=</span>  <span class="token number">14511485561279877242490049924164262671564856980418706493772866848857612385453104346586350276227873984815502106112389832011566814347565705873657427101510533972939335373118027470906354834216983842099812965592939768854241417529908124711818216182341332507918374220901579987851767888710421089266081280013256600425746557269742268670300714949183260246617797156425767983027415373581836147225552931559016487193903056680274018867169067069164417868649729813464306199388375773268972224468436723728788928618254041886532217172217283880677562744928063668302190530092708676086756514664006766909499651097644447881334032649057611965077951245778537347658519214651268439995915614667939336569800565797702566887133370244643122543689011224353239395653153094885449557256699923700742653930928887024447374907536229536501931493386170594869542262576409686250950887746501725676758035668270309685358291271363775138099327895323451901829587908987436831617628346535627562925010698445652286450107659802164994355539623617745529876829000553355956755914526849056343372137493951531663650121127924626353148067965144997177441402726593083629261964699315644045714647617156724816370270635144953182744245498998992807987174252376199074131496163299914588620694929584594866873400406185502626180264465104468365933575409921644759774899908018217623256295871823903858740112075223018089096313796599554636163186830200265892525403238639070366999401808068998639590975305617369688731214141047568939908240058088089504343104889824160334560324387496383256518400827927341943755279126157377196722373876343583757261084975726106468397487366825775319965557539853162973895788663508023419482720093445137085452233528426725965549266605359644884153719762909553953900709890192728260024241748671796401590112629479273363064208874240854298225057415248756216847693518038319188675206377870041466557414694779134628404260587970</span>
N <span class="token operator">=</span> <span class="token number">523639805914061918270627443134741619704989339108811345591765650823383811679404400743730300288077320843234806116907796484315512386749183735427076044515394957782722144465236043561036957495670530886847413432636828661793513741180618385135095922719611444315861194066682307139969523206842728092440966461922557111209480112023032164065707216752568624317883094770784553451376502893748762652573604180632157059219119741129827017117558208565054860250853978397405747507844727903363351081745897472675235414693294079400158465019978970101063161094836772073302365997371679643083941089269169502839517043186914783290465318781726781533226599462066259256698885200843104424722505593942510854302401488139137362276492532699951880474157691347473741517183512613811731637427562990396497067805682564174185792379491573312640862381843195615293946630128509982267460922475624107750277459002662884836031305873522960659017891138316482378312004790485681371129328860344989214941450460756203906709954285455206483931555441550631622907560476932030275168094874500348941952385811045752980245084909805234648503736291123092594689494187215718382724496356220857628352007757197464098872772987476828030721472777531411032286344430474215475330008833588291692767417022829531866323051</span>
Encrypted_Data <span class="token operator">=</span> <span class="token number">380838525806255337893946743050327173947433371586247814759050430578204300094635270877953690129762202769875996939276197842147224857220372679703619497806927398399795108952962442891905146440202908075035070979097412854358636621348531277713225298087614167276769631514565642627640343771883615641654535423058064397195504442204533423747451626752470200734177912209703945585196661670059908372263823148356525332391696830864610833871912286943309315368473809329884078356658600058695228563250424729883958206468130236010169302227516477051342268478958591705205358855157076547042386496593253499052139707216013118968009859098636706611794339780312391554420587540660796607687910531233690474314728367495027785278881971814489961127141923005420385579115964806930701533734013794866357390109761177291603859980361697959155126598284421792362843501361967548503757576918138895493498276658301936707818035503138088925361983300854592909022681075014994189523262500924039153521343614460622246152945716505290603455309333333560506091410274263241508522602811994582040578653226240563907254131889033343189265841619698442130035569880428826546382882121430886993470180883869383405219173399698928360778092640513571913940390199302310817294277155376000921294944591121246587133744</span>
e <span class="token operator">=</span> <span class="token number">65537</span>

<span class="token comment"># Using Euler's Theorem and Fermat's Little Theorem we have</span>
t1 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> e<span class="token operator">*</span>g<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
t2 <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0xdeadbeef</span><span class="token punctuation">,</span> N<span class="token punctuation">)</span>
p <span class="token operator">=</span> GCD<span class="token punctuation">(</span><span class="token punctuation">(</span>t1<span class="token operator">*</span>t2<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>N<span class="token punctuation">)</span>

<span class="token keyword">assert</span> N <span class="token operator">%</span> p <span class="token operator">==</span> <span class="token number">0</span>
q <span class="token operator">=</span> N <span class="token operator">/</span> p
phin <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> inverse<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phin<span class="token punctuation">)</span>
m <span class="token operator">=</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>Encrypted_Data<span class="token punctuation">,</span> d<span class="token punctuation">,</span> N<span class="token punctuation">)</span>
<span class="token keyword">print</span> long_to_bytes<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</pre>
      </div>
      
      
    
    
    
    
    
    
    
    
  </body></html>